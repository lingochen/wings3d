!function(e){var t={};function o(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)o.d(n,i,function(t){return e[t]}.bind(null,i));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=26)}([function(e,t,o){"use strict";o.r(t),o.d(t,"start_halt",function(){return x}),o.d(t,"onReady",function(){return s}),o.d(t,"start",function(){return d}),o.d(t,"log",function(){return u}),o.d(t,"interposeLog",function(){return h}),o.d(t,"createMask",function(){return f}),o.d(t,"GROUND_GRID_SIZE",function(){return p}),o.d(t,"CAMERA_DIST",function(){return g}),o.d(t,"action",function(){return V}),o.d(t,"addActionConstant",function(){return _}),o.d(t,"bindAction",function(){return F}),o.d(t,"runAction",function(){return A}),o.d(t,"setInteraction",function(){return w}),o.d(t,"ezFetch",function(){return L});var n=o(4);let i=!1,r=[];function s(e){return i?e():r.push(e),this}let a="";function c(e){document.removeEventListener("DOMContentLoaded",c),v(a)}function d(e){"loading"!=document.readyState?v(e):(a=e,document.addEventListener("DOMContentLoaded",c))}void 0===NodeList.prototype[Symbol.iterator]&&(NodeList.prototype[Symbol.iterator]=Array.prototype[Symbol.iterator]);let l=[];function u(e,t){for(let o of l)o(e,t)}function h(e,t){if(t)l.push(e);else{let t=l.indexOf(e);t>-1&&l.splice(t,1)}}function f(){let e=0,t=0,o=arguments.length>32?32:arguments.length;for(;t<o;e|=arguments[t]<<t++);return e}const p=1,g=8*p;function v(e){Object(n.createWebGLContext)(e),i=!0;for(let e of r)e();window.addEventListener("beforeunload",m)}function m(e){return e.returnValue="Are you sure you want to quit?","Are you sure you want to quit?"}function x(){}let y;function w(e){y=e}const b=[null,null,null];function S(e){return e.preventDefault(),!1}function E(e){e.button<=2?b[e.button]=e.currentTarget:console.log("Amazing: mouse button is "+e.button)}const C="data-menuid";function M(e){if(e.button<=2){let t=b[e.button];t&&t===e.currentTarget&&A(e.button,e.currentTarget.getAttribute(C),e)}b[0]=b[1]=b[2]=null}function F(e,t,o,n){if(V.hasOwnProperty(o)){if(!Array.isArray(V[o])){V[o]=[null,null,null];for(const t of e)t.addEventListener("mousedown",E),t.addEventListener("mouseup",M),t.addEventListener("contextmenu",S)}V[o][t]=n}}function A(e,t,o){if(V.hasOwnProperty(t)){const n=V[t][e];n&&(y?y(t,o)&&n(o):n(o))}else console.log("unrecognized action: "+t)}function P(e){console.log(e.name+" action is not implemented")}const V={cameraModeEnter:()=>{P(void 0)},cameraModeExit:()=>{P(void 0)},cameraZoom:()=>{P(void 0)},contextMenu:()=>{P(void 0)},createCubeDialog:()=>{P(void 0)},fileMenu:()=>{P(void 0)},importMenu:()=>{P(void 0)},exportMenu:()=>{P(void 0)},openSidebar:()=>{P(void 0)},toggleVertexMode:()=>{P(void 0)},toggleEdgeMode:()=>{P(void 0)},toggleFaceMode:()=>{P(void 0)},toggleBodyMode:()=>{P(void 0)},toggleMultiMode:()=>{P(void 0)},redoEdit:()=>{P(void 0)},undoEdit:()=>{P(void 0)},preferenceButton:()=>{P(void 0)},toggleOrtho:()=>{P(void 0)},toggleGround:()=>{P(void 0)},toggleAxes:()=>{P(void 0)},createCube:()=>{P(void 0)},createCubePref:()=>{P(void 0)},createMaterial:()=>{P(void 0)},toggleObjectSelect:()=>{P(void 0)},toggleObjectVisibility:()=>{P(void 0)},toggleObjectLock:()=>{P(void 0)},toggleWireMode:()=>{P(void 0)},objectRename:()=>{P(void 0)},objectDelete:()=>{P(void 0)},objectDuplicate:()=>{P(void 0)},createGroup:()=>{P(void 0)},createGroupWorld:()=>{P(void 0)},importImageFileGUI:()=>{P(void 0)},showImage:()=>{P(void 0)},deleteImage:()=>{P(void 0)},createMaterial:()=>{P(void 0)},editMaterial:()=>{P(void 0)},deleteMaterial:()=>{P(void 0)},renameMaterial:()=>{P(void 0)},duplicateMaterial:()=>{P(void 0)},assignMaterial:()=>{P(void 0)},selectMaterial:()=>{P(void 0)},selectMenu:()=>{P(void 0)},deselect:()=>{P(void 0)},more:()=>{P(void 0)},less:()=>{P(void 0)},similar:()=>{P(void 0)},all:()=>{P(void 0)},invert:()=>{P(void 0)},adjacent:()=>{P(void 0)},edgeLoopMenu:()=>{P(void 0)},edgeLoop1:()=>{P(void 0)},nthEdgeLoopMenu:()=>{P(void 0)},edgeLoop2:()=>{P(void 0)},edgeLoop3:()=>{P(void 0)},edgeLoopN:()=>{P(void 0)},edgeRing1:()=>{P(void 0)},nthEdgeRingMenu:()=>{P(void 0)},edgeRing2:()=>{P(void 0)},edgeRing3:()=>{P(void 0)},edgeRingN:()=>{P(void 0)},bodyDelete:()=>{P(void 0)},bodyRename:()=>{P(void 0)},bodyDuplicateMoveMenu:()=>{P(void 0)},bodyDuplicateMoveX:()=>{P(void 0)},bodyDuplicateMoveY:()=>{P(void 0)},bodyDuplicateMoveZ:()=>{P(void 0)},bodyDuplicateMoveFree:()=>{P(void 0)},bodyMoveMenu:()=>{P(void 0)},bodyMoveX:()=>{P(void 0)},bodyMoveY:()=>{P(void 0)},bodyMoveZ:()=>{P(void 0)},bodyMoveFree:()=>{P(void 0)},bodyRotateMenu:()=>{P(void 0)},bodyRotateX:()=>{P(void 0)},bodyRotateY:()=>{P(void 0)},bodyRotateZ:()=>{P(void 0)},bodyRotateFree:()=>{P(void 0)},bodyInvert:()=>{P(void 0)},bodyCombine:()=>{P(void 0)},bodySeparate:()=>{P(void 0)},bodyFlipMenu:()=>{P(void 0)},bodyFlipX:()=>{P(void 0)},bodyFlipY:()=>{P(void 0)},bodyFlipZ:()=>{P(void 0)},bodyScaleUniform:()=>{P(void 0)},bodyScaleAxis:()=>{P(void 0)},bodyScaleAxisX:()=>{P(void 0)},bodyScaleAxisY:()=>{P(void 0)},bodyScaleAxisZ:()=>{P(void 0)},bodyScaleRadial:()=>{P(void 0)},bodyScaleRadialX:()=>{P(void 0)},bodyScaleRadialY:()=>{P(void 0)},bodyScaleRadialZ:()=>{P(void 0)},bodyPlaneCut:()=>{P(void 0)},bodyPlaneCutX:()=>{P(void 0)},bodyPlaneCutY:()=>{P(void 0)},bodyPlaneCutZ:()=>{P(void 0)},bodySlice:()=>{P(void 0)},bodySliceX:()=>{P(void 0)},bodySliceY:()=>{P(void 0)},bodySliceZ:()=>{P(void 0)},bodyWeld:()=>{P(void 0)},cutMenu:()=>{P(void 0)},cutLine2:()=>{P(void 0)},cutLine3:()=>{P(void 0)},cutLine4:()=>{P(void 0)},cutLine5:()=>{P(void 0)},cutLine10:()=>{P(void 0)},cutAsk:()=>{P(void 0)},cutAndConnect:()=>{P(void 0)},edgeBevel:()=>{P(void 0)},edgeDissolve:()=>{P(void 0)},edgeCollapse:()=>{P(void 0)},edgeMoveMenu:()=>{P(void 0)},edgeMoveX:()=>{P(void 0)},edgeMoveY:()=>{P(void 0)},edgeMoveZ:()=>{P(void 0)},edgeMoveFree:()=>{P(void 0)},edgeMoveNormal:()=>{P(void 0)},edgeRotateMenu:()=>{P(void 0)},edgeRotateX:()=>{P(void 0)},edgeRotateY:()=>{P(void 0)},edgeRotateZ:()=>{P(void 0)},edgeRotateFree:()=>{P(void 0)},edgeExtrudeMenu:()=>{P(void 0)},edgeExtrudeNormal:()=>{P(void 0)},edgeExtrudeFree:()=>{P(void 0)},edgeExtrudeX:()=>{P(void 0)},edgeExtrudeY:()=>{P(void 0)},edgeExtrudeZ:()=>{P(void 0)},edgeCrease:()=>{P(void 0)},edgeLoopCut:()=>{P(void 0)},edgeCorner:()=>{P(void 0)},edgeSlide:()=>{P(void 0)},edgeFlatten:()=>{P(void 0)},edgeFlattenX:()=>{P(void 0)},edgeFlattenY:()=>{P(void 0)},edgeFlattenZ:()=>{P(void 0)},edgeScaleUniform:()=>{P(void 0)},edgeScaleAxis:()=>{P(void 0)},edgeScaleAxisX:()=>{P(void 0)},edgeScaleAxisY:()=>{P(void 0)},edgeScaleAxisZ:()=>{P(void 0)},edgeScaleRadial:()=>{P(void 0)},edgeScaleRadialX:()=>{P(void 0)},edgeScaleRadialY:()=>{P(void 0)},edgeScaleRadialZ:()=>{P(void 0)},edgeHardness:()=>{P(void 0)},edgeSoft:()=>{P(void 0)},edgeHard:()=>{P(void 0)},edgeInvert:()=>{P(void 0)},faceExtrudeMenu:()=>{P(void 0)},faceExtrudeX:()=>{P(void 0)},faceExtrudeY:()=>{P(void 0)},faceExtrudeZ:()=>{P(void 0)},faceExtrudeFree:()=>{P(void 0)},faceExtrudeNormal:()=>{P(void 0)},faceDissolve:()=>{P(void 0)},faceCollapse:()=>{P(void 0)},faceMoveMenu:()=>{P(void 0)},faceMoveX:()=>{P(void 0)},faceMoveY:()=>{P(void 0)},faceMoveZ:()=>{P(void 0)},faceMoveFree:()=>{P(void 0)},faceMoveNormal:()=>{P(void 0)},faceRotateMenu:()=>{P(void 0)},faceRotateX:()=>{P(void 0)},faceRotateY:()=>{P(void 0)},faceRotateZ:()=>{P(void 0)},faceRotateFree:()=>{P(void 0)},faceScaleUniform:()=>{P(void 0)},faceBridge:()=>{P(void 0)},faceInset:()=>{P(void 0)},faceBevel:()=>{P(void 0)},faceBump:()=>{P(void 0)},faceIntrude:()=>{P(void 0)},facePutOn:()=>{P(void 0)},faceLift:()=>{P(void 0)},faceMirror:()=>{P(void 0)},faceFlatten:()=>{P(void 0)},faceFlattenNormal:()=>{P(void 0)},faceFlattenX:()=>{P(void 0)},faceFlattenY:()=>{P(void 0)},faceFlattenZ:()=>{P(void 0)},faceScaleAxis:()=>{P(void 0)},faceScaleAxisX:()=>{P(void 0)},faceScaleAxisY:()=>{P(void 0)},faceScaleAxisZ:()=>{P(void 0)},faceScaleRadial:()=>{P(void 0)},faceScaleRadialX:()=>{P(void 0)},faceScaleRadialY:()=>{P(void 0)},faceScaleRadialZ:()=>{P(void 0)},facePlaneCut:()=>{P(void 0)},facePlaneCutX:()=>{P(void 0)},facePlaneCutY:()=>{P(void 0)},facePlaneCutZ:()=>{P(void 0)},faceMaterialMenu:()=>{P(void 0)},vertexConnect:()=>{P(void 0)},vertexDissolve:()=>{P(void 0)},vertexCollapse:()=>{P(void 0)},vertexMoveMenu:()=>{P(void 0)},vertexMoveX:()=>{P(void 0)},vertexMoveY:()=>{P(void 0)},vertexMoveZ:()=>{P(void 0)},vertexMoveFree:()=>{P(void 0)},vertexMoveNormal:()=>{P(void 0)},vertexRotateMenu:()=>{P(void 0)},vertexRotateX:()=>{P(void 0)},vertexRotateY:()=>{P(void 0)},vertexRotateZ:()=>{P(void 0)},vertexRotateFree:()=>{P(void 0)},vertexBevel:()=>{P(void 0)},vertexExtrudeMenu:()=>{P(void 0)},vertexExtrudeNormal:()=>{P(void 0)},vertexExtrudeFree:()=>{P(void 0)},vertexExtrudeX:()=>{P(void 0)},vertexExtrudeY:()=>{P(void 0)},vertexExtrudeZ:()=>{P(void 0)},vertexWeld:()=>{P(void 0)},vertexFlatten:()=>{P(void 0)},vertexFlattenX:()=>{P(void 0)},vertexFlattenY:()=>{P(void 0)},vertexFlattenZ:()=>{P(void 0)},vertexScaleUniform:()=>{P(void 0)},vertexScaleAxis:()=>{P(void 0)},vertexScaleAxisX:()=>{P(void 0)},vertexScaleAxisY:()=>{P(void 0)},vertexScaleAxisZ:()=>{P(void 0)},vertexScaleRadial:()=>{P(void 0)},vertexScaleRadialX:()=>{P(void 0)},vertexScaleRadialY:()=>{P(void 0)},vertexScaleRadialZ:()=>{P(void 0)},helpMenu:()=>{P(void 0)},about:()=>{P(void 0)},introduction:()=>{P(void 0)},basicCommands:()=>{P(void 0)},tableTutor:()=>{P(void 0)}};function _(e){V[e]=(()=>{P(this)})}const L=function(){return function(t){return fetch(t).then(e)};function e(e){let t=e.headers.get("content-type");if(t.includes("application/json")||t.includes("application/jason"))return function(e){return e.json().then(t=>e.ok?t:Promise.reject(Object.assign({},t,{status:e.status,statusText:e.statusText})))}(e);if(t.includes("text/html"))return function(e){return e.text().then(t=>e.ok?json:Promise.reject({status:e.status,statusText:e.statusText,err:t}))}(e);throw new Error(`Sorry, content-type ${t} not supported`)}}()},function(e,t,o){"use strict";o.r(t),o.d(t,"prop",function(){return S}),o.d(t,"theme",function(){return E}),o.d(t,"toggleVertexMode",function(){return _}),o.d(t,"toggleFaceMode",function(){return L}),o.d(t,"toggleEdgeMode",function(){return I}),o.d(t,"toggleBodyMode",function(){return B}),o.d(t,"toggleMultiMode",function(){return T}),o.d(t,"restoreVertexMode",function(){return O}),o.d(t,"restoreFaceMode",function(){return R}),o.d(t,"restoreEdgeMode",function(){return D}),o.d(t,"restoreBodyMode",function(){return N}),o.d(t,"restoreMultiMode",function(){return z}),o.d(t,"currentMode",function(){return k}),o.d(t,"putIntoWorld",function(){return H}),o.d(t,"moveCage",function(){return G}),o.d(t,"addToWorld",function(){return W}),o.d(t,"removeFromWorld",function(){return U}),o.d(t,"getWorld",function(){return Y}),o.d(t,"updateWorld",function(){return X}),o.d(t,"makeCombineIntoWorld",function(){return q}),o.d(t,"setObject",function(){return Z}),o.d(t,"attachHandlerMouseMove",function(){return fe}),o.d(t,"attachHandlerMouseSelect",function(){return pe}),o.d(t,"doCommand",function(){return be}),o.d(t,"redoEdit",function(){return ye}),o.d(t,"undoEdit",function(){return we}),o.d(t,"undoQueue",function(){return xe}),o.d(t,"undoQueueCombo",function(){return me}),o.d(t,"loadMatrices",function(){return Se}),o.d(t,"projection",function(){return Ee}),o.d(t,"modelView",function(){return Ce}),o.d(t,"drawWorld",function(){return Me}),o.d(t,"render",function(){return Fe});var n=o(3),i=o(8),r=o(11),s=o(4),a=o(22),c=o(0),d=o(5),l=o(14),u=o(16),h=o(15),f=o(13),p=o(24),g=o(2),v=o(25),m=o(17),x=o(19),y=o(6),w=o(20),b=o(7);const S={showEdges:!0,showBackfaces:!0,showNormals:!1,showBB:!0,showBBCenter:!0,showColors:!0,showMaterials:!0,showTextures:!0,showNormalMaps:!0,showWireBackfaces:!1,showGroundplane:!0,showCamImagePlane:!1,showAxes:!0,infoVerbose:!1,constrainAxes:!0,clipPlane:!1,orthogonalView:!1,filterTexture:!0,frameDisregardsMirror:!1,useSceneLights:!1,forceOrthoAlongAxis:!1,workmode:!0,allowRotation:!0,allowInfoText:!0,showMiniAxis:!0},E={activeVectorColor:[0,1,0],clipPlaneColor:[.8,.3,0],defaultAxis:[[0,0,0],[1,0,0]],gridColor:"#4D4D4D",draftBench:{edgeColor:"#000000",hardEdgeColor:"#FF8000",selectedColor:"#A60000",selectedHilite:"#B3B300",unselectedHilite:"#00A600",vertexColor:"#000000",faceColor:"#C9CFB1",sculptMagnetColor:"#0000FF",tweakMagnetColor:"#0000FF",tweakVectorColor:"#FF8000"},draftBenchPref:{vertexSize:4,selectedVertexSize:5,maskedVertexSize:8,edgeWidth:2,selectedEdgeWidth:2,hardEdgeWidth:2},normalVectorColor:[0,1,0],colorX:"#B3001A",colorY:"#5FD100",colorZ:"#004DCC",negColorX:"#CCCCCC",negColorY:"#CCCCCC",negColorZ:"#CCCCCC",geometryBackground:"#CCCCCC",css:{menubarBackground:"#3C3B37",menubarText:"#FFFFFF",menuBackground:"#3C3B37",menuText:"#FFFFFF",menuHighlight:"#F07746",menuHighlightText:"#FFFFFF",infoLineBackground:"#F2F1F0",infoLineText:"#4C4C4C",infoBackground:"#6161617F",infoText:"#FFFFFF"}},C={geometryBackground:"FF",infoBackground:"7F"};function M(e,t){Object.entries(e).forEach(([o,n])=>{"object"!=typeof n||Array.isArray(n)?t(e,o,n):M(n,t)})}function F(e){M(E,(t,o,n)=>{let i=e.querySelector(`input[type=color][name=${o}]`);i&&(9===n.length?i.value=n.slice(0,7):i.value=n),(i=e.querySelector(`input[type=number][name=${o}]`))&&(i.value=n)}),M(S,(t,o,n)=>{const i=e.querySelector(`input[type=checkbox][name=${o}]`);i&&(i.checked=n)}),M(S,(e,t,o)=>{})}function A(e){M(E,(t,o,n)=>{let i=e.querySelector(`input[type=color][name=${o}]`);i&&(t[o]=C[o]?i.value+C[o]:i.value),(i=e.querySelector(`input[type=number][name=${o}]`))&&(t[o]=i.value)});const t=document.documentElement;Object.entries(E.css).forEach(([e,o])=>{7===o.length?t.style.setProperty(`--${e}`,o):9===o.length&&t.style.setProperty(`--${e}`,y.hexToCssRGBA(o))}),j.draftBench.setTheme(E.draftBench,E.draftBenchPref),M(S,(t,o,n)=>{const i=e.querySelector(`input[type=checkbox][name=${o}]`);i&&(t[o]=i.checked)}),i.needToRedraw()}const P={face:null,edge:null,vertex:null,body:null,multi:null,current:null};function V(e){let t=document.getElementById("toggle"+e+"ModeFor");t&&!t.checked&&t.click()}function _(){P.current!==P.vertex&&(P.current.toggleFunc(P.vertex),P.current=P.vertex,V("Vertex"),i.needToRedraw())}function L(){P.current!==P.face&&(P.current.toggleFunc(P.face),P.current=P.face,V("Face"),i.needToRedraw())}function I(){P.current!==P.edge&&(P.current.toggleFunc(P.edge),P.current=P.edge,V("Edge"),i.needToRedraw())}function B(){P.current!==P.body&&(P.current.toggleFunc(P.body),P.current=P.body,V("Body"),i.needToRedraw())}function T(){P.current!==P.multi&&(P.current.toggleFunc(P.multi),P.current=P.multi,V("Multi"),i.needToRedraw())}function O(e){P.current!==P.vertex&&(P.current.restoreMode(P.vertex,e),P.current=P.vertex,V("Vertex"),i.needToRedraw())}function R(e){P.current!==P.face&&(P.current.restoreMode(P.face,e),P.current=P.face,V("Face"),i.needToRedraw())}function D(e){P.current!==P.edge&&(P.current.restoreMode(P.edge,e),P.current=P.edge,V("Edge"),i.needToRedraw())}function N(e){P.current!==P.body&&(P.current.restoreMode(P.body,e),P.current=P.body,V("Body"),i.needToRedraw())}function z(e){P.current!==P.multi&&(P.current.restoreMode(P.multi,e),P.current=P.multi,V("Multi"),i.needToRedraw())}const k=()=>P.current,j={world:new g.PreviewGroup,draftBench:void 0,geometryGraph:void 0,imageList:void 0,materialList:void 0,lightList:void 0,currentObjects:void 0,currentParent:void 0};function H(){return W(new g.PreviewCage(j.draftBench))}function G(e,t){t.removeFromParent(),e.insert(t),j.world.numberOfCage()}function W(e,t=j.world){return t.insert(e),j.geometryGraph.addObject(e,t.guiStatus.ul),e.setVisible(!0),j.draftBench.updatePreview(),i.needToRedraw(),j.world.numberOfCage(),e}function U(e){const t=e.removeFromParent();return t&&(e.setVisible(!1),j.draftBench.updatePreview(),i.needToRedraw(),j.geometryGraph.removeObject(e),j.world.numberOfCage()),t}function Y(){return j.world.getCage()}function X(){j.draftBench.updatePreview(),i.needToRedraw()}function q(e){let t=new g.PreviewCage(j.draftBench);for(let t of e)U(t);return t.merge(e),W(t),t}function Z(e,t){j.currentObjects=t,j.currentParent=e}const $={cage:null,edge:null,vertex:null,face:null,plane:null};let Q;const K={camera:null,mousemove:null,mouseSelect:null},J={center:vec3.create(),halfSize:vec3.create(),normal:vec3.create(),hilite:!1},ee=()=>K.mouseSelect?K.mouseSelect.isVertexSelectable():!P.current||P.current.isVertexSelectable(),te=()=>K.mouseSelect?K.mouseSelect.isEdgeSelectable():!P.current||P.current.isEdgeSelectable(),oe=()=>K.mouseSelect?K.mouseSelect.isFaceSelectable():!P.current||P.current.isFaceSelectable(),ne=()=>!!K.mouseSelect&&K.mouseSelect.getPlaneNormal();function ie(e,t,o){let n=null,i=null,r=null,s=null;if($.plane=null,null!==e){const o=vec3.create(),a=vec3.create(),c=vec3.create(),d=e.destination().vertex,l=e.origin.vertex;vec3.sub(o,t,l),vec3.sub(a,t,d),vec3.sub(c,d,l);const u=vec3.length(o),h=vec3.length(a),f=vec3.length(c),p=f/4,g=ee(),v=te(),m=oe(),x=ne(),y=j.draftBench.boundingSpheres[e.face.index];if(x&&(vec3.copy(J.halfSize,y.getBVHRoot().getHalfSize()),vec3.copy(J.normal,K.mouseSelect.getPlaneNormal())),g&&(u<h?(!v&&!m||u<p)&&(n=e.origin):(!v&&!m||h<p)&&(n=e.destination()),n&&x&&(vec3.copy(J.center,n.vertex),$.plane=J)),v&&null===n){vec3.cross(o,o,a),vec3.sub(a,d,l);const t=vec3.length(o)/f;(!g&&!m||t<p)&&(i=e,x&&(vec3.add(J.center,i.origin.vertex,i.destination().vertex),vec3.scale(J.center,J.center,.5),$.plane=J))}m&&null===n&&null===i&&(r=e.face,x&&(vec3.copy(J.center,y.center),$.plane=J)),g||v||m||(s=Q)}n!==$.vertex&&(null!==$.vertex&&j.draftBench.hiliteVertex($.vertex,!1),null!==n&&(K.mouseSelect&&!K.mouseSelect.hilite({vertex:n,plane:$.plane},Q)?n=null:j.draftBench.hiliteVertex(n,!0)),$.vertex=n),i!==$.edge&&(null!==$.edge&&j.draftBench.hiliteEdge($.edge,!1),null!==i&&(K.mouseSelect&&!K.mouseSelect.hilite({edge:i,plane:$.plane},Q)?i=null:j.draftBench.hiliteEdge(i,!0)),$.edge=i),r!==$.face&&(null!==$.face&&j.draftBench.hiliteFace($.face,!1),null!==r&&(K.mouseSelect&&!K.mouseSelect.hilite({face:r,plane:$.plane},Q)?r=null:j.draftBench.hiliteFace(r,!0)),$.face=r),s!==$.cage&&(null!==$.cage&&$.cage.hiliteBody(!1),s&&s.hiliteBody(!0),$.cage=s),$.vertex||$.edge||$.face||($.plane=null)}let re=null;let se=null;function ae(){null!==se&&(xe(se.finish()),se=null)}function ce(e){0==e.button&&(null!==K.camera?(K.camera.doIt(),K.camera=null,c.log(c.action.cameraModeExit,r.view),help("L:Select   M:Start Camera   R:Show Menu   [Alt]+R:Tweak menu")):null!==K.mousemove?(xe(K.mousemove),K.mousemove=null):null!==K.mouseSelect?K.mouseSelect.select($)&&(K.mouseSelect.isMoveable()?K.mousemove=K.mouseSelect:xe(K.mouseSelect),K.mouseSelect=null):null!==re&&(P.current.toggleMulti($),se=P.current.selectStart(re.model,$),i.needToRedraw()))}function de(e){null!==K.camera?help("L:Accept   M:Drag to Pan  R:Cancel/Restore to View   Move mouse to tumble"):help("L:Select   M:Start Camera   R:Show Menu   [Alt]+R:Tweak menu")}function le(e){ae()}function ue(e){0==e.button?ae():1==e.button&&null===K.camera&&(e.stopImmediatePropagation(),K.camera=r.getMouseMoveHandler(),c.log(c.action.cameraModeEnter,r.view),help("L:Accept   M:Drag to Pan  R:Cancel/Restore to View   Move mouse to tumble"))}function he(e){if(null!==K.camera)K.camera.handleMouseMove(e);else if(null!==K.mousemove)K.mousemove.handleMouseMove(e,r.view),i.needToRedraw();else{var t=s.gl.getViewport(),o=e.pageX-e.currentTarget.offsetLeft,n=t[3]+1-(e.pageY-e.currentTarget.offsetTop);o<0&&(o=0),o>t[2]&&(o=t[2]),n<0&&(n=0),n>t[3]&&(n=t[3]);var a=Se(!1),c=s.gl.unProject(o,n,0,a.modelView,a.projection),d=s.gl.unProject(o,n,1,a.modelView,a.projection);vec3.sub(d,d,c),vec3.normalize(d,d),!function(e){let t=null;for(let o of j.world.getCage())if(!o.isLock()&&o.isVisible()){const n=o.rayPick(e);null!==n&&(null===t||t.t>n.t)&&(t=n)}if(null!==t){Q=t.model,re=t;let o=vec3.create();vec3.scaleAndAdd(o,e.origin,e.direction,t.t),ie(t.edge,o,t.center),i.needToRedraw()}else null!==re&&(ie(null),i.needToRedraw());re=t}(new m.Ray(c,d)),null!==se&&null!==re&&(se.dragSelect(re.model,$),i.needToRedraw())}}function fe(e){K.mousemove=e}function pe(e){K.mouseSelect=e}function ge(e){var t=e.deltaX,o=e.deltaY,n=e.deltaZ;if((t||o||n)&&e.deltaMode){var i=360;1==e.deltaMode&&(i=18),t*=i,o*=i,n*=i}r.zoomStep(o)}const ve={queue:[],current:-1};function me(e){xe(new d.EditCommandCombo(e))}function xe(e){for(;ve.queue.length-1>ve.current;){ve.queue.pop().free()}ve.queue.push(e),ve.current++,i.needToRedraw()}function ye(){ve.queue.length-1>ve.current&&(ve.queue[++ve.current].doIt(P.current),i.needToRedraw())}function we(){if(ve.current>=0){ve.queue[ve.current--].undo(P.current),i.needToRedraw()}}function be(e){return!!e.doIt()&&(xe(e),!0)}function Se(e){let t=Ee(mat4.create()),o=Ce(e);return{projection:t,modelView:o.modelView,useSceneLights:o.useSceneLights}}function Ee(e){const t=s.gl.getViewport(),o=(t[2]-t[0])/(t[3]-t[1]),n=r.view,i=S.orthogonalView;!i&&n.alongAxis&&(i=S.force_ortho_along_axis);var a=mat4.create();if(i){const e=n.distance*Math.tan(n.fov*Math.PI/180/2);mat4.ortho(a,-e*o,e*o,-e,e,n.zNear,n.zFar)}else mat4.perspective(a,n.fov,o,n.zNear,n.zFar);return mat4.mul(s.gl.projection,e,a),s.gl.projection}function Ce(e=!1){const t=r.view;let o=!1;return e&&(o=S.useSceneLights),mat4.fromTranslation(s.gl.modelView,vec3.fromValues(t.panX,t.panY,-t.distance)),mat4.rotateX(s.gl.modelView,s.gl.modelView,t.elevation*Math.PI/180),mat4.rotateY(s.gl.modelView,s.gl.modelView,t.azimuth*Math.PI/180),mat4.translate(s.gl.modelView,s.gl.modelView,t.origin),{useScentLights:o,modelView:s.gl.modelView}}function Me(e){let t=0;for(let e of j.world.getCage())e.updateStatus(),++t;0!==t&&(P.current.drawExtra(e,j.draftBench),$.vertex&&P.current!==P.vertex&&P.vertex.drawExtra(e,j.draftBench),$.edge&&P.current!==P.edge&&P.edge.drawExtra(e,j.draftBench),$.face&&P.current!==P.face&&P.face.drawExtra(e,j.draftBench),$.plane&&j.draftBench.drawPlane(e,$.plane),j.draftBench.drawHardEdgeEtc(e,P.current===P.edge,P.current),P.current.previewShader(e),e.bindTransform(),j.draftBench.draw(e,P.current),e.disableShader())}function Fe(e){i.render(e,Me)}c.onReady(function(){P.face=new l.FaceMadsor,P.edge=new u.EdgeMadsor,P.vertex=new h.VertexMadsor,P.body=new f.BodyMadsor,P.multi=new p.MultiMadsor,P.current=P.multi;const e=[{id:c.action.deselect,fn:"resetSelection",hotKey:" "},{id:c.action.more,fn:"moreSelection",hotKey:"+"},{id:c.action.less,fn:"lessSelection",hotKey:"-"},{id:c.action.similar,fn:"similarSelection",hotkey:"i"},{id:c.action.all,fn:"allSelection",hotKey:"a",meta:"ctrl"},{id:c.action.invert,fn:"invertSelection",hotKey:"i",meta:"ctrl+shift"},{id:c.action.adjacent,fn:"adjacentSelection"}];for(let t of e)n.bindMenuItem(t.id.name,function(e){const o=new d.EditCommandSimple(t.fn);o.doIt(P.current)&&xe(o)},t.hotKey,t.meta);n.bindMenuItem(c.action.openSidebar.name,e=>{const t=document.querySelector("#sidebar"),o=document.querySelector("#openSidebarFor");t&&o&&(o.checked?t.style.display="none":t.style.display="flex")});const t=[{id:c.action.undoEdit,fn:we,hotKey:" "},{id:c.action.redoEdit,fn:ye,hotKey:" "},{id:c.action.toggleVertexMode,fn:_,hotKey:" "},{id:c.action.toggleEdgeMode,fn:I,hotKey:" "},{id:c.action.toggleFaceMode,fn:L,hotKey:" "},{id:c.action.toggleBodyMode,fn:B,hotKey:" "},{id:c.action.toggleMultiMode,fn:T,hotkey:" "}];for(let e of t)n.bindMenuItem(e.id.name,function(t){help("wings3d - "+t.currentTarget.id),e.fn()});const o=[{id:c.action.toggleGround,propName:"showGroundplane",selector:"#toggleGroundFor"},{id:c.action.toggleAxes,propName:"showAxes",selector:"#toggleAxesFor"},{id:c.action.toggleOrtho,propName:"orthogonalView",selector:"#toggleOrthoFor"}];for(let e of o)n.bindMenuItem(e.id.name,t=>{const o=document.querySelector(e.selector);o&&(S[e.propName]=!o.checked,i.needToRedraw())});n.bindMenuItem(c.action.preferenceButton.name,e=>{n.runDialogCenter("#preferenceForm",A,F)}),j.geometryGraph=w.getTreeView("#objectListLabel","#objectList",j.world),c.bindAction([],0,c.action.toggleObjectSelect.name,e=>{P.current===P.multi&&L();const t=new b.ToggleCheckbox(e.target),o=new b.GenericEditCommand(k(),k().selectObject,[j.currentObjects,e.target],k().undoSelectObject,[e.target]);o.doIt(),me([t,o])}),c.bindAction([],0,c.action.toggleObjectVisibility.name,e=>{const t=new b.ToggleCheckbox(e.target),o=new b.GenericEditCommand(k(),k().toggleObjectVisibility,[j.currentObjects,e.target],k().undoObjectVisibility);o.doIt(),me([t,o])}),c.bindAction([],0,c.action.toggleObjectLock.name,e=>{const t=new b.ToggleCheckbox(e.target),o=new b.GenericEditCommand(k(),k().toggleObjectLock,[j.currentObjects,e.target],k().undoToggleObjectLock);o.doIt(),me([t,o])}),c.bindAction([],0,c.action.toggleWireMode.name,e=>{const t=new b.ToggleCheckbox(e.target),o=new b.GenericEditCommand(k(),k().toggleObjectWireMode,[j.currentObjects,e.target.checked],k().undoToggleObjectWireMode);o.doIt(),me([t,o])}),n.bindMenuItem(c.action.objectDelete.name,e=>{const t=new f.DeleteBodyCommand(j.currentObjects);xe(t),t.doIt()}),n.bindMenuItem(c.action.objectDuplicate.name,e=>{const t=new f.DuplicateBodyCommand(j.currentObjects);xe(t),t.doIt()}),n.bindMenuItem(c.action.createGroup.name,e=>{const t=new g.PreviewGroup;t.name="new_folder";let o=j.currentParent;o||(o=j.world),o.insert(t),j.geometryGraph.addGroup(o.guiStatus.ul,t)}),n.bindMenuItem(c.action.createGroupWorld.name,e=>{const t=new g.PreviewGroup;t.name="new_folder";let o=j.world;o.insert(t),j.geometryGraph.addGroup(o.guiStatus.ul,t)}),j.imageList=w.getImageList("#imageListLabel","#imageList"),n.bindMenuItem(c.action.importImageFileGUI.name,function(e){n.openFile(function(e){j.imageList.loadImage(e)})}),n.bindMenuItem(c.action.showImage.name,function(e){j.imageList.showImage(j.currentObjects)}),n.bindMenuItem(c.action.deleteImage.name,function(e){j.imageList.deleteImage(j.currentObjects)}),j.materialList=w.getMaterialList("#materialListLabel","#materialList"),n.bindMenuItem(c.action.createMaterial.name,function(e){j.materialList.createMaterial(e)}),n.bindMenuItem(c.action.editMaterial.name,function(e){j.materialList.editMaterial(e,j.currentObjects)}),n.bindMenuItem(c.action.deleteMaterial.name,function(e){j.draftBench.isMaterialsInUse(j.currentObjects)?alert("Materials is in use"):j.materialList.deleteMaterial(j.currentObjects)}),n.bindMenuItem(c.action.renameMaterial.name,function(e){j.materialList.renameMaterial(e,j.currentObjects)}),n.bindMenuItem(c.action.duplicateMaterial.name,function(e){j.materialList.duplicateMaterial(j.currentObjects)}),n.bindMenuItem(c.action.assignMaterial.name,function(e){if(P.current===P.face){const e=new b.GenericEditCommand(k(),k().assignMaterial,[j.currentObjects[0]],k().undoAssignMaterial);xe(e),e.doIt()}else help("Cannot Assign Material without selecting Face")}),n.bindMenuItem(c.action.selectMaterial.name,function(e){const t=k().selectMaterialCmd([j.currentObjects[0]]);t.doIt(),xe(t)});let m=document.querySelectorAll("li.dropdown > a");for(let e of m){const t=e.getAttribute("data-menuid");if(t){let o=e.nextElementSibling;o&&o.classList.contains("popup")&&o.classList.contains("menu")&&n.bindMenuItem(t,function(e){n.queuePopupMenu(o)})}}m=document.querySelectorAll("li.dropside > a");for(let e of m){const t=e.id;if(t){e.setAttribute("data-menuid",t);let o=e.nextElementSibling;o&&o.classList.contains("popup")&&o.classList.contains("menu")&&n.bindMenuItem(t,function(e){n.toggleSubmenu(o),e.stopPropagation()})}}j.draftBench=new v.DraftBench(E.draftBench,E.draftBenchPref,j.materialList),document.addEventListener("keydown",function(e){x.runHotkeyAction(k(),e)}),s.gl.canvas.addEventListener("mouseenter",de,!1),s.gl.canvas.addEventListener("mousedown",ce,!1),s.gl.canvas.addEventListener("mouseup",ue,!1),s.gl.canvas.addEventListener("mouseleave",le,!1),s.gl.canvas.addEventListener("mousemove",he,!1),s.gl.canvas.addEventListener("wheel",ge,!1);let y={menu:document.querySelector("#create-context-menu")};s.gl.canvas.addEventListener("contextmenu",function(e){if(t=e,!(K.camera||K.mousemove||K.mouseSelect)||(t.preventDefault(),t.stopImmediatePropagation(),K.camera?(K.camera.undo(),K.camera=null,c.log(c.action.cameraModeExit,r.view),help("L:Select   M:Start Camera   R:Show Menu   [Alt]+R:Tweak menu")):K.mousemove?(K.mousemove.undo(),K.mousemove=null,i.needToRedraw()):(K.mouseSelect=null,i.needToRedraw()),0)){e.preventDefault();let t=k().getContextMenu();t&&t.menu||(t=y),n.positionDom(t.menu,n.getPosition(e)),n.showContextMenu(t.menu)}var t},!1),new a.a,requestAnimationFrame(function e(t){Fe(s.gl),requestAnimationFrame(e)})})},function(e,t,o){"use strict";o.r(t),o.d(t,"PreviewCage",function(){return f}),o.d(t,"CreatePreviewCageCommand",function(){return p}),o.d(t,"PreviewGroup",function(){return l});var n=o(17),i=o(12),r=o(1),s=o(0),a=o(5),c=o(6),d=o(21);const l=function(){this.group=[],this.parent=null,this.uuid=c.get_uuidv4(),this.guiStatus={},this.status={locked:!1,visible:!0,wireMode:!1},this._name=""};function u(e,t){return e+t.numberOfCage()}l.nameSetters=[],Object.defineProperty(l.prototype,"name",{get:function(){return this._name},set:function(e){if(""!==e){this._name=e;for(let t of l.nameSetters)t.call(this,e)}}}),l.prototype.insert=function(e){e.parent&&e.parent.remove(e),this.group.push(e),e.parent=this},l.prototype.remove=function(e){if(e.parent===this){const t=this.group.indexOf(e);if(t>=0)return this.group.splice(t,1),e.parent=null,e}return console.log("remove() integrity error"),null},l.prototype.numberOfCage=function(){return this.group.reduce(u,0)},l.prototype.getCage=function*(){for(let e of this.group)for(let t of e.getCage())yield t};class h{constructor(e){this.preview=e}allocVertex(...e){return this.preview.bench.allocVertex(...e)}allocEdge(...e){return this.preview.bench.allocEdge(...e)}allocPolygon(...e){const t=this.preview.bench.allocPolygon(...e);return this.preview.bench.boundingSpheres.length<this.preview.bench.faces.length&&this.preview.bench.boundingSpheres.push(n.BoundingSphere.allocate(t)),this.preview.insertFace(t),t}freeAll(e,t,o){this.preview.bench.freeAll(e,t,o)}freeVertex(e){this.preview.bench.alterVertex(),this.preview.bench.freeVertex(e)}freeHEdge(e){this.preview.bench.freeHEdge(e)}freePolygon(e){this.preview.removeFace(e),this.preview.bench.freePolygon(e)}getVertices(e){return this.preview.bench.getVertices(e)}clearAffected(){this.preview.bench.clearAffected()}addAffectedEdgeAndFace(...e){this.preview.bench.addAffectedEdgeAndFace(...e)}addAffectedWEdge(e){this.preview.bench.addAffectedWEdge(e)}addAffectedFace(e){this.preview.bench.addAffectedFace(e)}addAffectedVertex(e){this.preview.bench.addAffectedVertex(e)}}const f=function(e){this.parent=null,this.uuid=c.get_uuidv4(),this.geometry=new i.WingedTopology(new h(this)),this.bench=e,this.guiStatus={},this.status={locked:!1,visible:!0,wireMode:!1},this.selectedSet=new Set,this._name="",this.bvh={root:null,queue:new Set}};f.nameSetters=[],Object.defineProperty(f.prototype,"name",{get:function(){return this._name},set:function(e){this._name=e;for(let t of f.nameSetters)t.call(this,e)}}),f.prototype.numberOfCage=function(){return 1},f.prototype.getCage=function*(){yield this},f.prototype.removeFromParent=function(){return!!this.parent&&this.parent.remove(this)},f.prototype.freeBuffer=function(){this.bvh.root&&(this.bvh.root.free(),this.bvh.root=null),this.geometry.free()},f.prototype.initBVH=function(){const e=this.geometry.faces;let t,o;const i=vec3.create(),r=[];for(let n of e){const e=this.bench.boundingSpheres[n.index];if(r.push(e),vec3.add(i,i,e.center),t)for(let n=0;n<3;++n)t[n]<e.center[n]+e.radius?t[n]=e.center[n]+e.radius:o[n]>e.center[n]-e.radius&&(o[n]=e.center[n]-e.radius);else t=vec3.fromValues(e.center[0]+e.radius,e.center[1]+e.radius,e.center[2]+e.radius),o=vec3.fromValues(e.center[0]-e.radius,e.center[1]-e.radius,e.center[2]-e.radius)}vec3.scale(i,i,1/r.length);const s={center:i,halfSize:vec3.fromValues(Math.max(t[0]-i[0],i[0]-o[0]),Math.max(t[1]-i[1],i[1]-o[1]),Math.max(t[2]-i[2],i[2]-o[2]))};this.bvh.root&&this.bvh.root.free(),this.bvh.queue.clear(),this.bvh.root=new n.LooseOctree(this,s,0);for(let e of r)this.bvh.root.getBound(s),this.bvh.root.insert(e,s)},f.prototype.insertFace=function(e){const t=this.bench.boundingSpheres[e.index];t.octree?console.log("octree insert duplicated"):this.bvh.queue.add(t)},f.prototype.moveSphere=function(e){this.bvh.queue.add(e)},f.prototype.removeFace=function(e){const t=this.bench.boundingSpheres[e.index];t.octree?t.octree._remove(t):this.bvh.queue.delete(t)},f.prototype.updateBVH=function(){for(let e of this.bvh.queue)if(!this.bvh.root.isInside(e))return this.bvh.queue.clear(),void this.initBVH();const e={center:vec3.create(),halfSize:vec3.create()};for(let t of this.bvh.queue)this.bvh.root.getBound(e),this.bvh.root.insert(t,e);this.bvh.root.check(new Set),this.bvh.queue.clear()},f.prototype.rayPick=function(e){null===this.bvh.root?this.initBVH():this.updateBVH();var t,o=null,n=Number.POSITIVE_INFINITY;for(let i of this.bvh.root.intersectExtent(e))i.polygon.eachEdge(function(r){var s=c.intersectTriangle(e,[i.center,r.origin.vertex,r.destination().vertex]);0!=s&&s<n&&(n=s,o=r,t=i.center)});return o?{t:n,model:this,center:t,edge:o}:null},f.prototype.getSelectedSorted=function(){let e=Array.from(this.selectedSet);return e.sort((e,t)=>e.index-t.index),e},f.duplicate=function(e){const t=new Map,o=new f(e.bench),n=o.geometry;for(let o of e.geometry.vertices){const e=n.addVertex(o.vertex);t.set(o.index,e.index)}for(let o of e.geometry.faces){let e=[];o.eachVertex(function(o){e.push(t.get(o.index))}),n.addPolygon(e)}return o._updatePreviewAll(),o.name=e.name+"_copy1",o},f.prototype.merge=function(e){this.geometry.merge(function*(){for(let t of e)yield t.geometry}),this.selectedSet=new Set(function*(){for(let t of e)yield*t.selectedSet}())},f.prototype.separate=function(){const e=[],t=this.geometry.separateOut();let o=0;for(let n of t){const t=new f(this.bench);t.geometry=n,t.name=o>0?this.name+"_sep"+o.toString():this.name,o++,e.push(t)}return e},f.prototype.detachFace=function(e,t){const o=this.geometry.detachFace(e),n=new f(this.bench);return n.geometry.faces=e,n.geometry.edges=o.edges,n.geometry.vertices=o.vertices,n.name=this.name+"_cut"+t.toString(),n},f.prototype.setVisible=function(e){if(e){if(!this.status.visible)return this.status.visible=!0,this.bench.alterPreview(),!e}else if(this.status.visible)return this.status.visible=!1,this.bench.alterPreview(),!e;return null},f.prototype.toggleLock=function(e){if(e){if(!this.status.locked)return this.status.locked=!0,!e}else if(this.status.locked)return this.status.locked=!1,!e;return null},f.prototype.toggleWireMode=function(e){if(e){if(!this.status.wireMode)return this.status.wireMode=!0,this.bench.alterPreview(),!e}else if(this.status.wireMode)return this.status.wireMode=!1,this.bench.alterPreview(),!e;return null},f.prototype.isLock=function(){return this.status.locked},f.prototype.isVisible=function(){return this.status.visible},f.prototype.isWireMode=function(){return this.status.wireMode},f.prototype._getGeometrySize=function(){return{face:this.geometry.faces.size,edge:this.geometry.edges.size,vertex:this.geometry.vertices.size}},f.prototype._updatePreviewAll=function(){this.bench.updatePreview()},f.prototype.changeFromBodyToFaceSelect=function(){return this.snapshotSelectionBody()},f.prototype.changeFromBodyToEdgeSelect=function(){const e=this.snapshotSelectionBody();if(this.hasSelection()){this._resetSelectBody();for(let e of this.geometry.edges)this.selectedSet.add(e),this.bench.setEdgeColor(e,!0)}return e},f.prototype.changeFromBodyToVertexSelect=function(){const e=this.snapshotSelectionBody();if(this.hasSelection()){this._resetSelectBody();for(let e of this.geometry.vertices)this.selectedSet.add(e),this.setVertexColor(e,.25)}return e},f.prototype.changeFromBodyToMultiSelect=function(){const e=this.snapshotSelectionBody();return this.hasSelection()&&this._resetSelectBody(),e},f.prototype.restoreSelection=function(e,t){t._restoreSelection(this,e)},f.prototype.restoreFaceSelection=function(e){for(let t of e.selectedFaces)this.selectFace(t)},f.prototype.restoreEdgeSelection=function(e){for(let t of e.wingedEdges)this.selectEdge(t.left)},f.prototype.restoreVertexSelection=function(e){for(let t of e.vertices)this.selectVertex(t)},f.prototype.restoreBodySelection=function(e){e.body.size>0&&this.selectBody()},f.prototype.restoreFromBodyToFaceSelect=function(e){e?(this._resetSelectBody(),this.restoreFaceSelection(e)):this.changeFromBodyToFaceSelect()},f.prototype.restoreFromBodyToEdgeSelect=function(e){e?(this._resetSelectBody(),this.restoreEdgeSelection(e)):this.changeFromBodyToEdgeSelect()},f.prototype.restoreFromBodyToVertexSelect=function(e){e?(this._resetSelectBody(),this.restoreVertexSelection(e)):this.changeFromBodyToVertexSelect()},f.prototype.restoreFromBodyToMultiSelect=function(e){this.changeFromBodyToMutliSelect()},f.prototype._resetSelectBody=function(){const e=this.snapshotSelectionBody();return this.selectedSet=new Set,this.bench.resetBody(e.body),e},f.prototype._selectBodyLess=function(){const e=this.snapshotSelectionBody();return this.hasSelection()&&this.selectBody(),e},f.prototype._selectBodyAll=function(){const e=this.snapshotSelectionBody();return this.hasSelection()||this.selectBody(),e},f.prototype._selectBodyInvert=function(){const e=this.snapshotSelectionBody();return this.selectBody(),e},f.prototype.selectBody=function(){return this.hasSelection()?(this.bench.selectGroup(this.selectedSet,!1),this.selectedSet=new Set):(this.selectedSet=new Set(this.geometry.faces),this.bench.selectGroup(this.selectedSet,!0),geometryStatus(Object(d.i18n)("body_status",{name:this.name,polygonSize:this.geometry.faces.size,edgeSize:this.geometry.edges.size,vertexSize:this.geometry.vertices.size}))),this.hasSelection()},f.prototype.hiliteBody=function(e){this.bench.hiliteBody(this.geometry.faces,e)},f.prototype.hasSelection=function(){return this.selectedSet.size>0},f.prototype.selectionSize=function(){return this.selectedSet.size},f.prototype.snapshotSelection=function(){return new Set(this.selectedSet)},f.prototype.snapshotSelectionFace=function(){return{selectedFaces:new Set(this.selectedSet)}},f.prototype.snapshotSelectionEdge=function(){return{wingedEdges:new Set(this.selectedSet)}},f.prototype.snapshotSelectionVertex=function(){return{vertices:new Set(this.selectedSet)}},f.prototype.snapshotSelectionBody=function(){return{body:new Set(this.selectedSet)}},f.prototype.setVertexColor=function(e,t){this.bench.setVertexColor(e,t)},f.prototype.dragSelectVertex=function(e,t){if(this.selectedSet.has(e)){if(!1===t)return this.selectedSet.delete(e),this.setVertexColor(e,-.25),!0}else if(!0===t)return this.selectedSet.add(e),this.setVertexColor(e,.25),geometryStatus("select vertex: "+e.index),!0;return!1},f.prototype.selectVertex=function(e){var t,o;return this.selectedSet.has(e)?(this.selectedSet.delete(e),o=-.25,t=!1):(this.selectedSet.add(e),o=.25,t=!0,geometryStatus("select vertex: "+e.index)),this.setVertexColor(e,o),t},f.prototype._resetSelectVertex=function(){var e=this.snapshotSelectionVertex();return this.selectedSet=new Set,this.bench.resetSelectVertex(),e},f.prototype._selectVertexMore=function(){const e=this.snapshotSelectionVertex(),t=this;for(let o of e.vertices)o.eachInEdge(function(e){t.selectedSet.has(e.origin)||t.selectVertex(e.origin)});return e},f.prototype._selectVertexLess=function(){const e=this.snapshotSelectionVertex();for(let t of e.vertices)for(let o of t.oneRing())if(!e.vertices.has(o)){this.selectVertex(t);break}return e},f.prototype._selectVertexAll=function(){const e=this.snapshotSelectionVertex();for(let t of this.geometry.vertices)t.isLive()&&!e.vertices.has(t)&&this.selectVertex(t);return e},f.prototype._selectVertexInvert=function(){const e=this.snapshotSelectionVertex();for(let e of this.geometry.vertices)e.isLive()&&this.selectVertex(e);return e},f.prototype._selectVertexAdjacent=function(){return this._selectVertexMore()},f.prototype._selectVertexSimilar=function(){const e=this.snapshotSelectionVertex(),t=new SimilarVertex(e.vertices);for(let o of this.geometry.vertices)o.isLive()&&!e.vertices.has(o)&&t.find(o)&&this.selectVertex(o);return e},f.prototype.changeFromVertexToFaceSelect=function(){const e=this.snapshotSelectionVertex();var t=this,o=this._resetSelectVertex();for(let e of o.vertices)e.eachOutEdge(function(e){t.selectedSet.has(e.face)||t.selectFace(e.face)});return e},f.prototype.changeFromVertexToEdgeSelect=function(){const e=this.snapshotSelectionVertex();var t=this,o=this._resetSelectVertex();for(let e of o.vertices)e.eachOutEdge(function(e){t.selectedSet.has(e.wingedEdge)||t.selectEdge(e)});return e},f.prototype.changeFromVertexToBodySelect=function(){const e=this.snapshotSelectionVertex();return this.hasSelection()&&(this._resetSelectVertex(),this.selectBody()),e},f.prototype.changeFromVertexToMultiSelect=function(){const e=this.snapshotSelectionVertex();return this._resetSelectVertex(),e},f.prototype.restoreFromVertexToFaceSelect=function(e){e?(this._resetSelectVertex(),this.restoreFaceSelection(e)):this.changeFromVertexToFaceSelect()},f.prototype.restoreFromVertexToEdgeSelect=function(e){e?(this._resetSelectVertex(),this.restoreEdgeSelection(e)):this.changeFromVertexToEdgeSelect()},f.prototype.restoreFromVertexToBodySelect=function(e){e?(this._resetSelectVertex(),this.restoreBodySelection(e)):this.changeFromVertexToBodySelect()},f.prototype.restoreFromVertexToMultiSelect=function(e){this.changeFromVertexToMultiSelect()},f.prototype.changeFromMultiToEdgeSelect=function(){return{}},f.prototype.changeFromMultiToFaceSelect=function(){return{}},f.prototype.changeFromMultiToVertexSelect=function(){return{}},f.prototype.changeFromMultiToBodySelect=function(){return{}},f.prototype.restoreFromMultiToEdgeSelect=function(e){},f.prototype.restoreFromMultiToFaceSelect=function(e){},f.prototype.restoreFromMultiToVertexSelect=function(e){},f.prototype.restoreFromMultiToBodySelect=function(e){},f.prototype.dragSelectEdge=function(e,t){var o=e.wingedEdge;if(this.selectedSet.has(o)){if(!1===t)return this.selectedSet.delete(o),this.bench.selectEdge(o,!1),!0}else if(!0===t)return this.selectedSet.add(o),this.bench.selectEdge(o,!0),!0;return!1},f.prototype.selectEdge=function(e){var t,o=e.wingedEdge;return this.selectedSet.has(o)?(this.selectedSet.delete(o),-.25,t=!1):(this.selectedSet.add(o),.25,t=!0,geometryStatus("select edge: "+o.index)),this.bench.selectEdge(o,t),t},f.prototype.computeSnapshot=function(e){for(let t of e.faces){const e=this.bench.boundingSpheres[t.index];t.computeNormal(),e.setSphere(n.BoundingSphere.computeSphere(t,e.center))}this.bench.updateCentroid()},f.prototype.restoreMoveSelection=function(e){let t=0;for(let o of e.vertices)vec3.copy(o.vertex,e.position.subarray(t,t+3)),t+=3;this.bench.updatePosition(),this.computeSnapshot(e)},f.prototype.moveSelection=function(e,t){if(e.direction){let o=0;for(let n of e.vertices)vec3.scaleAndAdd(n.vertex,n.vertex,e.direction.subarray(o,o+3),t),o+=3}else for(let o of e.vertices)vec3.add(o.vertex,o.vertex,t);this.bench.updatePosition(),this.computeSnapshot(e)},f.prototype.rotateSelection=function(e,t,o){const n=vec3.create(),i=vec3.fromValues(1,1,1);this.transformSelection(e,(e,r)=>{mat4.fromRotationTranslationScaleOrigin(e,t,n,i,o||r)})},f.prototype.scaleSelection=function(e,t,o){const n=vec3.fromValues(o[0]?t*o[0]:1,o[1]?t*o[1]:1,o[2]?t*o[2]:1);this.transformSelection(e,(e,t)=>{mat4.fromScaling(e,n)})},f.prototype.transformSelection=function(e,t){const o=mat4.create(),n=e.vertices[Symbol.iterator]();for(let i of e.matrixGroup){t(o,i.center);for(let e=0;e<i.count;e++){const e=n.next().value;vec3.transformMat4(e.vertex,e.vertex,o)}}this.bench.updatePosition(),this.computeSnapshot(e)},f.prototype.snapshotPositionAll=function(){return this.snapshotPosition(this.geometry.vertices)},f.prototype.snapshotPosition=function(e,t){var o={faces:new Set,vertices:null,wingedEdges:new Set,position:null,direction:t};o.vertices=e;const n=e.length?e.length:e.size;o.position=new Float32Array(3*n);let i=0;for(let e of o.vertices)e.eachOutEdge(function(e){e.isNotBoundary()&&!o.faces.has(e.face)&&o.faces.add(e.face),o.wingedEdges.has(e.wingedEdge)||o.wingedEdges.add(e.wingedEdge)}),o.position.set(e.vertex,i),i+=3;return o},f.prototype.snapshotEdgePosition=function(){var e=new Set;for(let o of this.selectedSet)for(let n of o){var t=n.origin;e.has(t)||e.add(t)}return this.snapshotPosition(e)},f.prototype.snapshotFacePosition=function(){var e=new Set;for(let t of this.selectedSet)t.eachVertex(function(t){e.has(t)||e.add(t)});return this.snapshotPosition(e)},f.prototype.snapshotVertexPosition=function(){const e=new Set(this.selectedSet);return this.snapshotPosition(e)},f.prototype.snapshotBodyPosition=function(){let e=new Set;return this.hasSelection()&&(e=new Set(this.geometry.vertices)),this.snapshotPosition(e)},f.prototype.snapshotFacePositionAndNormal=function(){const e=new Set;let t=new Map;for(let o of this.selectedSet)o.eachVertex(function(n){if(e.has(n)){const e=t.get(n);vec3.dot(e,o.normal)<.999&&vec3.add(e,e,o.normal)}else{e.add(n);const i=[o.normal[0],o.normal[1],o.normal[2]];t.set(n,i)}});const o=new Float32Array(3*e.size);let n=0;for(let[e,i]of t){let e=o.subarray(n,n+3);vec3.copy(e,i),n+=3}return this.snapshotPosition(e,o)},f.prototype.snapshotVertexPositionAndNormal=function(){const e=new Set(this.selectedSet),t=new Float32Array(3*e.size);t.fill(0);let o=0;for(let n of e){let e=t.subarray(o,o+3);n.eachOutEdge(function(t){t.isNotBoundary()&&vec3.add(e,e,t.face.normal)}),vec3.normalize(e,e),o+=3}return this.snapshotPosition(e,t)},f.prototype.snapshotEdgePositionAndNormal=function(){const e=new Set,t=new Map;vec3.create();for(let o of this.selectedSet){const n=o.left.face,i=o.right.face;for(let r of o){let o,s=r.origin;e.has(s)?o=t.get(s):(e.add(s),o=new Set,t.set(s,o)),null!==n&&o.add(n),null!==i&&o.add(i)}}const o=new Float32Array(3*e.size);o.fill(0);let n=0;for(let[e,i]of t){let e=o.subarray(n,n+3);for(let t of i)vec3.add(e,e,t.normal);n+=3}return this.snapshotPosition(e,o)},f.prototype.snapshotTransformEdgeGroup=function(){const e=new Set,t=[];let o=this.geometry.findEdgeGroup(this.selectedSet);for(let n of o){let o=0;const i=vec3.create();for(let t of n)for(let n of t.eachVertex())e.has(n)||(e.add(n),o++,vec3.add(i,i,n.vertex));vec3.scale(i,i,1/o),t.push({center:i,count:o})}const n=this.snapshotPosition(e);return n.matrixGroup=t,n},f.prototype.snapshotTransformFaceGroup=function(){const e=new Set,t=[];let o=i.WingedTopology.findFaceGroup(this.getSelectedSorted());const n=vec3.create();for(let i of o){let o=0;vec3.set(n,0,0,0);for(let t of i)t.eachVertex(function(t){e.has(t)||(e.add(t),o++,vec3.add(n,n,t.vertex))});vec3.scale(n,n,1/o),t.push({center:n,count:o})}const r=this.snapshotPosition(e);return r.matrixGroup=t,r},f.prototype.snapshotTransformBodyGroup=function(){let e=new Set;const t=vec3.create();if(this.hasSelection()){for(let o of this.geometry.vertices)o.isLive()&&(e.add(o),vec3.add(t,t,o.vertex));vec3.scale(t,t,1/e.size)}const o=this.snapshotPosition(e);return o.matrixGroup=[{center:t,count:e.size}],o},f.prototype.snapshotTransformVertexGroup=function(){let e=new Set;const t=vec3.create();if(this.hasSelection()){for(let o of this.selectedSet)e.add(o),vec3.add(t,t,o.vertex);vec3.scale(t,t,1/e.size)}const o=this.snapshotPosition(e);return o.matrixGroup=[{center:t,count:e.size}],o},f.prototype._resetSelectEdge=function(){const e=this.snapshotSelectionEdge();return this.selectedSet=new Set,this.bench.resetSelectEdge(),e},f.prototype._selectEdgeMore=function(){const e=this.snapshotSelectionEdge();for(let t of e.wingedEdges)for(let e of t)e.eachEdge(e=>{this.selectedSet.has(e.wingedEdge)||this.selectEdge(e)});return e},f.prototype._selectEdgeLess=function(){const e=this.snapshotSelectionEdge();for(let t of e.wingedEdges)for(let o of t.oneRing())if(!e.wingedEdges.has(o)){this.selectEdge(t.left);break}return e},f.prototype._selectEdgeAll=function(){const e=this.snapshotSelectionEdge();for(let t of this.geometry.edges)t.isLive()&&!e.wingedEdges.has(t)&&this.selectEdge(t.left);return e},f.prototype._selectEdgeInvert=function(){const e=this.snapshotSelectionEdge();for(let e of this.geometry.edges)e.isLive()&&this.selectEdge(e.left);return e},f.prototype._selectEdgeAdjacent=function(){const e=this.snapshotSelectionEdge();for(let t of e.wingedEdges)for(let e of t.adjacent())this.selectedSet.has(e)||this.selectEdge(e.left);return e},f.prototype._selectEdgeSimilar=function(){const e=this.snapshotSelectionEdge(),t=new SimilarWingedEdge(e.wingedEdges);for(let o of this.geometry.edges)o.isLive&&!e.wingedEdges.has(o)&&t.find(o)&&this.selectEdge(o.left);return e},f.prototype.changeFromEdgeToFaceSelect=function(){const e=this.snapshotSelectionEdge(),t=this._resetSelectEdge();for(let e of t.wingedEdges)for(let t of e)this.selectedSet.has(t.face)||this.selectFace(t.face);return e},f.prototype.changeFromEdgeToVertexSelect=function(){const e=this.snapshotSelectionEdge(),t=this._resetSelectEdge();for(let e of t.wingedEdges)for(let t of e)this.selectedSet.has(t.origin)||this.selectVertex(t.origin);return e},f.prototype.changeFromEdgeToBodySelect=function(){const e=this.snapshotSelectionEdge();return this.hasSelection()&&(this._resetSelectEdge(),this.selectBody()),e},f.prototype.changeFromEdgeToMultiSelect=function(){const e=this.snapshotSelectionEdge();return this.hasSelection()&&this._resetSelectEdge(),e},f.prototype.restoreFromEdgeToFaceSelect=function(e){e?(this._resetSelectEdge(),this.restoreFaceSelection(e)):this.changeFromEdgeToFaceSelect()},f.prototype.restoreFromEdgeToVertexSelect=function(e){e?(this._resetSelectEdge(),this.restoreVertexSelection(e)):this.changeFromEdgeToVertexSelect()},f.prototype.restoreFromEdgeToBodySelect=function(e){e?(this._resetSelectEdge(),this.restoreBodySelection(e)):this.changeFromEdgeToBodySelect()},f.prototype.restoreFromEdgeToMultiSelect=function(e){this.changeFromEdgeToMultiSelect()},f.prototype.setFaceSelectionOff=function(e){this.bench.selectFace(e,!1),this.selectedSet.delete(e)},f.prototype.setFaceSelectionOn=function(e){this.bench.selectFace(e,!0),this.selectedSet.add(e)},f.prototype.dragSelectFace=function(e,t){if(this.selectedSet.has(e)){if(!1===t)return this.setFaceSelectionOff(e),!0}else if(!0===t)return this.setFaceSelectionOn(e),!0;return geometryStatus("polygon face # "+e.index),!1},f.prototype.selectFace=function(e){var t;return this.selectedSet.has(e)?(this.setFaceSelectionOff(e),s.log("faceSelectOff",e.index),t=!1):(this.setFaceSelectionOn(e),s.log("faceSelectOn",e.index),t=!0),geometryStatus("polygon face # "+e.index),t},f.prototype._resetSelectFace=function(){const e=this.snapshotSelectionFace();return this.selectedSet=new Set,this.bench.selectGroup(e.selectedFaces,!1),e},f.prototype._selectFaceMore=function(){const e=this.snapshotSelectionFace();for(let t of e.selectedFaces)for(let e of t.oneRing())null===e||this.selectedSet.has(e)||this.selectFace(e);return e},f.prototype._selectFaceLess=function(){const e=this.snapshotSelectionFace();for(let t of e.selectedFaces)for(let o of t.adjacent())if(!e.selectedFaces.has(o)){this.selectFace(t);break}return e},f.prototype._selectFaceAll=function(){const e=this.snapshotSelectionFace();for(let t of this.geometry.faces)t.isLive&&!e.selectedFaces.has(t)&&this.selectFace(t);return e},f.prototype._selectFaceInvert=function(){const e=this.snapshotSelectionFace();for(let e of this.geometry.faces)e.isLive()&&this.selectFace(e);return e},f.prototype._selectFaceAdjacent=function(){const e=this.snapshotSelectionFace();for(let t of e.selectedFaces)for(let e of t.adjacent())null===e||this.selectedSet.has(e)||this.selectFace(e);return e},f.prototype._selectFaceSimilar=function(){const e=this.snapshotSelectionFace(),t=new SimilarFace(e.selectedFaces);for(let o of this.geometry.faces)o.isLive()&&!e.selectedFaces.has(o)&&t.find(o)&&this.selectFace(o);return e},f.prototype.changeFromFaceToEdgeSelect=function(){const e=this.snapshotSelectionFace();var t=this,o=this._resetSelectFace();for(let e of o.selectedFaces)e.eachEdge(function(e){t.selectedSet.has(e.wingedEdge)||t.selectEdge(e)});return e},f.prototype.changeFromFaceToVertexSelect=function(){const e=this.snapshotSelectionFace();var t=this,o=this._resetSelectFace();for(let e of o.selectedFaces)e.eachVertex(function(e){t.selectedSet.has(e)||t.selectVertex(e)});return e},f.prototype.changeFromFaceToBodySelect=function(){const e=this.snapshotSelectionFace();return this.hasSelection()&&(this._resetSelectFace(),this.selectBody()),e},f.prototype.changeFromFaceToMultiSelect=function(){const e=this.snapshotSelectionFace();return this.hasSelection()&&this._resetSelectFace(),e},f.prototype.restoreFromFaceToEdgeSelect=function(e){e?(this._resetSelectFace(),this.restoreEdgeSelection(e)):this.changeFromFaceToEdgeSelect()},f.prototype.restoreFromFaceToVertexSelect=function(e){e?(this._resetSelectFace(),this.restoreVertexSelection(e)):this.changeFromFaceToVertexSelect()},f.prototype.restoreFromFaceToBodySelect=function(e){e?(this._resetSelectFace(),this.restoreBodySelection(e)):this.changeFromFaceToBodySelect()},f.prototype.restoreFromFaceToMultiSelect=function(e){this.changeFromFaceToMultiSelect()},f.prototype.extractFace=function(){var e=this.geometry.vertices.size,t=(this.geometry.edges.size,this.geometry.faces.size),o=this.geometry.extractPolygon(this.selectedSet);return this._resizeBoundingSphere(t),this._resizePreview(e,t),o},f.prototype.creaseEdge=function(){return this.extrudeEdge(!0)},f.prototype.extrudeEdge=function(e=!1){const t=this._getGeometrySize();let o=new Set,n=[];function i(e){for(let t of e.extrude)o.add(t.wingedEdge);for(let t of e.lift)n.push(t)}const r=vec3.create();let s=new Set,a=new Set,c=[],d=[],l=[],u=new Set;for(let e of this.selectedSet)for(let t of e){if(u.has(t))continue;let e=t.next;for(;e!==t;){if(!this.selectedSet.has(e.wingedEdge)){for(;!this.selectedSet.has(e.next.wingedEdge);)e=e.next;break}e=e.next}if(e===t){for(let e of t.face.hEdges())u.add(e);let o=this.geometry.liftCornerEdge(e);n.push(o.pair),i(this.geometry.extrudeEdge(o.pair,o))}else{t=e;do{let o=e;for(e=e.next;this.selectedSet.has(e.wingedEdge);)u.add(e),e=e.next;let i=!1,h=!1,f=e;if(a.has(e.pair)?a.delete(e.pair):f===f.pair.next.pair.next?i=!0:(vec3.lerp(r,e.origin.vertex,e.destination().vertex,.2),f=e=this.geometry.splitEdge(e,r),s.add(e),n.push(e.pair)),s.has(o.pair))s.delete(o.pair);else if(o===o.next.pair.next.pair)h=!0;else{vec3.lerp(r,o.origin.vertex,o.destination().vertex,.8);let e=this.geometry.splitEdge(o.pair,r).pair;a.add(e),n.push(e),o===t&&(t=e),o=e}let p={start:o,end:f};for(c.push(p),i&&d.push(p),h&&l.push(p);!this.selectedSet.has(e.next.wingedEdge);)e=e.next}while(e!==t)}}for(let e of d){let t=e.end;t.face.getCentroid(r),vec3.lerp(r,t.origin.vertex,r,.2);const o=this.geometry.addVertex(r);t=this.geometry._liftDanglingEdge(t.prev(),o),n.push(t.pair),e.end=t}for(let e of l){let t=e.start;t.face.getCentroid(r),vec3.lerp(r,t.destination().vertex,r,.2);const o=this.geometry.addVertex(r);t=this.geometry._liftDanglingEdge(t,o),n.push(t.pair),e.start=t.pair}for(let e of c){i(this.geometry.extrudeEdge(e.start,e.end))}for(let t of s){let i=t.pair;if(e){let e=i.next;const t=e.pair.next.pair;if(a.has(t)&&e.face.numberOfVertex>3&&e.pair.face.numberOfVertex>3){if(a.has(e.next.pair)&&s.has(e.pair.prev().pair)){vec3.lerp(r,e.origin.vertex,e.destination().vertex,.5);let t=this.geometry.splitEdge(e,r);n.push(t.pair),e=t}let t=this.geometry.insertEdge(e,i);o.add(t.wingedEdge),this.geometry.slideToNext(e.pair);continue}}for(;;){if(i=i.next.pair,a.has(i)){let e=this.geometry.insertEdge(i.pair,t.pair);o.add(e.wingedEdge);break}{vec3.lerp(r,i.destination().vertex,i.origin.vertex,.2);let e=this.geometry.splitEdge(i.pair,r);i=e.pair,n.push(i);let s=this.geometry.insertEdge(e,t.pair);o.add(s.wingedEdge)}t=i.pair}}return this._updatePreviewAll(t,this.geometry.affected),{collapsibleWings:o,liftEdges:n}},f.prototype.undoExtrudeEdge=function(e){const t=this._getGeometrySize();if(e.dissolveEdges)for(let t of e.dissolveEdges)t.wingedEdge.isLive()&&this.geometry.dissolveEdge(t,e.collapsibleWings);for(let t of e.liftEdges)this.geometry.collapseEdge(t,e.collapsibleWings);this._updatePreviewAll(t,this.geometry.affected)},f.prototype.extrudeVertex=function(){const e=this._getGeometrySize(),t=[],o=[],n=vec3.create();for(let e of this.selectedSet){let i,r=null,s=e.outEdge;do{vec3.lerp(n,s.origin.vertex,s.destination().vertex,.25);let e=this.geometry.splitEdge(s,n);if(t.push(e),s=e.pair.next,r){let t=this.geometry.insertEdge(r,e.next);o.push(t),r=t.next.pair}else i=e,r=e.next.pair}while(s!==i);let a=this.geometry.insertEdge(r,i.next);o.push(a)}return this._updatePreviewAll(e,this.geometry.affected),{insertEdges:o,splitEdges:t}},f.prototype.undoExtrudeVertex=function(e){const t=this._getGeometrySize();for(let t of e.insertEdges)this.geometry.removeEdge(t.pair);for(let t of e.splitEdges)this.geometry.collapseEdge(t.pair);this._updatePreviewAll(t,this.geometry.affected)},f.prototype.extrudeFace=function(e){const t=this._getGeometrySize();e||((e={}).edgeLoops=i.WingedTopology.findContours(this.selectedSet)),e.edgeLoops=this.geometry.liftContours(e.edgeLoops),e.extrudeEdges=this.geometry.extrudeContours(e.edgeLoops),this._updatePreviewAll(t,this.geometry.affected);const o=this._resetSelectFace();for(let e of o.selectedFaces)this.selectFace(e);return e},f.prototype.collapseExtrudeEdge=function(e){const t=e.extrudeEdges,o=new Set,i=this._getGeometrySize();for(let e of t)e.origin.eachOutEdge(function(e){o.add(e.face)}),this.geometry.collapseEdge(e);this._updatePreviewAll(i,this.geometry.affected);const r=this._resetSelectFace();for(let e of r.selectedFaces)this.selectFace(e);for(let e of o)if(e.isLive()){const t=this.bench.boundingSpheres[e.index];t.setSphere(n.BoundingSphere.computeSphere(e,t.center))}this.bench.updateCentroid()},f.prototype.findExtFaceContours=function(){const e=new Set,t=new Set,o=[];for(let n of this.selectedSet)for(let i of n.hEdges()){let n=i.pair;if(!e.has(n)&&!this.selectedSet.has(n.face)){const i=[];let r=n;do{i.push(r),e.add(r);let o=!0;for(;!this.selectedSet.has(r.next.pair.face);)r=r.next.pair,o=!1;o&&t.add(r.face),r=r.next}while(r!==n);o.push(i)}}return{contourLoops:o,cornerFaces:t}},f.prototype.bumpFace=function(){const e=this._getGeometrySize(),t=this.findExtFaceContours().contourLoops,o=vec3.create(),n=new Map;let i=new Set,r=new Set,s=new Set,a=this;function c(e,t){let o=a.geometry.insertEdge(e,t);i.add(o.wingedEdge),r.add(o.pair)}for(let e of t){let t=null,r=null,a=e[e.length-1];for(let d of e){let e=a.next;if(e!==d)do{let a=e;if(i.has(e.next.wingedEdge)||s.has(e.next))if(r)e.next.next!==r&&c(a,r);else if(null===t)t=e;else{n.get(e.face).add(e)}else if(vec3.lerp(o,e.origin.vertex,e.destination().vertex,.5),a=this.geometry.splitEdge(e,o),s.add(a.pair),r)c(a,r);else if(null===t)t=a;else{n.get(a.face).add(a)}r=a.pair,e=a.pair.next}while(e!==d);else{n.has(e.face)||n.set(e.face,new Set);const o=n.get(e.face);r&&(o.add(r.prev()),r=null),o.add(a),null===t&&(t=void 0)}a=d}if(r){if(n.has(r.face)){n.get(r.face).add(r.prev())}t&&t.next.next!==r&&c(t,r)}}for(let[e,t]of n){const o=this.geometry.insertFan(e,t);for(let e of o)i.add(e.wingedEdge),r.add(e)}return this._updatePreviewAll(e,this.geometry.affected),{liftEdges:s,collapsibleWings:i,dissolveEdges:r}},f.prototype.cutEdge=function(e){const t=this.selectedSet,o=this._getGeometrySize(),n=[],i=[];let r=vec3.create(),s=vec3.create();for(let o of t){let t=o.left;vec3.sub(r,t.origin.vertex,t.destination().vertex);for(let o=1;o<e;++o){const a=(e-o)/e;vec3.scale(s,r,a),vec3.add(s,t.destination().vertex,s);const c=this.geometry.splitEdge(t,s);n.push(t.origin),i.push(c.pair)}}return this._updatePreviewAll(o,this.geometry.affected),{vertices:n,halfEdges:i}},f.prototype.collapseSplitOrBevelEdge=function(e){const t=this._getGeometrySize();for(let t of e.halfEdges)t.wingedEdge.isLive()&&this.geometry.collapseEdge(t,e.collapsibleWings);this._updatePreviewAll(t,this.geometry.affected)},f.prototype.connectVertex=function(){const e=this._getGeometrySize(),t=this.geometry.connectVertex(this.selectedSet),o=[];for(let e of t)o.push(e.wingedEdge);return this._updatePreviewAll(e,this.geometry.affected),{halfEdges:t,wingedEdges:o}},f.prototype.dissolveConnect=function(e){const t=e.halfEdges,o=this._getGeometrySize();for(let e=t.length-1;e>=0;--e){const o=t[e];this.geometry.removeEdge(o.pair)}this._updatePreviewAll(o,this.geometry.affected)},f.prototype.dissolveSelectedEdge=function(){const e=[],t=this._getGeometrySize();for(let t of this.selectedSet){let o=this.geometry.dissolveEdge(t.left),n={halfEdge:t.left,undo:o};e.push(n)}return this.selectedSet.clear(),this._updatePreviewAll(t,this.geometry.affected),e},f.prototype.reinsertDissolveEdge=function(e){const t=this._getGeometrySize();for(let t=e.length-1;t>=0;--t){let o=e[t];this.geometry.restoreDissolveEdge(o.undo),this.selectEdge(o.halfEdge)}this._updatePreviewAll(t,this.geometry.affected)},f.prototype.collapseSelectedEdge=function(){const e=[],t=[],o=this._getGeometrySize(),n=new Map;for(let e of this.selectedSet){let o=null;if(e.isLive()){let t,i=e.left.origin;n.has(i)?(t=n.get(i),n.delete(i),vec3.add(t.pt,t.pt,i.vertex),t.count++):(t={pt:new Float32Array(3),count:1},vec3.copy(t.pt,i.vertex));let r=e.right.origin;if(n.has(r)){const e=n.get(r);vec3.add(e.pt,t.pt,e.pt),e.count+=t.count}else n.set(r,t);o=this.geometry.collapseEdge(e.left)}let i={halfEdge:e.left,undo:o};t.push(i)}this.selectedSet.clear();const i=[];for(let[t,o]of n){i.push(t);const n=new Float32Array(3);vec3.copy(n,t.vertex),e.push({vertex:t,savePt:n}),vec3.add(o.pt,o.pt,n),vec3.scale(o.pt,o.pt,1/(o.count+1)),vec3.copy(t.vertex,o.pt),this.geometry.addAffectedEdgeAndFace(t)}return this._updatePreviewAll(o,this.geometry.affected),{collapse:{edges:t,vertices:e},vertices:i}},f.prototype.restoreCollapseEdge=function(e){const t=e.collapse,o=this._getGeometrySize();this.selectedSet.clear();const n=t.edges;for(let e=n.length-1;e>=0;--e){let t=n[e];t.undo&&this.geometry.restoreCollapseEdge(t.undo)}for(let e of n)this.selectEdge(e.halfEdge);const i=t.vertices;for(let e of i)vec3.copy(e.vertex.vertex,e.savePt),this.geometry.addAffectedEdgeAndFace(e.vertex);this._updatePreviewAll(o,this.geometry.affected)},f.prototype.dissolveSelectedFace=function(){const e=this._getGeometrySize(),t=new Set;for(let e of this.selectedSet)e.eachEdge(function(e){t.add(e.wingedEdge)});const o=i.WingedTopology.findContours(this.selectedSet);for(let e of o)for(let o of e){let e=o.outer;t.has(e.wingedEdge)&&t.delete(e.wingedEdge)}const n=[];for(let e of t)n.unshift(this.geometry.dissolveEdge(e.left));const r=this.selectedSet,s=new Set;for(let e of this.selectedSet)e.isLive()&&s.add(e);return this.selectedSet=s,this._updatePreviewAll(e,this.geometry.affected),{edges:n,selection:r}},f.prototype.undoDissolveFace=function(e){const t=this._getGeometrySize();for(let t of e.edges)t();this.selectedSet.clear();for(let t of e.selection)this.selectFace(t);this._updatePreviewAll(t,this.geometry.affected)},f.prototype.collapseSelectedFace=function(){const e=this.selectedSet;this.changeFromFaceToEdgeSelect();const t=this.collapseSelectedEdge();return t.selectedFaces=e,t},f.prototype.undoCollapseFace=function(e){this.restoreCollapseEdge(e)},f.prototype.dissolveSelectedVertex=function(){const e=this._getGeometrySize(),t={array:[],selectedFaces:[]};for(let e of this.selectedSet){let o=this.geometry.dissolveVertex(e);t.array.unshift(o),t.selectedFaces.push(o.polygon)}return this._resetSelectVertex(),this._updatePreviewAll(e,this.geometry.affected),t},f.prototype.undoDissolveVertex=function(e){const t=this._getGeometrySize();for(let t of e.array)this.geometry.restoreDissolveVertex(t),this.selectVertex(t.vertex);this._updatePreviewAll(t,this.geometry.affected)},f.prototype.bevelEdge=function(){const e=this._getGeometrySize(),t=this.selectedSet,o=this.geometry.bevelEdge(t);o.wingedEdges=new Set,o.faces=new Set;for(let e of o.vertices)for(let t of e.edgeRing())o.wingedEdges.add(t.wingedEdge),o.faces.add(t.face);return this._updatePreviewAll(e,this.geometry.affected),o},f.prototype.bevelFace=function(){const e=this._getGeometrySize(),t=this.selectedSet;let o=new Set;for(let e of t)for(let t of e.hEdges())o.add(t.wingedEdge);const n=this.geometry.bevelEdge(o);n.wingedEdges=new Set,n.faces=new Set;for(let e of n.vertices)for(let t of e.edgeRing())n.wingedEdges.add(t.wingedEdge),n.faces.add(t.face);this._updatePreviewAll(e,this.geometry.affected);const i=this._resetSelectFace();for(let e of i.selectedFaces)this.selectFace(e);return n},f.prototype.bevelVertex=function(){const e=this._getGeometrySize(),t=this.selectedSet,o=this.geometry.bevelVertex(t);o.wingedEdges=new Set,o.faces=new Set;for(let e of o.vertices)for(let t of e.edgeRing())o.wingedEdges.add(t.wingedEdge),o.faces.add(t.face);return this._updatePreviewAll(e,this.geometry.affected),o},f.prototype.edgeLoop=function(e){let t=0;const o=new Set(this.selectedSet),n=[];for(let i of o)for(let o of i){for(;(o=o.next.pair.next)&&!this.selectedSet.has(o.wingedEdge)&&4===o.destination().numberOfEdge();)++t%e==0&&(this.selectEdge(o),n.push(o))}return n},f.prototype.edgeRing=function(e){let t=0;const o=new Set(this.selectedSet),n=[];for(let i of o)for(let o of i){for(;(o=o.pair.next.next)&&!this.selectedSet.has(o.wingedEdge)&&o.next.next.next.next===o;)++t%e==0&&(this.selectEdge(o),n.push(o))}return n},f.prototype.bridge=function(e,t){if(2===this.selectedSet.size){const o=this._getGeometrySize(),n=(this.bench.boundingSpheres[e.index],this.bench.boundingSpheres[t.index],vec3.create()),i=this.geometry.bridgeFace(e,t,n);return i.selectedFaces=this.selectedSet,this._resetSelectFace(),this._updatePreviewAll(o,this.geometry.affected),i}return null},f.prototype.undoBridge=function(e){if(e){const t=this._getGeometrySize();this.geometry.undoBridgeFace(e),this._updatePreviewAll(t,this.geometry.affected)}},f.prototype.insetFace=function(){const e=this._getGeometrySize(),t={};t.edgeLoops=this.geometry.findInsetContours(this.selectedSet),t.edgeLoops=this.geometry.liftContours(t.edgeLoops),t.extrudeEdges=this.geometry.extrudeContours(t.edgeLoops);let o=0;for(let e of this.selectedSet)o+=e.numberOfVertex;t.vertices=[],t.faces=new Set,t.wingedEdges=new Set,t.position=new Float32Array(3*o),t.direction=new Float32Array(3*o),t.vertexLimit=Number.MAX_SAFE_INTEGER;let n=0;for(let e of this.selectedSet){let o=null;t.faces.add(e);for(let i of e.hEdges()){t.vertices.push(i.origin),t.faces.add(i.pair.face),t.wingedEdges.add(i.wingedEdge),t.wingedEdges.add(i.pair.next.wingedEdge);let e=t.position.subarray(n,n+3),r=t.direction.subarray(n,n+3);n+=3,vec3.copy(e,i.origin.vertex),o||(o=i.prev()),vec3.scale(r,i.destination().vertex,.5),vec3.scaleAndAdd(r,r,o.origin.vertex,.5),vec3.sub(r,r,i.origin.vertex);const s=vec3.length(r);s<t.vertexLimit&&(t.vertexLimit=s),vec3.normalize(r,r),o=i}}this._updatePreviewAll(e,this.geometry.affected);const i=this._resetSelectFace();for(let e of i.selectedFaces)this.selectFace(e);return t},f.prototype.invertBody=function(){this.geometry.invert()},f.prototype.flipBodyAxis=function(e,t){this.geometry.flip(e,t),this.geometry.invert()},f.prototype.bodyCentroid=function(){const e=vec3.create();let t=0;for(let o of this.geometry.vertices)vec3.add(e,e,o.vertex),++t;return t>0&&vec3.scale(e,e,1/t),e},f.prototype.weldableVertex=function(e){if(1==this.selectedSet.size){const t=this.selectedSet.values().next().value.outEdge;let o=t;do{if(o.destination()===e)return o;o=o.pair.next}while(o!==t)}return!1},f.prototype.weldVertex=function(e){this.selectVertex(e.origin),this.selectVertex(e.destination());let t=this.geometry.collapseEdge(e);return this._updatePreviewAll(),t},f.prototype.undoWeldVertex=function(e){this.geometry.restoreCollapseEdge(e),this.selectVertex(e.hEdge.destination()),this.selectVertex(e.hEdge.origin),this._updatePreviewAll()},f.prototype.intrudeFace=function(){const e={};if(0==this.selectedSet.size)return e;e.dissolve=this.dissolveSelectedFace();const t=new Map,o=e=>{let o=t.get(e);return o||(o=this.geometry.addVertex(e.vertex),t.set(e,o)),o.index},n=[],i=[],r=Array.from(this.geometry.faces);for(let e of r){const t=[];for(let n of e.hEdges())t.push(o(n.origin));if(this.selectedSet.has(e)){let o,n,r=0;for(let s of e.hEdges()){const e=s.origin.index,a=t[r];r>0&&i.push([o,e,a,n]),++r,o=e,n=a}i.push([o,e.halfEdge.origin.index,t[0],n])}else t.reverse(),n.push(this.geometry.addPolygon(t))}this._updatePreviewAll(),e.holed=this.holeSelectedFace();for(let e of n)this.selectFace(e);e.invert=n,e.connect=[];for(let t of i)e.connect.push(this.geometry.addPolygon(t));return this._updatePreviewAll(),e},f.prototype.undoIntrudeFace=function(e){for(let t of e.connect)this.geometry.makeHole(t);for(let t of e.invert)this.selectFace(t);const t=new Set;for(let o of e.invert){for(let e of o.hEdges())this.geometry._freeVertex(e.origin),t.add(e.wingedEdge);this.geometry._freePolygon(o)}for(let e of t)this.geometry._freeEdge(e.left);this.undoHoleSelectedFace(e.holed),this.undoDissolveFace(e.dissolve)},f.prototype.holeSelectedFace=function(){const e=new Set(this.selectedSet),t=[];for(let o of e)this.selectFace(o),t.push(this.geometry.makeHole(o));return t},f.prototype.undoHoleSelectedFace=function(e){for(let t of e){const e=this.geometry.undoHole(t);this.selectFace(e)}},f.prototype.loopCut=function(){const e=new Set(this.geometry.faces);let t;const o=n=>{t.add(n),e.delete(n);for(let t of n.hEdges())!this.selectedSet.has(t.wingedEdge)&&e.has(t.pair.face)&&o(t.pair.face)};let n=[];for(let i of this.selectedSet)for(let r of i)e.has(r.face)&&(t=new Set,o(r.face),n.push(t));if(n.length<2)return geometryStatus("less than 2 partitions"),!1;n=n.sort((e,t)=>e.size-t.size);const r=new Set(this.selectedSet);for(let e of r)this.selectEdge(e.left);const s={separateCages:[],fillFaces:[],contourLoops:[],selectedSet:r},a=new Set;for(let e=0;e<n.length;++e){const t=n[e];let o=[],r=this;if(e!==n.length-1){let n=i.WingedTopology.findContours(t);for(let i of n)if(i.length>0&&!a.has(i[0].outer.face)){this.geometry.liftContour(i);const n=this.geometry._createPolygon(i[0].outer,i.size);o.push(n),r=this.detachFace(t,e),s.contourLoops.push(i)}}for(let e of a)r.geometry.faces.has(e)&&(r.selectedSet.add(e),a.delete(e));r.dissolveSelectedFace(),s.fillFaces=s.fillFaces.concat(Array.from(r.selectedSet)),r.selectedSet=new Set;for(let e of o)a.add(e);r!==this&&s.separateCages.push(r)}return s},f.prototype.undoLoopCut=function(e){this.merge(e.separateCages);for(let t of e.fillFaces)this.geometry.removePolygon(t);for(let t of e.contourLoops)this.geometry.weldContour(t);for(let t of e.selectedSet)this.selectEdge(t.left)},f.prototype._putOn=function(e){let t=this.selectedSet.values().next().value;const o=this.bench.boundingSpheres[t.index].center,n=vec3.create();vec3.copy(n,t.normal),vec3.negate(n,n);const i=mat4.create();c.rotationFromToVec3(i,n,e.normal);const r=mat4.create();mat4.fromTranslation(r,e.center),mat4.mul(r,r,i),vec3.negate(o,o);const s=mat4.create();mat4.fromTranslation(s,o),mat4.mul(r,r,s);for(let e of this.geometry.vertices)vec3.transformMat4(e.vertex,e.vertex,r),this.geometry.addAffectedVertex(e),this.geometry.addAffectedEdgeAndFace(e);for(let e of this.geometry.faces)vec3.transformMat4(e.normal,e.normal,i);this._updatePreviewAll()},f.prototype.putOnVertex=function(e){const t=vec3.create();e.getNormal(t),this._putOn({normal:t,center:e.vertex})},f.prototype.putOnEdge=function(e){const t=vec3.create();e.wingedEdge.getNormal(t);const o=vec3.create();vec3.add(o,e.origin.vertex,e.destination().vertex),vec3.scale(o,o,.5),this._putOn({normal:t,center:o})},f.prototype.putOnFace=function(e){const t=e.normal,o=this.bench.boundingSpheres[e.index].center;this._putOn({normal:t,center:o})},f.prototype.getSelectedFaceContours=function(){let e={};e.edgeLoops=i.WingedTopology.findContours(this.selectedSet),e.edges=new Set;for(let t of e.edgeLoops)for(let o of t)e.edges.add(o.outer.wingedEdge);return e},f.prototype.liftFace=function(e,t){e.edgeLoops=this.geometry.liftContours(e.edgeLoops),e.extrudeEdges=this.geometry.extrudeContours(e.edgeLoops),this._updatePreviewAll();const o=e.extrudeEdges.length;for(let n=0;n<o;++n){const i=e.extrudeEdges[n];if(i.next.wingedEdge===t.wingedEdge){this.geometry.collapseEdge(i),n===o-1?(this.geometry.collapseEdge(e.extrudeEdges[0]),e.extrudeEdges=e.extrudeEdges.slice(1,o-1)):(this.geometry.collapseEdge(e.extrudeEdges[n+1]),e.extrudeEdges.splice(n,2));break}}this._updatePreviewAll();const n=this._resetSelectFace();for(let e of n.selectedFaces)this.selectFace(e);return e},f.prototype.mirrorFace=function(){const e=this.getSelectedSorted(),t=mat4.create(),o=new Set,n=new Set,i=new Map;function r(e){i.clear();for(let t of e.hEdges())i.set(t.origin,t.origin),o.add(t.origin),n.add(t.wingedEdge);c.reflectionMat4(t,e.normal,e.halfEdge.origin.vertex)}const s=e=>{let o=i.get(e);return o||(o=this.geometry.addVertex(e.vertex),vec3.transformMat4(o.vertex,o.vertex,t),i.set(e,o)),o.index},a=Array.from(this.geometry.faces),d=[];for(let t of e){r(t);const e=[];for(let o of a)if(o!==t){const t=[];for(let e of o.hEdges())t.push(s(e.origin));t.reverse(),e.push(t)}d.push(e)}this._updatePreviewAll();const l=[];for(let t=0;t<e.length;++t){const o=e[t];this.selectFace(o);const n=this.geometry.makeHole(o),i=d[t],r=[];for(let e of i)r.push(this.geometry.addPolygon(e));l.push({holed:n,newMirrors:r})}return this._updatePreviewAll(),{mirrorGroups:l,protectVertex:o,protectWEdge:n}},f.prototype.undoMirrorFace=function(e){for(let t of e.mirrorGroups){const o=new Set;for(let n of t.newMirrors){for(let t of n.hEdges())e.protectVertex.has(t.origin)||this.geometry._freeVertex(t.origin),e.protectWEdge.has(t.wingedEdge)?t.next=t.next.pair.next:o.add(t.wingedEdge);this.geometry._freePolygon(n)}for(let e of o)this.geometry._freeEdge(e.left);this.undoHoleSelectedFace([t.holed])}this._updatePreviewAll()},f.prototype.cornerEdge=function(){const e=this.getSelectedSorted(),t=[],o=[],n=[],i=[],r=vec3.create();for(let s of e){let e,a=s.left;if(a.face&&(5==a.face.numberOfVertex?(e=s.right).face&&3!==e.face.numberOfVertex&&(e=null):3===a.face.numberOfVertex&&(e=a,(a=s.right).face&&5!==a.face.numberOfVertex&&(a=null))),e&&a){t.push(e.face),t.push(a.face),vec3.add(r,e.origin.vertex,a.origin.vertex),vec3.scale(r,r,.5);let s=this.geometry.splitEdge(a,r);o.push(a.origin),n.push(s.pair);let c=this.geometry.insertEdge(s,a.next.next.next);i.push(c.pair),t.push(c.face)}}let s=0,a=new Float32Array(3*i.length);for(let e of i){const t=a.subarray(s,s+3);vec3.sub(t,e.origin.vertex,e.destination().vertex),vec3.normalize(t,t),s+=3}const c=this.snapshotPosition(o,a);this._updatePreviewAll();for(let e of n)this.selectEdge(e);return c.splitEdges=n,c.dissolveEdges=i,c},f.prototype.undoCornerEdge=function(e){for(let t of e.dissolveEdges)this.geometry.removeEdge(t);for(let t of e.splitEdges)this.selectEdge(t),this.geometry.collapseEdge(t);this._updatePreviewAll()},f.prototype.slideEdge=function(){const e=this.snapshotSelectionEdge(),t=[[0,0,1],[0,1,0],[1,0,0],[0,0,-1],[0,-1,0],[-1,0,0]],o=new Map,n=vec3.create();for(let i of e.wingedEdges)for(let e of i){let i=o.get(e.origin);i||(i={positive:vec3.create(),negative:vec3.create()},o.set(e.origin,i));const r=e.prev(),s=e.pair.next;let a,d;c.computeEdgeNormal(n,s,r.pair);for(let e=0;e<6;++e){let o=t[e],i=vec3.dot(o,n);0===e?(a=i,d=0):a<i&&(a=i,d=e)}d>2?(vec3.sub(n,e.origin.vertex,r.origin.vertex),vec3.add(i.negative,i.negative,n),vec3.sub(n,s.destination().vertex,s.origin.vertex),vec3.add(i.positive,i.positive,n)):(vec3.sub(n,r.origin.vertex,e.origin.vertex),vec3.add(i.positive,i.positive,n),vec3.sub(n,s.origin.vertex,s.destination().vertex),vec3.add(i.negative,i.negative,n))}let i=0;const r=[],s=new Float32Array(3*o.size),a=new Float32Array(3*o.size);for(const[e,t]of o){r.push(e);const o=s.subarray(i,i+3);vec3.copy(o,t.positive),vec3.normalize(o,o);const n=a.subarray(i,i+3);vec3.copy(n,t.negative),vec3.normalize(n,n),i+=3}const d=this.snapshotPosition(r,s);return d.directionPositive=s,d.directionNegative=a,d},f.prototype.positiveDirection=function(e){e.direction=e.directionPositive},f.prototype.negativeDirection=function(e){e.direction=e.directionNegative},f.prototype.flattenEdge=function(e){const t=this.snapshotEdgePosition(),o=vec3.create(),n=new Set,i=this.geometry.findEdgeGroup(this.getSelectedSorted());for(let t of i){n.clear(),vec3.set(o,0,0,0);for(let e of t)for(let t of e)n.has(t.origin)||(vec3.add(o,o,t.origin.vertex),n.add(t.origin),this.geometry.addAffectedEdgeAndFace(t.origin));vec3.scale(o,o,1/n.size),c.projectVec3(n,e,o)}return this._updatePreviewAll(),t},f.prototype.flattenFace=function(e){const t=this.snapshotFacePosition(),o=i.WingedTopology.findFaceGroup(this.getSelectedSorted()),n=vec3.create(),r=new Set;let s=e;e||(s=vec3.create());for(let t of o){r.clear(),vec3.set(n,0,0,0);for(let o of t){for(let e of o.hEdges())r.has(e.origin)||(r.add(e.origin),vec3.add(n,n,e.origin.vertex),this.geometry.addAffectedEdgeAndFace(e.origin));e||vec3.add(s,s,o.normal)}vec3.scale(n,n,1/r.size),e||vec3.normalize(s,s),c.projectVec3(r,s,n)}return this._updatePreviewAll(),t},f.prototype.flattenVertex=function(e){if(this.selectedSet.size>1){const t=this.getSelectedSorted(),o=this.snapshotVertexPosition(),n=vec3.create();for(let e of t)vec3.add(n,n,e.vertex),this.geometry.addAffectedEdgeAndFace(e);return vec3.scale(n,n,1/t.length),c.projectVec3(t,e,n),this._updatePreviewAll(),o}return null},f.prototype.planeCuttableFace=function(e){for(let t of this.bvh.root.intersectBound(e))if(this.selectedSet.has(t.polygon))for(let o of t.polygon.hEdges()){const t=c.intersectPlaneHEdge(null,e,o);if(t>0&&t<1)return!0}return!1},f.prototype._planeCutFace=function(e){const t=new Set,o=[],n=vec3.create();for(let i of e){const e=[];for(let t of this.bvh.root.intersectBound(i))this.selectedSet.has(t.polygon)&&e.push(t.polygon);e.sort((e,t)=>e.index-t.index);const r=[],s=new Set;for(let t of e)for(let e of t.hEdges())s.has(e.wingedEdge)||(r.push(e),s.add(e.wingedEdge));for(let e of r){const r=c.intersectPlaneHEdge(n,i,e);if(0==r)t.add(e.origin);else if(r>0&&r<1){let i=this.geometry.splitEdge(e,n);o.push(i.pair),t.add(e.origin)}}}return this._updatePreviewAll(),{selectedFaces:this.selectedSet,vertices:t,halfEdges:o}},f.prototype.planeCutFace=function(e){return this._planeCutFace([e])},f.prototype.planeCutBody=function(e){const t=this._planeCutFace([e]);return{body:t.selectedFaces,vertices:t.vertices,halfEdges:t.halfEdges}},f.prototype.sliceBody=function(e,t){const o=vec3.fromValues(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),i=vec3.fromValues(Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE);this.geometry.getExtent(o,i);const r=vec3.create();vec3.sub(r,i,o);const s=[],a=vec3.create(),c=t-1;for(let t=1;t<=c;++t)vec3.lerp(a,o,i,t/(c+1)),s.push(new n.Plane(e,a));const d=this._planeCutFace(s);return{body:d.selectedFaces,vertices:d.vertices,halfEdges:d.halfEdges}},f.prototype.getBodySelection=function(e,t){this.geometry.getExtent(t.min,t.max);for(let t of this.selectedSet)e.push(this.bench.boundingSpheres[t.index])},f.prototype.makeHolesFromBB=function(e){const t=[];for(let o of e)this.selectedSet.delete(o.polygon),t.unshift(this.geometry.makeHole(o.polygon));return t},f.findWeldContours=function(e){const t=new Map,o=[];function n(e,n){let i;return e.cage===n.cage?t.has(e.cage)?i=t.get(e.cage):(i=[],o.push(i),i.push(e.cage),o.set(e.cage,i),o.set(n.cage,i)):t.has(e.cage)?(i=t.get(e.cage),t.has(n.cage)||(t.set(n.cage,i),i.push(n.cage))):t.has(n.cage)?(i=t.get(n.cage),t.set(e.cage,i),i.push(e.cages),loopUse.push()):(i=[],o.push(i),i.push(e.cage,n.cage),t.set(e.cage,i),t.set(n.cage,i)),i}const r=[],s=new Map,a=i.WingedTopology.findContours(e.selection);for(let t of a){const o=e.pair.get(t[0].outer),i=e.pair.get(o.hEdge);if(s.has(o.hEdge)){if(s.get(o.hEdge).length!==t.length)return!1;for(let o=0;o<t.length;++o){let n=e.pair.get(t[o].outer);if(!e.pair.has(n.hEdge))return!1;t[o].inner=n.hEdge.pair}r.push({combine:n(o,i),edgeLoop:t})}else for(let e=0;e<t.length;++e){const o=t[e].outer;s.set(o,t)}}return{combineCages:o,edgeLoops:r}},f.weldableFace=function(e,t,o){if(e.polygon.numberOfVertex!==t.polygon.numberOfVertex)return!1;if(vec3.dot(e.polygon.normal,t.polygon.normal)>0)return!1;const n=o*o;if(vec3.sqrDist(e.center,t.center)>n)return!1;if(Math.abs(e.radius-t.radius)>o)return!1;const i=[];for(let e of t.polygon.hEdges())i.unshift(e);for(let t of e.polygon.hEdges())for(let e=0;e<i.length;++e){let o=t,r=i[e],s=[],a=e;do{if(vec3.sqrDist(o.origin.vertex,r.destination().vertex)>n){s=void 0;break}s.push({target:o,source:r}),o=o.next,r=i[a=++a%i.length]}while(o!==t);if(s)return s}return!1},f.findOverlapFace=function(e,t,o){const n=new Set,i=new Set,r=new Map;for(let s=0;s<t.length;++s){const a=t[s];if(!n.has(a))for(let c=s+1;c<t.length;c++){const s=t[c];if(s.isLive()&&!n.has(s)){if(Math.abs(a.center[e[0]]-s.center[e[0]])>o)break;const t=f.weldableFace(a,s,o);if(t){n.add(s),n.add(a),i.add(s.polygon),i.add(a.polygon);for(let e of t)r.set(e.target,{hEdge:e.source,cage:s.octree.bvh}),r.set(e.source,{hEdge:e.target,cage:a.octree.bvh})}}}}return{pair:r,merged:n,selection:i}},f.weldHole=function(e){const t=new Map;for(let o of e.merged){let e=t.get(o.octree.bvh);void 0===e&&(e=[],t.set(o.octree.bvh,e)),e.push(o)}const o=[];for(let[e,n]of t)o.push([e,e.makeHolesFromBB(n)]),e._updatePreviewAll();return o},f.undoWeldHole=function(e){for(let[t,o]of e){for(let e of o)t.geometry.undoHole(e);t._updatePreviewAll()}},f.weldBody=function(e,t){const o=[];for(let{combine:n,edgeLoop:i}of t.edgeLoops){const t=e.get(n);t.combine.geometry.weldContour(i),t.combine._updatePreviewAll(),t.preview=t.combine,t.snapshot||(t.snapshot={vertices:new Set});for(let e of i)t.snapshot.vertices.add(e.outer.origin);o.push([t.preview,i])}return o},f.undoWeldBody=function(e){for(let[t,o]of e)t.geometry.restoreContour(o),t._updatePreviewAll()},f.prototype.hardnessEdge=function(e){let t={operand:e,selection:[]};for(let o of this.selectedSet)this.bench.setHardness(o,e)&&t.selection.push(o);return t.selection.length>0?t:null},f.prototype.undoHardnessEdge=function(e){let t=e.operand;0===t?t=1:1===t&&(t=0);for(let o of e.selection)this.bench.setHardness(o,t)},f.prototype.assignFaceMaterial=function(e){const t=new Map;for(let o of this.selectedSet)if(e!==o.material){let n=t.get(o.material);n?n.push(o):t.set(o.material,[o]),o.assignMaterial(e)}return t.size>0?t:void 0},f.prototype.undoAssignFaceMaterial=function(e){for(const[t,o]of e.entries())for(const e of o)e.assignMaterial(t)},f.prototype.selectFaceMaterial=function(e){const t=this._resetSelectFace();for(let t of this.geometry.faces)t.material===e&&this.selectFace(t);return t},f.prototype.selectEdgeMaterial=function(e){const t=this._resetSelectEdge();for(let t of this.geometry.edges)for(let o of t)if(o.face&&o.face.material===e){this.selectEdge(o);break}return t},f.prototype.selectVertexMaterial=function(e){const t=this._resetSelectVertex();for(let t of this.geometry.vertices)for(let o of t.edgeRing())if(o.face&&o.face.material===e){this.selectVertex(t);break}return t},f.prototype.selectBodyMaterial=function(e){const t=this._resetSelectBody();for(let t of this.geometry.faces)if(t.material===e){this.selectBody();break}return t};class p extends a.EditCommand{constructor(e){super(),this.previewCage=e}free(){this.previewCage.freeBuffer()}doIt(){r.addToWorld(this.previewCage)}undo(){r.removeFromWorld(this.previewCage)}}},function(e,t,o){"use strict";o.r(t),o.d(t,"styleSheet",function(){return b}),o.d(t,"getArrow",function(){return h}),o.d(t,"placement",function(){return f}),o.d(t,"getPosition",function(){return p}),o.d(t,"positionDom",function(){return g}),o.d(t,"addMenuItem",function(){return u}),o.d(t,"bindMenuItem",function(){return a}),o.d(t,"bindMenuItemMMB",function(){return c}),o.d(t,"bindMenuItemRMB",function(){return d}),o.d(t,"bindMenuItemMode",function(){return l}),o.d(t,"addLabelInput",function(){return v}),o.d(t,"extractDialogValue",function(){return m}),o.d(t,"runDialog",function(){return x}),o.d(t,"runDialogCenter",function(){return y}),o.d(t,"openFile",function(){return w}),o.d(t,"showContextMenu",function(){return _}),o.d(t,"showPopup",function(){return B}),o.d(t,"queuePopupMenu",function(){return L}),o.d(t,"toggleSubmenu",function(){return C});var n=o(19),i=o(0);const r="data-menuId";function s(e,t,o,r,s,a,c){if(i.bindAction(t,o,r,s),void 0!==a){n.setHotkey(e,r,a,c);const o=c?`${c}+${a}`:a;for(let e of t)e.classList.add("hotkey"),e.setAttribute("data-hotkey",o.toUpperCase())}}function a(e,t,o,n){const i=document.querySelectorAll(`[${r}="${e}"]`);i?s(null,i,0,e,t,o,n):console.log("Click: could not find menuItem "+e)}function c(e,t){const o=document.querySelectorAll(`[${r}="${e}"]`);o?s(null,o,1,e,t):console.log("AuxClick: could not find menuItem "+e)}function d(e,t){const o=document.querySelectorAll(`[${r}="${e}"]`);o?s(null,o,2,e,t):console.log("ContextClick: could not find menuItem "+e)}function l(e,t,o,n,i){const a=document.querySelectorAll(`[${r}="${e}"]`);a?s(o,a,0,e,t,n,i):console.log("Click: could not find menuItem "+e)}function u(e,t,o,n,a,c){const d=document.querySelector(`[${r}="${e}"]`),l=document.createElement("li"),u=document.createElement("a");u.id=t,u.textContent=o,l.appendChild(u),d.appendChild(l),i.addActionConstant(t),s(u,0,t,n,a,c)}function h(e){return"bottom"===e?"top":"bottom-start"===e?"top":"top"===e?"bottom":"top-start"===e?"bottom":"left"===e?"right":"right"===e?"left":""}function f(e,t,o){const n=o.getBoundingClientRect();let i,r;if(""===e){const e=(i=document.getElementById("glcanvas")).getBoundingClientRect();r={left:Math.round(e.left+e.width/2),top:Math.round(e.top+e.height/2),width:1,height:1}}else r=(i=document.getElementById(e)).getBoundingClientRect();let s=r.left-window.scrollX,a=r.top-window.scrollY;return"bottom"===t?(s+=Math.round(r.width/2-n.width/2),{top:a+=r.height,left:s}):"bottom-start"===t?(s+=Math.round(r.width/8-n.width/2),{top:a+=r.height,left:s}):"top"===t?(s+=Math.round(r.width/2-n.width/2),{top:a-=n.height,left:s}):"top-start"===t?(s+=Math.round(r.width/8-n.width/2),{top:a-=n.height,left:s}):"right"===t?(s+=r.width,{top:a+=Math.round(r.height/2-n.height/2),left:s}):"left"===t?(s-=n.width,{top:a+=Math.round(r.height/2-n.height/2),left:s}):void 0}function p(e){const t={x:0,y:0};return e.pageX||e.pageY?(t.x=e.pageX,t.y=e.pageY):(e.clientX||e.clientY)&&(t.x=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,t.y=e.clientY+document.body.scrollTop+document.documentElement.scrollTop),t}function g(e,t){var o=e.offsetWidth+4,n=e.offsetHeight+4,i=window.innerWidth,r=window.innerHeight;i-t.x<o?e.style.left=i-o+"px":e.style.left=t.x+"px",r-t.y<n?e.style.top=r-n+"px":e.style.top=t.y+"px"}function v(e,t){const o=e.querySelector("div");let n=e.querySelectorAll("label");for(let e of n)o.removeChild(e);for(let e of t){const t=document.createElement("label");t.textContent=e.name;const n=document.createElement("input");n.type="text",n.name=e.uuid,n.placeholder=e.name,t.appendChild(n),o.appendChild(t)}}function m(e){const t={};for(let o of e.elements)o.name&&o.value&&(t[o.name]=o.value);return t}function x(e,t,o,n){y(e,o,n,t)}function y(e,t,o,n){const i=document.querySelector(e);if(i){const e={submitSuccess:!1},r=document.createElement("div");r.classList.add("overlay"),r.addEventListener("keydown",function(e){e.stopPropagation()}),r.appendChild(i),i.style.display="block",n?r.classList.add("realCenterModal"):r.classList.add("centerModal"),i.reset(),o&&o(i);const s=i.querySelectorAll("[type=submit]");for(let t of s)0=="ok".localeCompare(t.value,"en",{sensitivity:"base"})?t.addEventListener("click",function o(n){e.submitSuccess=!0,t.removeEventListener("click",o)}):0=="cancel".localeCompare(t.value,"en",{sensitivity:"base"})||console.log("submit "+t.value+" type not supported");document.body.appendChild(r),i.addEventListener("submit",function o(n){e.submitSuccess&&t(i),n.preventDefault(),i.style.display="none",i.removeEventListener("submit",o),document.body.appendChild(i),document.body.removeChild(r)})}}function w(e){const t=document.querySelector("#importFile");t&&(t.click(),t.addEventListener("change",function(o){let n=this.files;for(let t of n)e(t);t.value=""}))}let b=function(){let e=document.createElement("style");return document.head.appendChild(e),e.appendChild(document.createTextNode("")),e.sheet}();const S=[];function E(){if(0===S.length)return!1;const e=S.pop();e.style.visibility="hidden";const t=e.parentElement;t.classList.remove("hideAfter","showBefore");const o=t.parentElement;let n=o.firstElementChild;do{n.style.visibility="inherit"}while(n=n.nextElementSibling);if(S.length>0){const e=o.previousElementSibling;e&&"A"==e.tagName&&(e.style.visibility="inherit",e.parentElement.style.visibility="inherit")}return!0}function C(e){if(S.length>0&&S[S.length-1]===e)E();else{const t=e.parentElement;t.classList.add("showBefore","hideAfter");const o=t.parentElement;if(S.length>0){const e=o.previousElementSibling;e&&"A"==e.tagName&&(e.style.visibility="hidden",e.parentElement.style.visibility="hidden")}let n=o.firstElementChild;do{n!==t&&(n.style.visibility="hidden")}while(n=n.nextElementSibling);S.push(e),e.style.visibility="visible"}}let M=!1,F=!1;function A(){if(M)for(M.style.visibility="hidden",M=!1;E(););F&&(M=F,F=!1,M.style.visibility="visible")}let P=0;function V(){document.addEventListener("mouseup",function e(t){P?P--:(A(),M||document.removeEventListener("mouseup",e))},!1)}function _(e){M?A():(P++,V()),(M=e).style.visibility="visible"}function L(e){e!==M&&(F=e,M||V())}const I=function(){let e=!1,t=[0,0],o=null;const n={mouseDown:function(n,i){e=!0,t=[(o=i).offsetLeft-n.clientX,o.offsetTop-n.clientY]},mouseUp:function(t){e=!1,o=null},mouseMove:function(n){if(n.preventDefault(),e){const e={x:n.clientX,y:n.clientY};o.style.left=e.x+t[0]+"px",o.style.top=e.y+t[1]+"px"}}};return n}();function B(e,t){let o=document.createElement("div");o.classList.add("popup");let n=document.createRange().createContextualFragment('<span class="close">&times;</span>');n.firstElementChild.addEventListener("click",function(e){document.body.removeChild(o)}),o.appendChild(n);let i=document.createElement("h3");i.addEventListener("mousedown",e=>{I.mouseDown(e,o)}),document.addEventListener("mouseup",I.mouseUp),document.addEventListener("mousemove",I.mouseMove),i.textContent=t,o.appendChild(i);let r=document.createElement("div");return r.classList.add("wrap"),r.appendChild(e),o.appendChild(r),document.body.appendChild(o),function(e){let t=window.innerWidth,o=window.innerHeight,n=e.getBoundingClientRect();e.style.left=Math.round((t-n.width)/2)+"px",e.style.top=Math.round((o-n.height)/2)+"px"}(o),document.body.removeChild(o),o}},function(e,t,o){"use strict";o.r(t),o.d(t,"createWebGLContext",function(){return i}),o.d(t,"ShaderData",function(){return r}),o.d(t,"ShaderProgram",function(){return s}),o.d(t,"gl",function(){return n});let n=null;function i(e,t){var o={currentShader:null},i=document.getElementById(e);if(!i)return null;if(t=void 0!==t?t:{depth:!0,stencil:!0,antialias:!0},!(n=i.getContext("webgl",t)||i.getContext("experimental-webgl",t)))return alert("Unable to initialize WebGL"),null;{let e=n.getExtension("OES_standard_derivatives");if(null===e)return console.log("No OES_standard_derivatives"),null;if(null===(e=n.getExtension("OES_element_index_uint")))return console.log("No OES_element_index_uint"),null;console.log("WebGL 1 init with extension")}return n.resizeToDisplaySize=function(){var e=n.canvas,t=e.clientWidth,o=e.clientHeight;return(e.width!=t||e.height!=o)&&(e.width=t,e.height=o,n.viewport(0,0,t,o),!0)},n.resizeToDisplaySize(),n.projection=mat4.create(),n.modelView=mat4.create(),o.transform={projection:function(e,t){e.uniformMatrix4fv(t,!1,e.projection)},worldView:function(e,t){e.uniformMatrix4fv(t,!1,e.modelView)}},n.getViewport=function(){return n.getParameter(n.VIEWPORT)},n.project=function(e,t,o,i,r){var s=vec4.fromValues(e,t,o,1);if(out=vec4.create(),vec4.transformMat4(out,s,modelView),vec4.transformMat4(s,out,r),0==s[3])return s;s[0]/=s[3],s[1]/=s[3],s[2]/=s[3];var a=n.getViewport();return out[0]=(.5*s[0]+.5)*a[2]+a[0],out[1]=(.5*s[1]+.5)*a[3]+a[1],out[2]=.5*s[2]+.5,out[3]=1,out},n.unProject=function(e,t,o,i,r,s){var a=mat4.create(),c=vec4.create(),d=vec4.create();if(mat4.multiply(a,r,i),null==mat4.invert(a,a))return d[3]=0,d;s=n.getViewport();return c[0]=(e-s[0])/s[2]*2-1,c[1]=(t-s[1])/s[3]*2-1,c[2]=2*o-1,c[3]=1,vec4.transformMat4(d,c,a),0==d[3]?d:(d[0]/=d[3],d[1]/=d[3],d[2]/=d[3],d[3]=1,d)},n.transformVertex=function(e){var t=vec4.create();return vec4.transformMat4(t,vec4.transformMat4(t,e,n.modelView),n.projection)},n.compileGLSL=function(e,t){var o=n.loadShader(n.VERTEX_SHADER,e);if(!o)return console.log("failed to compile vertex shader"),null;var i=n.loadShader(n.FRAGMENT_SHADER,t);if(!i)return console.log("failed to compile fragment shader"),null;var r=n.createProgram();if(n.attachShader(r,o),n.attachShader(r,i),n.linkProgram(r),!n.getProgramParameter(r,n.LINK_STATUS)){var s=n.getProgramInfoLog(r);return console.log("failed to link program: "+s),n.deleteProgram(r),n.deleteShader(i),n.deleteShader(o),null}return r},n.loadShader=function(e,t){var o=n.createShader(e);if(n.shaderSource(o,t),n.compileShader(o),!n.getShaderParameter(o,n.COMPILE_STATUS)){var i=n.getShaderInfoLog(o);return console.log("failed to compile shader: "+i),n.deleteShader(o),null}return o},n.createShaderProgram=function(e,t){var o=n.compileGLSL(e,t);if(o){for(var i,r={},a=n.getProgramParameter(o,n.ACTIVE_ATTRIBUTES),c=0;c<a;++c){if(!(i=n.getActiveAttrib(o,c)))return console.log("Something wrong, getActiveAttrib failed"),null;r[i.name]={loc:n.getAttribLocation(o,i.name),type:i.type}}var d={},l={world:null,worldView:null,worldViewProjection:null,view:null,projection:null};for(a=n.getProgramParameter(o,n.ACTIVE_UNIFORMS),c=0;c<a;++c){if(!(i=n.getActiveUniform(o,c)))return console.log("Something wrong, getActiveUniform failed"),null;l.hasOwnProperty(i.name)?l[i.name]=n.getUniformLocation(o,i.name):d[i.name]={loc:n.getUniformLocation(o,i.name),size:i.size,type:i.type}}return new s(o,l,r,d)}},n.createBufferHandle=function(e,t=n.ARRAY_BUFFER,o=n.STATIC_DRAW){if(ArrayBuffer.isView(e)){var i=n.createBuffer();return n.bindBuffer(t,i),n.bufferData(t,e,o),n.bindBuffer(t,null),i}return console.log("not typedArray"),null},n.setBufferAndAttrib=function(e,t,o=3){n.bindBuffer(n.ARRAY_BUFFER,e),n.vertexAttribPointer(t,o,n.FLOAT,!1,0,0),n.enableVertexAttribArray(t)},n.bindAttributeToProgram=function(e,t){n.bindBuffer(n.ARRAY_BUFFER,t.handle),n.vertexAttribPointer(e,t.size,t.type,t.normalized,t.stride,t.offset),n.enableVertexAttribArray(e)},n.bindIndex=function(e,t){const o=e.index[t];o&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,o)},n.bindAttribute=function(e,t){o.currentShader.bindAttribute(n,e.attribute,t)},n.bindUniform=function(e,t){o.currentShader.bindUniform(n,e.uniform,t)},n.bindTransform=function(){o.currentShader.bindTransform(n,o.transform)},n.pushTransform=function(e){},n.popTransform=function(){},n.useShader=function(e){o.currentShader=e,n.useProgram(e.progHandle)},n.disableShader=function(){o.currentShader&&o.currentShader.disableVertexAttributeArray(n)},n.drawVertex=function(e){n.bindTransform(),n.bindShaderData(e.shaderData,!1),e.drawVertex(n)},n.drawSelect=function(e){n.bindTransform(),e.bindSelectorShaderData(n),e.drawSelect(n)},n.createShaderData=function(){return new r},n}const r=function(){this.attribute={},this.uniform={},this.index={}};r.attribLayout=function(e=3,t=n.FLOAT,o=!1,i=0,r=0){return{size:e,type:t,normalized:o,stride:i,offset:r}},r.prototype.setupAttribute=function(e,t,o,n){this.createAttribute(e,t,n),this.resizeAttribute(e,o.byteLength),this.uploadAttribute(e,0,o)},r.prototype.createAttribute=function(e,t,o){if(this.attribute[e])console.log("Shader Data: "+e+" already initialized");else{var i=n.createBuffer();this.attribute[e]={handle:i,byteLength:0,usage:o,size:t.size,type:t.type,normalized:t.normalized,stride:t.stride,offset:t.offset}}},r.prototype.resizeAttribute=function(e,t){var o=this.attribute[e];o&&o.byteLength!=t&&(n.bindBuffer(n.ARRAY_BUFFER,o.handle),n.bufferData(n.ARRAY_BUFFER,t,o.usage),o.byteLength=t)},r.prototype.deleteAttribute=function(e){var t=this.attribute[e];t&&(n.deleteBuffer(t.handle),this.attribute[e]=null)},r.prototype.freeAllAttributes=function(){var e=[];for(var t in this.attribute)e.push(t);for(var o=0;o<e.length;++o)this.deleteAttribute(e[o])},r.prototype.uploadAttribute=function(e,t,o){var i=this.attribute[e];i?(n.bindBuffer(n.ARRAY_BUFFER,i.handle),n.bufferSubData(n.ARRAY_BUFFER,t,o)):console.log("Shader Data: "+e+" not initialized")},r.prototype.setIndex=function(e,t){let o=this.index[e];o&&(n.deleteBuffer(o),this.index[e]=void 0),t&&(this.index[e]=n.createBufferHandle(t,n.ELEMENT_ARRAY_BUFFER))},r.prototype.setUniform1f=function(e,t){this.uniform[e]={value:new Float32Array(1),binder:r.uniform1fFn},this.uniform[e].value=t},r.uniform1fFn=function(e,t,o){e.uniform1f(t,o)},r.prototype.setUniform3fv=function(e,t){this.uniform[e]={value:new Float32Array(t),binder:r.uniform3fvFn}},r.uniform3fvFn=function(e,t,o){e.uniform3fv(t,o)},r.prototype.setUniform4fv=function(e,t){this.uniform[e]={value:new Float32Array(t),binder:r.uniform4fvFn}},r.uniform4fvFn=function(e,t,o){e.uniform4fv(t,o)};var s=function(e,t,o,n){this.progHandle=e,this.transform=t,this.attribute=o,this.uniform=n};s.prototype.disableVertexAttributeArray=function(e){for(var t in this.attribute)this.attribute.hasOwnProperty(t)&&e.disableVertexAttribArray(this.attribute[t].loc)},s.prototype.bindAttribute=function(e,t,o){try{for(let n of o)if(t.hasOwnProperty(n)&&this.attribute.hasOwnProperty(n)){const o=t[n];e.bindAttributeToProgram(this.attribute[n].loc,o)}}catch(e){console.log(e)}},s.prototype.bindUniform=function(e,t,o){try{for(let i of o)if(t.hasOwnProperty(i)&&this.uniform.hasOwnProperty(i)){var n=t[i];n.binder(e,this.uniform[i].loc,n.value)}}catch(e){console.log(e)}},s.prototype.bindTransform=function(e,t){try{for(var o in this.transform){if(t.hasOwnProperty(o))(0,t[o])(e,this.transform[o])}}catch(e){console.log(e)}},s.prototype.getTypeByName=function(e){}},function(e,t,o){"use strict";o.r(t),o.d(t,"EditCommand",function(){return n}),o.d(t,"EditSelectHandler",function(){return s}),o.d(t,"MouseMoveHandler",function(){return i}),o.d(t,"MoveableCommand",function(){return r}),o.d(t,"EditCommandCombo",function(){return c}),o.d(t,"EditCommandSimple",function(){return a});class n{_calibrateMovement(e){let t;return t=0==e?0:e<0?-(t=Math.log(-e)/5):Math.log(e)/5}_xPercentMovement(e){let t=window.innertWidth||document.documentElement.clientWidth||document.body.clientWidth;return e.movementX/t}free(){}isDoable(){return!0}}class i extends n{}class r extends n{isMoveable(){return!!this.moveHandler}handleMouseMove(e,t){this.moveHandler&&this.moveHandler.handleMouseMove(e,t)}doIt(){this.moveHandler&&this.moveHandler.doIt()}undo(){this.moveHandler&&this.moveHandler.undo()}}class s extends r{constructor(e,t,o,n){super(),this.selectable={isVertex:e,isEdge:t,isFace:o},this.planeNormal=n}isVertexSelectable(){return this.selectable.isVertex}isEdgeSelectable(){return this.selectable.isEdge}isFaceSelectable(){return this.selectable.isFace}getPlaneNormal(){return this.planeNormal}}class a extends n{constructor(e){super(),this.commandName=e}doIt(e){return this.result=e[this.commandName](),!1!==this.result}undo(e){this.result.undo.call(e,this.result.snapshots)}}class c extends n{constructor(e){super(),this.editCommands=e}doIt(){for(let e of this.editCommands)e.doIt()}undo(){for(let e=this.editCommands.length-1;e>=0;--e)this.editCommands[e].undo()}}},function(e,t,o){"use strict";o.r(t),o.d(t,"closestPointToPlane",function(){return v}),o.d(t,"computeAngle",function(){return h}),o.d(t,"getAxisAngle",function(){return f}),o.d(t,"computeEdgeNormal",function(){return p}),o.d(t,"getAxisOrder",function(){return m}),o.d(t,"intersectTriangle",function(){return i}),o.d(t,"intersectRayAAExtent",function(){return r}),o.d(t,"intersectRaySphere",function(){return s}),o.d(t,"intersectPlaneSphere",function(){return a}),o.d(t,"intersectPlaneAABB",function(){return c}),o.d(t,"intersectPlaneHEdge",function(){return d}),o.d(t,"projectVec3",function(){return g}),o.d(t,"rotationFromToVec3",function(){return l}),o.d(t,"reflectionMat4",function(){return u}),o.d(t,"hexToRGB",function(){return x}),o.d(t,"hexToRGBA",function(){return y}),o.d(t,"hexToCssRGBA",function(){return w}),o.d(t,"get_uuidv4",function(){return b});const n=1e-6;function i(e,t){var o=vec3.create(),i=vec3.create();vec3.sub(o,t[1],t[0]),vec3.sub(i,t[2],t[0]);var r=vec3.create();vec3.cross(r,e.direction,i);var s=vec3.dot(o,r);if(s<n)return 0;var a=1/s,c=vec3.create();vec3.sub(c,e.origin,t[0]);var d=vec3.dot(c,r)*a;if(d<0||d>1)return 0;var l=vec3.create();vec3.cross(l,c,o);var u=vec3.dot(e.direction,l)*a;return u<0||d+u>1?0:vec3.dot(i,l)*a}function r(e,t){let o=Number.NEGATIVE_INFINITY,n=Number.POSITIVE_INFINITY;for(let i=0;i<3;++i){let r=(t.min[i]-e.origin[i])*e.invDir[i],s=(t.max[i]-e.origin[i])*e.invDir[i];if(e.invDir[i]<0){let e=r;r=s,s=e}if((n=s<n?s:n)<=(o=r>o?r:o))return!1}return n>0}const s=function(){const e=vec3.create();return function(t,o){vec3.sub(e,o.center,t.origin);const n=vec3.dot(e,e),i=vec3.dot(e,t.direction);return!(i<0&&n>o.radius2)&&!(n-i*i>o.radius2)}}(),a=function(){const e=vec3.create();return function(t,o){return v(e,o.center,t),vec3.squaredDistance(e,o.center)<o.radius2}}();function c(e,t){const o=t.halfSize[0]*Math.abs(e.normal[0])+t.halfSize[1]*Math.abs(e.normal[1])+t.halfSize[2]*Math.abs(e.normal[2]),n=vec3.dot(e.normal,t.center)-e.distance;return Math.abs(n)<=o}function d(e,t,o){const i=o.origin.vertex,r=o.destination().vertex;let s,a=vec3.dot(t.normal,i)-t.distance,c=vec3.dot(t.normal,r)-t.distance;if(Math.abs(a)<n&&(a=0),Math.abs(c)<n&&(c=0),a*c>0)return-2;if(0==a){if(0==c)return-1;s=0}else 0==c&&(s=1);if(e){if(void 0===s){vec3.sub(e,t.pt,i);const o=vec3.dot(t.normal,e);vec3.sub(e,r,i),s=o/vec3.dot(t.normal,e)}vec3.scaleAndAdd(e,i,e,s)}return void 0!==s?s:.5}function l(e,t,o){let i=vec3.dot(t,o);if(Math.abs(i)>1-n){const n=vec3.fromValues(Math.abs(t[0]),Math.abs(t[1]),Math.abs(t[2]));n[0]<n[1]?n[0]<n[2]?(n[0]=1,n[1]=n[2]=0):(n[2]=1,n[0]=n[1]=0):n[1]<n[2]?(n[1]=1,n[0]=n[2]=0):(n[2]=1,n[0]=n[1]=0);let i=vec3.fromValues(n[0]-t[0],n[1]-t[1],n[2]-t[2]),r=vec3.fromValues(n[0]-o[0],n[1]-o[1],n[2]-o[2]),s=2/vec3.dot(i,i),a=2/vec3.dot(r,r),c=s*a*vec3.dot(i,r);for(let t=0;t<3;t++){let o=4*t;for(let n=0;n<3;n++)e[o+n]=-s*i[t]*i[n]-a*r[t]*r[n]+c*r[t]*i[n];e[o+t]+=1}}else{let n=vec3.create();vec3.cross(n,t,o);let r=(1-i)/vec3.dot(n,n),s=r*n[0],a=r*n[2],c=s*n[1],d=s*n[2],l=a*n[1];e[0]=i+s*n[0],e[1]=c+n[2],e[2]=d-n[1],e[4]=c-n[2],e[5]=i+r*n[1]*n[1],e[6]=l+n[0],e[8]=d+n[1],e[9]=l-n[0],e[10]=i+a*n[2]}return e}function u(e,t,o){const n=-vec3.dot(t,o);return e[0]=-2*t[0]*t[0]+1,e[1]=-2*t[1]*t[0],e[2]=-2*t[2]*t[0],e[3]=0,e[4]=-2*t[0]*t[1],e[5]=-2*t[1]*t[1]+1,e[6]=-2*t[2]*t[1],e[7]=0,e[8]=-2*t[0]*t[2],e[9]=-2*t[1]*t[2],e[10]=-2*t[2]*t[2]+1,e[11]=0,e[12]=-2*t[0]*n,e[13]=-2*t[1]*n,e[14]=-2*t[2]*n,e[15]=1,e}function h(e,t,o,n){let i=vec3.create(),r=vec3.create();vec3.sub(i,t.vertex,o.vertex),vec3.sub(r,n.vertex,o.vertex),vec3.cross(e,i,r);let s=Math.atan2(vec3.length(e),vec3.dot(i,r));return vec3.normalize(e,e),s}function f(e,t,o){vec3.cross(e,t,o);let n=Math.atan2(vec3.length(e),vec3.dot(t,o));return vec3.normalize(e,e),n}function p(e,t,o){let i=h(e,t.destination(),t.origin,o.destination());((i=Math.abs(i))<n||i>Math.PI-n)&&(vec3.set(e,0,0,0),t.face&&vec3.add(e,e,t.face.normal),o.pair.face&&vec3.add(e,e,o.pair.face)),vec3.normalize(e,e)}function g(e,t,o){const n=vec3.create();for(let i of e){vec3.sub(n,i.vertex,o);let e=vec3.dot(n,t);vec3.scale(n,t,e),vec3.sub(i.vertex,i.vertex,n)}}function v(e,t,o){const n=vec3.dot(o.normal,t)-o.distance;vec3.scaleAndAdd(e,t,o.normal,-n)}function m(e){let t,o,n,i=vec3.create();return vec3.sub(i,e.max,e.min),i[0]>i[1]?i[0]>i[2]&&(t=0,i[1]>i[2]?(o=1,n=2):(o=2,n=1)):(i[1],i[2]),[t,o,n]}function x(e){return[parseInt(e.slice(1,3),16)/255,parseInt(e.slice(3,5),16)/255,parseInt(e.slice(5,7),16)/255]}function y(e){return[parseInt(e.slice(1,3),16)/255,parseInt(e.slice(3,5),16)/255,parseInt(e.slice(5,7),16)/255,1]}function w(e){return`rgba(${parseInt(e.slice(1,3),16)}, ${parseInt(e.slice(3,5),16)}, ${parseInt(e.slice(5,7),16)}, ${parseInt(e.slice(7,9),16)/255})`}function b(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))}},function(e,t,o){"use strict";o.r(t),o.d(t,"Madsor",function(){return l}),o.d(t,"DragSelect",function(){return u}),o.d(t,"GenericEditCommand",function(){return V}),o.d(t,"MovePositionHandler",function(){return p}),o.d(t,"MouseMoveAlongAxis",function(){return v}),o.d(t,"MoveDirectionHandler",function(){return m}),o.d(t,"MoveBidirectionHandler",function(){return x}),o.d(t,"MoveAlongNormal",function(){return y}),o.d(t,"MoveFreePositionHandler",function(){return w}),o.d(t,"MouseRotateAlongAxis",function(){return S}),o.d(t,"ToggleCheckbox",function(){return h}),o.d(t,"ToggleModeCommand",function(){return f});var n=o(5),i=o(2),r=o(10),s=o(1),a=o(3),c=o(0),d=o(17);class l{constructor(e){if(this.modeString=e,"Multi"===e)return;e=e.toLowerCase();const t=this;this.contextMenu={menu:document.querySelector("#"+e+"-context-menu")},this.contextMenu.menu&&(this.contextMenu.menuItems=this.contextMenu.menu.querySelectorAll(".context-menu__item"));const o=[[1,0,0],[0,1,0],[0,0,1]],n=["X","Y","Z"];for(let o=0;o<3;++o)a.bindMenuItem(e+"Move"+n[o],function(e){s.attachHandlerMouseMove(new v(t,o))});const i={body:c.action.bodyMoveFree,face:c.action.faceMoveFree,edge:c.action.edgeMoveFree,vertex:c.action.vertexMoveFree};a.bindMenuItem(i[e].name,function(e){s.attachHandlerMouseMove(new w(t))});const r={face:c.action.faceMoveNormal,edge:c.action.edgeMoveNormal,vertex:c.action.vertexMoveNormal};r[e]&&a.bindMenuItem(r[e].name,function(e){s.attachHandlerMouseMove(new y(t))});const d={face:c.action.faceScaleUniform,edge:c.action.edgeScaleUniform,vertex:c.action.vertexScaleUniform,body:c.action.bodyScaleUniform};a.bindMenuItem(d[e].name,e=>{s.attachHandlerMouseMove(new b(this,[1,1,1]))});for(let t=0;t<3;++t)a.bindMenuItem(e+"Rotate"+n[t],e=>{const o=[0,0,0];o[t]=1,s.attachHandlerMouseMove(new S(this,o))});const l={face:c.action.faceBevel,edge:c.action.edgeBevel,vertex:c.action.vertexBevel};l[e]&&a.bindMenuItem(l[e].name,e=>{s.attachHandlerMouseMove(new E(this))});let u={face:[c.action.faceExtrudeX,c.action.faceExtrudeY,c.action.faceExtrudeZ],edge:[c.action.edgeExtrudeX,c.action.edgeExtrudeY,c.action.edgeExtrudeZ],vertex:[c.action.vertexExtrudeX,c.action.vertexExtrudeY,c.action.vertexExtrudeZ]}[e];if(u)for(let e=0;e<3;++e)a.bindMenuItem(u[e].name,t=>{s.attachHandlerMouseMove(new M(this,e))});const h={face:c.action.faceExtrudeFree,edge:c.action.edgeExtrudeFree,vertex:c.action.vertexExtrudeFree};h[e]&&a.bindMenuItem(h[e].name,e=>{s.attachHandlerMouseMove(new F(this))});const f={face:c.action.faceExtrudeNormal,edge:c.action.edgeExtrudeNormal,vertex:c.action.vertexExtrudeNormal};f[e]&&a.bindMenuItem(f[e].name,e=>{s.attachHandlerMouseMove(new A(this))});let p={face:[c.action.faceFlattenX,c.action.faceFlattenY,c.action.faceFlattenZ],edge:[c.action.edgeFlattenX,c.action.edgeFlattenY,c.action.edgeFlattenZ],vertex:[c.action.vertexFlattenX,c.action.vertexFlattenY,c.action.vertexFlattenZ]}[e];if(p)for(let e=0;e<3;++e)a.bindMenuItem(p[e].name,t=>{const n=new V(this,this.flatten,[o[e]]);n.doIt()&&s.undoQueue(n)});const g=[[0,1,1],[1,0,1],[1,1,0]],m={face:[c.action.faceScaleAxisX,c.action.faceScaleAxisY,c.action.faceScaleAxisZ],edge:[c.action.edgeScaleAxisX,c.action.edgeScaleAxisY,c.action.edgeScaleAxisZ],vertex:[c.action.vertexScaleAxisX,c.action.vertexScaleAxisY,c.action.vertexScaleAxisZ],body:[c.action.bodyScaleAxisX,c.action.bodyScaleAxisY,c.action.bodyScaleAxisZ]}[e],x={face:[c.action.faceScaleRadialX,c.action.faceScaleRadialY,c.action.faceScaleRadialZ],edge:[c.action.edgeScaleRadialX,c.action.edgeScaleRadialY,c.action.edgeScaleRadialZ],vertex:[c.action.vertexScaleRadialX,c.action.vertexScaleRadialY,c.action.vertexScaleRadialZ],body:[c.action.bodyScaleRadialX,c.action.bodyScaleRadialY,c.action.bodyScaleRadialZ]}[e];for(let e=0;e<3;++e)a.bindMenuItem(m[e].name,t=>{s.attachHandlerMouseMove(new b(this,o[e]))}),a.bindMenuItem(x[e].name,t=>{s.attachHandlerMouseMove(new b(this,g[e]))});const C={face:[c.action.facePlaneCutX,c.action.facePlaneCutY,c.action.facePlaneCutZ],body:[c.action.bodyPlaneCutX,c.action.bodyPlaneCutY,c.action.bodyPlaneCutZ]}[e];if(C)for(let e=0;e<3;++e)a.bindMenuItem(C[e].name,t=>{s.attachHandlerMouseSelect(new P(this,o[e]))})}modeName(){return this.modeString}getContextMenu(){return this.hasSelection()?this.contextMenu:null}snapshotSelected(e,...t){const o=[];for(let n of this.selectedCage()){const i=e.call(n,...t);(i||!1===i)&&o.push({preview:n,snapshot:i})}return o}snapshotSelectable(e,...t){const o=[];for(let n of this.selectableCage()){const i=e.call(n,...t);(i||!1===i)&&o.push({preview:n,snapshot:i})}return o}snapshotTarget(e,t,...o){const n=[];for(let i of e){const e=t.call(i,...o);(e||!1===e)&&n.push({preview:i,snapshot:e})}return n}doAll(e,t,...o){if(e)for(let n of e)t.call(n.preview,n.snapshot,...o);else for(let e of this.eachCage())t.call(e,void 0,...o)}resultAll(e,...t){for(let o of this.selectedCage())if(e.call(o,...t))return!0;return!1}*eachCage(){const e=s.getWorld();for(let t of e)yield t}*selectableCage(){const e=s.getWorld();for(let t of e)!t.isLock()&&t.isVisible()&&(yield t)}*selectedCage(){const e=s.getWorld();for(let t of e)!t.isLock()&&t.isVisible()&&t.hasSelection()&&(yield t)}*notSelectedCage(){const e=s.getWorld();for(let t of e)t.isLock()||!t.isVisible()||t.hasSelection()||(yield t)}*visibleCage(){const e=s.getWorld();for(let t of e)t.isVisible()&&(yield t)}*visibleWireCage(e){const t=s.getWorld();for(let o of t)o.isVisible()&&o.isWireMode()===e&&(yield o)}hasSelection(){for(let e of this.selectableCage())if(!e.isLock()&&e.hasSelection())return!0;return!1}restoreMoveSelection(e){this.doAll(e,i.PreviewCage.prototype.restoreMoveSelection)}moveSelection(e,t){this.doAll(e,i.PreviewCage.prototype.moveSelection,t)}restoreSelectionPosition(e){this.doAll(e,i.PreviewCage.prototype.restoreMoveSelection)}scaleSelection(e,t,o){this.doAll(e,i.PreviewCage.prototype.scaleSelection,t,o)}rotateSelection(e,t,o){this.doAll(e,i.PreviewCage.prototype.rotateSelection,t,o)}snapshotSelection(){return this.snapshotSelected(i.PreviewCage.prototype["snapshotSelection"+this.modeName()])}_doSelection(e,t=!1){e="_select"+this.modeName()+e;const o=[];for(let n of this.eachCage())(t||n.hasSelection())&&o.push({preview:n,snapshot:n[e]()});return o.length>0&&{undo:this.undoDoSelection,snapshots:o}}similarSelection(){return this._doSelection("Similar")}adjacentSelection(){return this._doSelection("Adjacent")}invertSelection(){return this._doSelection("Invert",!0)}allSelection(){return this._doSelection("All",!0)}lessSelection(){return this._doSelection("Less")}moreSelection(){return this._doSelection("More")}resetSelection(){for(let e of this.selectedCage())this._resetSelection(e)}restoreSelection(e){this.doAll(e,i.PreviewCage.prototype.restoreSelection,this)}undoDoSelection(e){this.resetSelection(),this.restoreSelection(e)}selectObject(e,t){return t.checked?this.snapshotTarget(e,i.PreviewCage.prototype["_select"+this.modeName()+"All"]):this.snapshotTarget(e,i.PreviewCage.prototype["_resetSelect"+this.modeName()])}undoSelectObject(e,t){t.checked&&this.doAll(e,i.PreviewCage.prototype["_resetSelect"+this.modeName()]),this.doAll(e,i.PreviewCage.prototype.restoreSelection,this)}toggleObjectLock(e,t){return this.snapshotTarget(e,i.PreviewCage.prototype.toggleLock,t.checked)}undoToggleObjectLock(e){this.doAll(e,i.PreviewCage.prototype.toggleLock)}toggleObjectVisibility(e,t){return this.snapshotTarget(e,i.PreviewCage.prototype.setVisible,!t.checked)}undoObjectVisibility(e){return this.doAll(e,i.PreviewCage.prototype.setVisible)}toggleObjectWireMode(e,t){return this.snapshotTarget(e,i.PreviewCage.prototype.toggleWireMode,t)}undoToggleObjectWireMode(e){return this.doAll(e,i.PreviewCage.prototype.toggleWireMode)}selectMaterialCmd(e){return new V(this,this._selectMaterial,e,this.undoDoSelection)}_selectMaterial(e){return this.snapshotSelectable(i.PreviewCage.prototype["select"+this.modeName()+"Material"],e)}isVertexSelectable(){return!1}isEdgeSelectable(){return!1}isFaceSelectable(){return!1}toggleMulti(e){}drawExtra(e,t){e.useShader(r.solidWireframe),e.bindTransform(),t.drawHilite(e,this)}previewShader(e){e.useShader(r.solidWireframe)}}class u{constructor(e,t,o,n){this.madsor=e,this.select=new Map,this.select.set(t,[o]),this.onOff=n}dragSelect(e,t){var o=this.select.get(e);void 0===o&&(o=[],this.select.set(e,o)),this.madsor.dragSelect(e,t,o,this.onOff)}}class h extends n.EditCommand{constructor(e){super(),this.input=e}doIt(){this.input.checked=!this.input.checked}undo(){this.input.checked=!this.input.checked}}class f extends n.EditCommand{constructor(e,t,o){super(),this.snapshots=o,this.redoToggle=e,this.undoToggle=t}doIt(){this.redoToggle()}undo(){this.undoToggle(this.snapshots)}}class p extends n.MouseMoveHandler{constructor(e,t,o){super(),this.madsor=e,this.snapshots=t,this.movement=o}isDoable(){return this.snapshots.length>0}doIt(){return this.snapshots.length>0&&(this._transformSelection(this.movement),!0)}undo(){this.madsor.restoreSelectionPosition(this.snapshots)}handleMouseMove(e,t){this._transformSelection(this._updateMovement(e,t))}_transformSelection(e){this.madsor.moveSelection(this.snapshots,e)}}class g extends p{constructor(e,t,o){super(e,null,t),this.cmd=o}doIt(){return this.cmd?(this.cmd.doIt(),this.snapshots=this.cmd.snapshotPosition()):this.snapshots=this.snapshotPosition(),super.doIt(),!0}undo(){this.cmd?this.cmd.undo():super.undo()}}class v extends p{constructor(e,t){super(e,e.snapshotPosition(),[0,0,0]),this.axis=t}_updateMovement(e){let t=this._calibrateMovement(e.movementX),o=[0,0,0];return o[this.axis]=t,this.movement[this.axis]+=t,o}}class m extends g{constructor(e,t,o=!1){super(e,0,t),this.noNegative=o}_updateMovement(e){let t=this._calibrateMovement(e.movementX);return this.movement+=t,this.noNegative&&this.movement<0&&(t-=this.movement,this.movement=0),t}}class x extends g{constructor(e,t){super(e,0,t)}handleMouseMove(e,t){let o=this._calibrateMovement(e.movementX);o>0?this.movement<0&&this.movement+o>=0&&(this.madsor.moveSelection(this.snapshots,-this.movement),o+=this.movement,this.movement=0,this.madsor.doAll(this.snapshots,i.PreviewCage.prototype.positiveDirection)):this.movement>=0&&this.movement+o<0&&(this.madsor.moveSelection(this.snapshots,-this.movement),o+=this.movement,this.movement=0,this.madsor.doAll(this.snapshots,i.PreviewCage.prototype.negativeDirection)),this.movement+=o,this.madsor.moveSelection(this.snapshots,o)}}class y extends p{constructor(e,t=!1,o){o||(o=e.snapshotPositionAndNormal()),super(e,o,0),this.noNegative=t}_updateMovement(e){let t=this._calibrateMovement(e.movementX);return this.movement+=t,this.noNegative&&this.movement<0&&(t-=this.movement,this.movement=0),t}}class w extends p{constructor(e){super(e,e.snapshotPosition(),[0,0,0])}_updateMovement(e,t){let o=this._calibrateMovement(e.movementX),n=this._calibrateMovement(-e.movementY);var i=t.inverseCameraVectors(),r=[i.x[0]*o+i.y[0]*n,i.x[1]*o+i.y[1]*n,i.x[2]*o+i.y[2]*n];return vec3.add(this.movement,this.movement,r),r}}class b extends p{constructor(e,t){const o=e.snapshotTransformGroup();super(e,o,1),this.axis=t}_transformSelection(e){this.madsor.scaleSelection(this.snapshots,e,this.axis)}_updateMovement(e,t){let o=this._xPercentMovement(e);return o=o<0?1+Math.abs(o):1/(1+o),this.movement*=o,o}}class S extends n.EditCommand{constructor(e,t,o){super(),this.madsor=e,this.snapshots=e.snapshotTransformGroup(),this.movement=0,this.axisVec3=vec3.clone(t),this.center=o}handleMouseMove(e){const t=5*this._xPercentMovement(e),o=quat.create();quat.setAxisAngle(o,this.axisVec3,t),this.madsor.rotateSelection(this.snapshots,o,this.center),this.movement+=t}doIt(){const e=quat.create();quat.setAxisAngle(e,this.axisVec3,this.movement),this.madsor.rotateSelection(this.snapshots,e,this.center)}undo(){this.madsor.restoreSelectionPosition(this.snapshots)}}class E extends p{constructor(e){const t=e.snapshotSelection();super(e,e.bevel(),0),this.selection=t,this.vertexLimit=Number.MAX_SAFE_INTEGER;for(let e of this.snapshots)this.vertexLimit=Math.min(this.vertexLimit,e.vertexLimit)}_updateMovement(e){let t=this._calibrateMovement(e.movementX);return this.movement+t>this.vertexLimit?t=this.vertexLimit-this.movement:this.movement+t<0&&(t=0-this.movement),this.movement+=t,t}doIt(){this.snapshots=this.madsor.bevel(),super.doIt()}undo(){this.madsor.undoBevel(this.snapshots,this.selection)}}class C extends n.MoveableCommand{constructor(e){super(),this.madsor=e,this.contourEdges=e.extrude()}doIt(){this.contourEdges=this.madsor.extrude(this.contourEdges),super.doIt()}undo(){super.undo(),this.madsor.undoExtrude(this.contourEdges)}}class M extends C{constructor(e,t){super(e),this.moveHandler=new v(e,t)}}class F extends C{constructor(e){super(e),this.moveHandler=new w(e)}}class A extends C{constructor(e){super(e),this.moveHandler=new y(e)}}class P extends n.EditSelectHandler{constructor(e,t){super(!0,!0,!0,t),this.madsor=e,this.center=vec3.create()}hilite(e,t){if(e.plane){if(this.plane=new d.Plane(this.planeNormal,e.plane.center),this.madsor.planeCuttable(this.plane))return e.plane.hilite=!0,!0;e.plane.hilite=!1,delete this.plane}return!0}select(e){return!!this.plane&&this.doIt()}doIt(){return!!(this.plane&&(this.cut=this.madsor.planeCut(this.plane),this.cut.length>0))&&(s.restoreVertexMode(this.cut),this.vertexConnect=s.currentMode().connectVertex(),this.vertexConnect.doIt())}undo(){this.vertexConnect&&(this.vertexConnect.undo(),delete this.vertexConnect,this.madsor.undoPlaneCut(this.cut))}}class V extends n.EditCommand{constructor(e,t,o,n,i){super(),this.madsor=e,this.doCmd=t,this.doParams=o,this.undoCmd=n,this.undoParams=i}doIt(e){return this.snapshots=this.doCmd.call(this.madsor,...this.doParams?this.doParams:[]),this.snapshots.length>0}undo(e){this.undoCmd?this.undoCmd.call(this.madsor,this.snapshots,...this.undoParams?this.undoParams:[]):this.madsor.restoreSelectionPosition(this.snapshots)}snapshotPosition(){return this.snapshots}}},function(e,t,o){"use strict";o.r(t),o.d(t,"renderText",function(){return h}),o.d(t,"needToRedraw",function(){return m}),o.d(t,"render",function(){return x});var n=o(4),i=o(1),r=o(11),s=o(0),a=o(10),c=o(6);let d,l,u;function h(e,t,o,n,i){e.useProgram(u.handle),e.setBufferAndAttrib(u.bitmapTextVBO.position,u.vertexPosition,2),e.setBufferAndAttrib(u.bitmapTextVBO.texCoord,u.texCoord,2),function(e){var t=e.length,o=6*t,n=u.bitmapTextVBO.verticesData,i=u.bitmapTextVBO.texCoordData;o>n.length/2&&(n=new Float32Array(2*o),i=new Float32Array(2*o));for(var r=0,s=0,a=u.bitmapTextVBO.fontInfo.textureWidth,c=u.bitmapTextVBO.fontInfo.textureHeight,d=0;d<t;++d){var l=e[d],h=u.bitmapTextVBO.fontInfo.glyphInfos[l];if(h){var f=s+h.width,p=h.x/a,g=(h.y+u.bitmapTextVBO.fontInfo.letterHeight-1)/c,v=(h.x+h.width-1)/a,m=h.y/c;n[r+0]=s,n[r+1]=0,i[r+0]=p,i[r+1]=g,n[r+2]=f,n[r+3]=0,i[r+2]=v,i[r+3]=g,n[r+4]=s,n[r+5]=u.bitmapTextVBO.fontInfo.letterHeight,i[r+4]=p,i[r+5]=m,n[r+6]=s,n[r+7]=u.bitmapTextVBO.fontInfo.letterHeight,i[r+6]=p,i[r+7]=m,n[r+8]=f,n[r+9]=0,i[r+8]=v,i[r+9]=g,n[r+10]=f,n[r+11]=u.bitmapTextVBO.fontInfo.letterHeight,i[r+10]=v,i[r+11]=m,s+=h.width+u.bitmapTextVBO.fontInfo.spacing,r+=12}else s+=u.bitmapTextVBO.fontInfo.spaceWidth}u.bitmapTextVBO.verticesData=n,u.bitmapTextVBO.texCoordData=i,u.bitmapTextVBO.numElements=r/2}(i),e.bindBuffer(e.ARRAY_BUFFER,u.bitmapTextVBO.position),e.bufferData(e.ARRAY_BUFFER,u.bitmapTextVBO.verticesData,e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,u.bitmapTextVBO.texCoord),e.bufferData(e.ARRAY_BUFFER,u.bitmapTextVBO.texCoordData,e.DYNAMIC_DRAW),u.bitmapTextVBO.modelView[12]=t,u.bitmapTextVBO.modelView[13]=o,u.bitmapTextVBO.modelView[14]=0,e.uniformMatrix4fv(u.uPMatrix,!1,u.bitmapTextVBO.projection),e.uniformMatrix4fv(u.uMVMatrix,!1,u.bitmapTextVBO.modelView),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,u.bitmapTextVBO.uTexture),e.uniform1i(u.uTexture,0),e.drawArrays(e.TRIANGLES,0,u.bitmapTextVBO.numElements)}function f(e,t,o,n,i,r){(function(e,t){for(var o,n=0,i=1,r=[e[3]+e[0],e[3]-e[0],e[3]+e[1],e[3]-e[1],e[3]+e[2],e[3]-e[2]],s=[t[3]+t[0],t[3]-t[0],t[3]+t[1],t[3]-t[1],t[3]+t[2],t[3]-t[2]],a={pt0:0,pt1:0},c=0;c<6;++c){var d=(r[c]<0)<<c;a.pt0|=d,a.pt1|=(s[c]<0)<<c}if(0!=(a.pt0&a.pt1))return!1;if(0==(a.pt0|a.pt1))return!0;for(c=0;c<6;c++)if(s[c]<0?(o=r[c]/(r[c]-s[c]),i=Math.min(i,o)):r[c]<0&&(o=r[c]/(r[c]-s[c]),n=Math.max(n,o)),n>i)return!1;if(d=vec4.create(),0!=a.pt0)for(c=0;c<4;++c)d[c]=e[c]+n*(t[c]-e[c]);if(0!=a.pt1)for(c=0;c<4;++c)t[c]=e[c]+i*(t[c]-e[c]);return e=d,!0})(t,o)&&h(e,Math.trunc((.5*o[0]/o[3]+.5)*(r[2]-20)+10),r[3]-Math.trunc((.5*o[1]/o[3]+.5)*(r[3]-16)+7),0,n)}function p(e,t,o){var i,a,c=function(e,t){var o=n.gl.canvas.clientWidth,i=n.gl.canvas.clientHeight,r=Math.max(o,i),a=n.gl.unProject(r,0,0,t,e,[0,0,o,i]),c=s.GROUND_GRID_SIZE*Math.max(Math.round(Math.max(Math.max(Math.abs(a[0]),Math.abs(a[1])),Math.abs(a[2]))),10);return c*=o/i*.7,Math.round(c)}(t,o),u=function(e,t){for(var o=[],n=e;n>0;n-=t)o=o.concat([n,0,e],[n,0,-e],[-n,0,e],[-n,0,-e],[e,0,n],[-e,0,n],[e,0,-n],[-e,0,-n]);return o.concat([0,0,e],[0,0,-e],[e,0,0],[-e,0,0])}(c,s.GROUND_GRID_SIZE);return d.groundGridVBO={position:e.createBufferHandle(new Float32Array(u)),length:u.length/3},l.axisVBO={position:e.createBufferHandle((i=r.view.zFar,a=[[i,0,0],[0,0,0],[0,0,0],[-i,0,0],[0,i,0],[0,0,0],[0,0,0],[0,-i,0],[0,0,i],[0,0,0],[0,0,0],[0,0,-i]],new Float32Array([].concat.apply([],a)))),color:e.createBufferHandle(g()),length:12},c}function g(){const e=[c.hexToRGB(i.theme.colorX),c.hexToRGB(i.theme.colorY),c.hexToRGB(i.theme.colorZ)],t=[c.hexToRGB(i.theme.negColorX),c.hexToRGB(i.theme.negColorY),c.hexToRGB(i.theme.negColorZ)];for(var o=[],n=0;n<3;n++)o=o.concat(e[n],e[n],t[n],t[n]);return new Float32Array(o)}Object(s.onReady)(function(){v=!0,n.gl.enable(n.gl.DEPTH_TEST),n.gl.enable(n.gl.CULL_FACE),d=n.gl.createShaderProgram(a.uColorArray.vertexShader,a.uColorArray.fragShader),(l={handle:n.gl.compileGLSL(a.colorArray.vertexShader,a.colorArray.fragShader)}).vertexPosition=n.gl.getAttribLocation(l.handle,"aVertexPosition"),l.vertexColor=n.gl.getAttribLocation(l.handle,"aVertexColor"),l.uPMatrix=n.gl.getUniformLocation(l.handle,"uPMatrix"),l.uMVMatrix=n.gl.getUniformLocation(l.handle,"uMVMatrix");var e=i.loadMatrices(!0);p(n.gl,e.projection,e.modelView);!function(e,t){for(var o=[].concat([0,0,0],[.1,0,0],[0,0,0],[0,.1,0],[0,0,0],[0,0,.1],[.08,0,-.01],[.1,0,0],[.08,0,.01],[.1,0,0],[-.01,.08,0],[0,.1,0],[.01,.08,0],[0,.1,0],[-.01,0,.08],[0,0,.1],[.01,0,.08],[0,0,.1]),n=[c.hexToRGB(i.theme.colorX),c.hexToRGB(i.theme.colorY),c.hexToRGB(i.theme.colorZ)],r=[],s=[],a=0;a<3;++a)r=r.concat(n[a],n[a]),s=s.concat(n[a],n[a],n[a],n[a]);r=r.concat(s),l.miniAxisVBO={position:e.createBufferHandle(new Float32Array(o)),color:e.createBufferHandle(new Float32Array(r)),length:18};var d=e.canvas.clientWidth/e.canvas.clientHeight,u=mat4.clone(t);u[12]=.11-d,u[13]=-.89,u[14]=0,l.miniAxisVBO.modelView=u,l.miniAxisVBO.projection=mat4.create(),mat4.ortho(l.miniAxisVBO.projection,-d,d,-1,1,1e-5,1e7)}(n.gl,e.modelView),(u={handle:n.gl.compileGLSL(a.textArray.vertexShader,a.textArray.fragShader)}).vertexPosition=n.gl.getAttribLocation(u.handle,"aVertexPosition"),u.texCoord=n.gl.getAttribLocation(u.handle,"aTexCoord"),u.uMVMatrix=n.gl.getUniformLocation(u.handle,"uMVMatrix"),u.uPMatrix=n.gl.getUniformLocation(u.handle,"uPMatrix"),u.uTexture=n.gl.getUniformLocation(u.handle,"u_texture"),function(e){var t=new Float32Array(96),o=new Float32Array(96),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array([0,0,255,255]));var i=new Image;i.src="../img/8x8-font.png",i.onload=function(){e.bindTexture(e.TEXTURE_2D,n),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST)},u.bitmapTextVBO={verticesData:t,texCoordData:o,numElements:0,position:e.createBufferHandle(t),texCoord:e.createBufferHandle(o),modelView:mat4.create(),projection:mat4.create(),uTexture:n,fontInfo:{letterHeight:8,spaceWidth:8,spacing:-1,textureWidth:64,textureHeight:40,glyphInfos:{a:{x:0,y:0,width:8},b:{x:8,y:0,width:8},c:{x:16,y:0,width:8},d:{x:24,y:0,width:8},e:{x:32,y:0,width:8},f:{x:40,y:0,width:8},g:{x:48,y:0,width:8},h:{x:56,y:0,width:8},i:{x:0,y:8,width:8},j:{x:8,y:8,width:8},k:{x:16,y:8,width:8},l:{x:24,y:8,width:8},m:{x:32,y:8,width:8},n:{x:40,y:8,width:8},o:{x:48,y:8,width:8},p:{x:56,y:8,width:8},q:{x:0,y:16,width:8},r:{x:8,y:16,width:8},s:{x:16,y:16,width:8},t:{x:24,y:16,width:8},u:{x:32,y:16,width:8},v:{x:40,y:16,width:8},w:{x:48,y:16,width:8},x:{x:56,y:16,width:8},y:{x:0,y:24,width:8},z:{x:8,y:24,width:8},0:{x:16,y:24,width:8},1:{x:24,y:24,width:8},2:{x:32,y:24,width:8},3:{x:40,y:24,width:8},4:{x:48,y:24,width:8},5:{x:56,y:24,width:8},6:{x:0,y:32,width:8},7:{x:8,y:32,width:8},8:{x:16,y:32,width:8},9:{x:24,y:32,width:8},"-":{x:32,y:32,width:8},"*":{x:40,y:32,width:8},"!":{x:48,y:32,width:8},"?":{x:56,y:32,width:8}}}}}(n.gl)});let v=!1;function m(){v=!0}function x(e,t){if(e.resizeToDisplaySize()||r.view.isModified||v){v=!1;const a=c.hexToRGBA(i.theme.geometryBackground);e.clearColor(a[0],a[1],a[2],a[3]),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.polygonOffset(0,0),e.enable(e.POLYGON_OFFSET_FILL);var o=i.loadMatrices(!0);r.view.isModified&&(r.view.isModified=!1,p(e,o.projection,o.modelView));var n=function(e,t,o){const n=i.prop.showAxes;if(i.prop.showGroundplane){r.view.alongAxis;const a=c.hexToRGBA(i.theme.gridColor);var s=d.groundGridVBO.length;n&&(s-=4),e.useProgram(d.progHandle),e.setBufferAndAttrib(d.groundGridVBO.position,d.attribute.position.loc),e.uniform4fv(d.uniform.uColor.loc,a),e.uniformMatrix4fv(d.transform.projection,!1,t),e.uniformMatrix4fv(d.transform.worldView,!1,o),e.drawArrays(e.LINES,0,s)}var a;return a=r.view.zFar,n&&(e.useProgram(l.handle),e.uniformMatrix4fv(l.uPMatrix,!1,t),e.uniformMatrix4fv(l.uMVMatrix,!1,o),e.setBufferAndAttrib(l.axisVBO.position,l.vertexPosition),e.setBufferAndAttrib(l.axisVBO.color,l.vertexColor),e.drawArrays(e.LINES,0,l.axisVBO.length)),a}(e,o.projection,o.modelView);!function(e,t){if(i.prop.showMiniAxis){var o=e.canvas.clientWidth/e.canvas.clientHeight,n=l.miniAxisVBO.modelView;mat4.copy(n,t),n[12]=.11-o,n[13]=-.89,n[14]=0;var r=l.miniAxisVBO.length;e.useProgram(l.handle),e.uniformMatrix4fv(l.uPMatrix,!1,l.miniAxisVBO.projection),e.uniformMatrix4fv(l.uMVMatrix,!1,l.miniAxisVBO.modelView),e.setBufferAndAttrib(l.miniAxisVBO.position,l.vertexPosition),e.setBufferAndAttrib(l.miniAxisVBO.color,l.vertexColor),e.drawArrays(e.LINES,0,r)}}(e,o.modelView),t(e),function(e,t){if(i.prop.showAxes){var o=e.getViewport(),n=vec4.fromValues(0,0,0,1),r=e.transformVertex(n);mat4.ortho(u.bitmapTextVBO.projection,0,o[2],o[3],0,-1,1),t+=s.GROUND_GRID_SIZE,c.hexToRGB(i.theme.colorX),c.hexToRGB(i.theme.colorY),c.hexToRGB(i.theme.colorZ);var a=e.transformVertex(vec4.fromValues(t,0,0,1)),d=e.transformVertex(vec4.fromValues(0,t,0,1)),l=e.transformVertex(vec4.fromValues(0,0,t,1));f(e,r,a,"x",0,o),f(e,r,d,"y",0,o),f(e,r,l,"z",0,o)}}(e,n)}}},function(e,t,o){"use strict";o.r(t),o.d(t,"tours",function(){return u}),o.d(t,"targetCage",function(){return h}),o.d(t,"step",function(){return E}),o.d(t,"expectStep",function(){return M}),o.d(t,"faceSelectStep",function(){return A}),o.d(t,"addStep",function(){return C}),o.d(t,"addExpectStep",function(){return F}),o.d(t,"addFaceSelectStep",function(){return P}),o.d(t,"add",function(){return S}),o.d(t,"addMultiStep",function(){return L}),o.d(t,"addZoomStep",function(){return _}),o.d(t,"zoomStep",function(){return V}),o.d(t,"cancel",function(){return O}),o.d(t,"complete",function(){return T}),o.d(t,"startTour",function(){return B});var n=o(3),i=o(0);class r{constructor(e,t,o,n){this.targetID=o,this.placement=n,this.title=e,this.content=t,this.options={},this.options.showNext=!0}static walkupDoms(e,t,o){if(e){const n=e.parentNode;for(let t=n.firstElementChild;t;t=t.nextElementSibling)t!==e&&o(t);n!==t&&this.walkupDoms(n,t,o)}else for(let e=t.firstElementChild;e;e=e.nextElementSibling)"canvas"!==e.id&&o(e)}cancel(){this.done()}done(){let e;""!==this.targetID&&(e=document.getElementById(this.targetID)),r.walkupDoms(e,document.body,function(e){e.classList.remove("unfocus")})}expect(e,t){}option(e){return this.options[e]}show(){g.title.textContent=this.title,g.content.innerHTML=this.content,g.bubble.classList.remove("left","right","top","bottom"),g.bubble.classList.add(n.getArrow(this.placement));const e=n.placement(this.targetID,this.placement,g.bubble);let t;g.bubble.style.top=e.top.toString()+"px",g.bubble.style.left=e.left.toString()+"px",""!==this.targetID&&(t=document.getElementById(this.targetID)),r.walkupDoms(t,document.body,function(e){e.classList.add("unfocus")})}}class s extends r{constructor(e,t,o,n,i){super(e,t,o,n),this.steps=i,this.endStep=i[i.length-1].step}cancel(){super.cancel(),m(null)}done(){const e=y();e===this?super.done():(e.done(),e===this.endStep&&(m(null),g.progressBar.style.display="none",g.progressDone.style.width="0%",g.progressIndicator.style.width="0%"))}expect(e,t){const o=y();o!==this&&o.expect(e,t)}show(){const e=y();if(e===this){super.show(),m(this),this.begin=w()+1,this.end=this.begin+this.steps.length;const e=1/this.steps.length*100;g.progressIndicator.style.width=e+"%",g.progressBar.style.display="flex"}else{e.show();const t=(w()-this.begin)/this.steps.length*100;g.progressDone.style.width=t+"%"}}}class a extends r{constructor(e,t,o,n,i){super(t,o,n,i),this.expectAction=e,this.options.showNext=!1}action(e){R()}expect(e,t){this.expectAction===e&&this.action(t)}}class c extends a{constructor(e,t,o,n){super(i.action.cameraZoom,e,t,o,n)}action(e){v(!0)}}class d extends r{constructor(e,t,o,n,i){super(e,o,n,"",i),Number.isInteger(t)?(this.count=t,this.countDown=t):(this.selections=t,this.countDown=new Set(t))}expect(e,t){e===this.modeSelect&&(void 0!==this.count?0==--this.countDown?R():this.showSelectionCount():this.countDown.has(t)&&(this.countDown.delete(t),this.showSelectionCount()))}done(){g.select.textContent=""}show(){super.show(),this.showSelectionCount()}showSelectionCount(){void 0!==this.count&&(g.select.textContent="selection "+(this.count-this.countDown).toString()+" of "+this.count.toString())}}class l extends d{constructor(e,t,o,n,i){super(e,t,o,n,i),this.modeSelect="faceSelectOn"}}const u={};let h=null;const f={stops:new Map,routes:[],currentStation:-1};let p=null,g={};function v(e){g.next&&(g.next.style.display=e?"inline-block":"none")}function m(e){p=e}function x(){return p||f.routes[f.currentStation]}function y(){return f.routes[f.currentStation]}function w(){return f.currentStation}function b(e){const t=g.bubble.getElementsByClassName(e);if(t.length>0)return t[0]}function S(e){return t=e.nameId,!(f.stops.has(t)&&(console.log("bad step: already has ",t),1))&&(f.stops.set(e.nameId,f.routes.length),f.routes.push(e.step),!0);var t}function E(e,t,o,n,i,s){return{nameId:e,step:new r(t,o,n,i)}}function C(e,t,o,n,i,r){S(E(e,t,o,n,i))}function M(e,t,o,n,i,r,s){return{nameId:t,step:new a(e,o,n,i,r)}}function F(e,t,o,n,i,r,s){S(M(e,t,o,n,i,r))}function A(e,t,o,n,i,r){return{nameId:t,step:new l(e,o,n,i)}}function P(e,t,o,n,i,r){S(A(e,t,o,n,i))}function V(e,t,o,n,i,r){return{nameId:e,step:new c(t,o,n,i,r)}}function _(e,t,o,n,i,r){S(V(e,t,o,n,i,r))}function L(e,t,o,n,i,r){S({nameId:e,step:new s(t,o,n,i,r)});for(let e of r)S(e)}let I=function(e){if(e<0||e>=f.routes.length)console.log("bad step number in tutor guide");else{if(e===f.routes.length-1&&(g.next.textContent="Done"),f.currentStation>=0&&f.currentStation<f.routes.length){x().done()}f.currentStation=e;const t=x();v(t.option("showNext")),t.show()}};function B(e){i.interposeLog(D,!0),g.bubble.classList.remove("hide"),I(0)}function T(){f.currentStation>-1&&f.routes[f.currentStation].done(),g.bubble.classList.add("hide"),g.next.textContent="Next",f.stops.clear(),f.routes.length=0,f.currentStation=-1,i.interposeLog(D,!1)}function O(){T()}function R(){I(f.currentStation+1)}function D(e,t){if(f.currentStation>=0){x().expect(e,t),"createCube"===e&&(h=value)}}i.onReady(function(e){g.bubble=document.getElementById("tutorGuide"),g.bubble&&(g.close=b("close"),g.close&&g.close.addEventListener("click",function(e){O()}),g.next=b("next"),g.next&&g.next.addEventListener("click",function(e){"Done"===g.next.textContent?T():R()}),g.title=b("tutor-title"),g.content=b("tutor-content"),g.select=b("tutor-selection"),g.progressBar=b("tutor-progress"),g.progressDone=b("tutor-progress-done"),g.progressIndicator=b("tutor-progress-indicator"))})},function(e,t,o){"use strict";o.r(t),o.d(t,"uColorArray",function(){return r}),o.d(t,"colorArray",function(){return s}),o.d(t,"selectedColorLine",function(){return a}),o.d(t,"selectedColorPoint",function(){return c}),o.d(t,"textArray",function(){return d}),o.d(t,"cameraLight",function(){return l}),o.d(t,"solidColor",function(){return u}),o.d(t,"simplePoint",function(){return h}),o.d(t,"colorPoint",function(){return f}),o.d(t,"solidWireframe",function(){return p}),o.d(t,"edgeSolidWireframe",function(){return g}),o.d(t,"colorSolidWireframe",function(){return v});var n=o(4),i=o(0);let r={vertexShader:["attribute vec3 position;","uniform mat4 worldView;","uniform mat4 projection;","void main(void) {","   gl_Position = projection * worldView * vec4(position, 1.0);","}"].join("\n"),fragShader:["uniform lowp vec4 uColor;","void main(void) {","   gl_FragColor = uColor;","}"].join("\n")},s={vertexShader:["attribute vec3 aVertexPosition;","attribute vec3 aVertexColor;","uniform mat4 uMVMatrix;","uniform mat4 uPMatrix;","varying lowp vec4 vColor;","void main(void) {","   gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);","   vColor = vec4(aVertexColor, 1.0);","}"].join("\n"),fragShader:["varying lowp vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"].join("\n")},a={vertex:["attribute vec3 position;","attribute vec3 barycentric;","uniform mat4 projection;","uniform mat4 worldView;","varying vec3 vBC;","void main(){","vBC = barycentric;","gl_Position = projection * worldView * vec4(position, 1.0);","}"].join("\n"),fragment:["#extension GL_OES_standard_derivatives : enable","precision mediump float;","uniform vec4 faceColor;","uniform vec4 color;","uniform float lineWidth;","varying vec3 vBC;","float edgeFactor(){","vec3 d = fwidth(vBC);","vec3 a3 = smoothstep(vec3(0.0), d*lineWidth, vBC);","return min(min(a3.x, a3.y), a3.z);","}","void main(){","float edge = edgeFactor();","if (edge < 1.0) {","gl_FragColor = mix(color, faceColor, edge);","} else {","discard;","}","}"].join("\n")},c={vertex:["attribute vec3 position;","attribute float vertexState;","uniform mat4 worldView;","uniform mat4 projection;","uniform float vertexSize;","uniform float selectedVertexSize;","uniform float maskedVertexSize;","varying lowp float vState;","void main(void) {","   gl_Position = projection * worldView * vec4(position, 1.0);","   vState = vertexState;","   if (vertexState == 0.0) {","      gl_PointSize = vertexSize;","   } else if (vertexState < 1.0) {","      gl_PointSize = selectedVertexSize;","   } else {","      gl_PointSize = maskedVertexSize;","   }","}"].join("\n"),fragment:["precision lowp float;","varying lowp float vState;","uniform vec4 vertexColor;","uniform vec4 unselectedHilite;","uniform vec4 selectedHilite;","uniform vec4 selectedColor;","uniform vec4 maskedVertexColor;","void main(void) {","   if (vState < 0.0) {","      discard;","   } else if (vState == 0.0) {","      gl_FragColor = vertexColor;","   } else if (vState == 0.25) {","      gl_FragColor = selectedColor;","   } else if (vState == 0.5) {","      gl_FragColor = unselectedHilite;","   } else if (vState == 0.75) {","      gl_FragColor = selectedHilite;","   } else {","      gl_FragColor = maskedVertexColor;","   }","}"].join("\n")},d={vertexShader:["attribute vec4 aVertexPosition;","attribute vec2 aTexCoord;","uniform mat4 uMVMatrix;","uniform mat4 uPMatrix;","varying vec2 v_texcoord;","void main() {","gl_Position =  uPMatrix * uMVMatrix * aVertexPosition;","v_texcoord = aTexCoord;","}"].join("\n"),fragShader:["precision mediump float;","varying vec2 v_texcoord;","uniform sampler2D u_texture;","void main() {","gl_FragColor = texture2D(u_texture, v_texcoord);","}"].join("\n")},l={vertex:["attribute vec3 position;","uniform vec3 faceColor;","uniform mat4 worldView;","uniform mat4 projection;","varying vec3 vPosition;","varying vec3 vLight;","varying vec3 vColor;","void main(void) {","   gl_Position = projection * worldView * vec4(position, 1.0);","   vPosition =  (worldView * vec4(position, 1.0)).xyz;","   vColor = faceColor;","   vLight = vec3(0.0, 0.0, -1.0);","}"].join("\n"),fragment:["#extension GL_OES_standard_derivatives : enable","precision mediump float;\n","varying vec3 vPosition;","varying vec3 vLight;","varying vec3 vColor;","void main() {","  vec3 n = normalize(cross(dFdy(vPosition), dFdx(vPosition)));","  float diffuseFactor = dot(normalize(n), vLight);","  if (diffuseFactor > 0.0) {","    gl_FragColor = vec4(vColor * diffuseFactor, 1.0);","  } else {","    gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","  }","}"].join("\n")},u={vertex:["attribute vec3 position;","uniform mat4 worldView;","uniform mat4 projection;","void main(void) {","  gl_Position = projection * worldView * vec4(position, 1.0);","}"].join("\n"),fragment:["precision mediump float;","uniform vec4 faceColor;","void main(void) {","  gl_FragColor = faceColor;","}"].join("\n")},h={vertex:["attribute vec3 position;","attribute vec3 color;","uniform mat4 worldView;","uniform mat4 projection;","varying vec3 vColor;","void main() {","  vColor = color;","  gl_Position = projection * worldView * vec4(position, 1.0);","  gl_PointSize = 8.8;","}"].join("\n"),fragment:["precision mediump float;","varying vec3 vColor;","void main() {"," gl_FragColor = vec4(vColor, 1.0);","}"].join("\n")},f={vertex:["attribute vec3 position;","uniform mat4 worldView;","uniform mat4 projection;","void main() {","  gl_Position = projection * worldView * vec4(position, 1.0);","  gl_PointSize = 8.8;","}"].join("\n"),fragment:["precision lowp float;","uniform vec4 uColor;","void main() {","float distance = distance( gl_PointCoord, vec2(0.5,0.5) );","if ( distance >= 0.5 ) {","discard;","}","gl_FragColor = uColor;","}"].join("\n")},p={vertex:["attribute vec3 position;","attribute vec3 barycentric;","uniform mat4 projection;","uniform mat4 worldView;","varying vec3 vBC;","void main(){","vBC = barycentric;","gl_Position = projection * worldView * vec4(position, 1.0);","}"].join("\n"),fragment:["#extension GL_OES_standard_derivatives : enable","precision mediump float;","uniform vec4 color;","uniform vec4 faceColor;","varying vec3 vBC;","float edgeFactor(){","vec3 d = fwidth(vBC);","vec3 a3 = smoothstep(vec3(0.0), d*1.1, vBC);","return min(min(a3.x, a3.y), a3.z);","}","void main(){","gl_FragColor = mix(color, faceColor, edgeFactor());","}"].join("\n")},g={vertex:["attribute vec3 position;","attribute vec3 barycentric;","uniform mat4 projection;","uniform mat4 worldView;","varying vec3 vBC;","void main(){","vBC = barycentric;","gl_Position = projection * worldView * vec4(position, 1.0);","}"].join("\n"),fragment:["#extension GL_OES_standard_derivatives : enable","precision mediump float;","uniform vec4 color;","uniform vec4 faceColor;","uniform float lineWidth;","varying vec3 vBC;","float edgeFactor(){","vec3 d = fwidth(vBC);","vec3 a3 = smoothstep(vec3(0.0), d*lineWidth, vBC);","return min(min(a3.x, a3.y), a3.z);","}","void main(){","gl_FragColor = mix(color, faceColor, edgeFactor());","}"].join("\n")},v={vertex:["attribute vec3 position;","attribute vec3 barycentric;","attribute float selected;","uniform mat4 projection;","uniform mat4 worldView;","varying vec3 vBC;","varying float vSelected;","void main(){","vSelected = selected;","vBC = barycentric;","gl_Position = projection * worldView * vec4(position, 1.0);","}"].join("\n"),fragment:["#extension GL_OES_standard_derivatives : enable","precision mediump float;","uniform vec4 faceColor;","uniform vec4 selectedColor;","varying vec3 vBC;","varying float vSelected;","float edgeFactor(){","vec3 d = fwidth(vBC);","vec3 a3 = smoothstep(vec3(0.0), d*1.5, vBC);","return min(min(a3.x, a3.y), a3.z);","}","void main(){","vec4 interiorColor = faceColor;","if (vSelected == 1.0) {","  interiorColor = selectedColor;","}","gl_FragColor.rgb = mix(vec3(0.0), vec3(interiorColor), edgeFactor());","gl_FragColor.a = interiorColor[3];","}"].join("\n")};i.onReady(function(){l=n.gl.createShaderProgram(l.vertex,l.fragment),u=n.gl.createShaderProgram(u.vertex,u.fragment),h=n.gl.createShaderProgram(h.vertex,h.fragment),f=n.gl.createShaderProgram(f.vertex,f.fragment),p=n.gl.createShaderProgram(p.vertex,p.fragment),g=n.gl.createShaderProgram(g.vertex,g.fragment),v=n.gl.createShaderProgram(v.vertex,v.fragment),a=n.gl.createShaderProgram(a.vertex,a.fragment),c=n.gl.createShaderProgram(c.vertex,c.fragment)})},function(e,t,o){"use strict";o.r(t),o.d(t,"pref",function(){return s}),o.d(t,"view",function(){return a}),o.d(t,"getMouseMoveHandler",function(){return d}),o.d(t,"aimZoom",function(){return l}),o.d(t,"rotate",function(){return u}),o.d(t,"wheelRotate",function(){return h}),o.d(t,"wheelZoom",function(){return f}),o.d(t,"zoomStepAlt",function(){return p}),o.d(t,"zoomStep",function(){return g}),o.d(t,"zoom",function(){return v}),o.d(t,"pan",function(){return m}),o.d(t,"keyPan",function(){return x}),o.d(t,"keyPanLeftArrow",function(){return y}),o.d(t,"keyPanRightArrow",function(){return w}),o.d(t,"keyPanUpArrow",function(){return b}),o.d(t,"keyPanDownArrow",function(){return S}),o.d(t,"wheelPan",function(){return E});var n=o(5),i=o(0);class r extends n.MouseMoveHandler{constructor(){super(),this.saveView={origin:[0,0,0]},c(this.saveView,a)}handleMouseMove(e){4==e.buttons?m(e.movementX,0):u(e.movementX,e.movementY)}doIt(){}undo(){c(a,this.saveView)}}let s={cameraMode:"WingsCam",numButtons:3,camRotationSpeed:.5,panSpeed:25,panSpeedArrowKeys:50,wheelAdds:!1,whScrollInfo:!0,whPanSpeed:50,whRotationSpeed:.15,highLightZoomAim:!1,wheelZooms:!0,wheelZoomFactorAlt:5e-4,wheelZoomFactor:.005},a=function(){let e={origin:[0,0,0],azimuth:-45,elevation:25,distance:i.CAMERA_DIST,panX:0,panY:0,fov:45,zNear:.1,zFar:1e3};return{alongAxis:!1,isModified:!1,inverseCameraVectors:function(){var t=mat4.create();mat4.fromTranslation(t,vec3.fromValues(-e.panX,-e.panY,e.distance)),mat4.rotateX(t,t,-e.elevation*Math.PI/180),mat4.rotateY(t,t,-e.azimuth*Math.PI/180),mat4.translate(t,t,-e.origin);var o={x:[t[0],t[1],t[2]],y:[t[4],t[5],t[6]],z:[t[8],t[9],t[10]]};return vec3.normalize(o.x,o.x),vec3.normalize(o.y,o.y),vec3.normalize(o.z,o.z),o},get origin(){return e.origin},set origin(t){e.origin[0]==t[0]&&e.origin[1]==t[1]&&e.origin[2]==t[2]||(e.origin[0]=t[0],e.origin[1]=t[1],e.origin[2]=t[2],this.isModified=!0)},get azimuth(){return e.azimuth},set azimuth(t){t!=e.azimuth&&(e.azimuth=t,this.isModified=!0)},get elevation(){return e.elevation},set elevation(t){e.elevation!=t&&(e.elevation=t,this.isModified=!0)},get distance(){return e.distance},set distance(t){e.distance!=t&&(i.log(i.action.cameraZoom,t-e.distance),e.distance=t,this.isModified=!0)},get panX(){return e.panX},set panX(t){e.panX!=t&&(e.panX=t,this.isModified=!0)},get panY(){return e.panY},set panY(t){e.panY!=t&&(e.panY=t,this.isModified=!0)},get fov(){return e.fov},set fov(t){e.fov!=t&&(e.fov=t,this.isModified=!0)},get zNear(){return e.zNear},set zNear(t){e.zNear!=t&&(camear.zNear=t,this.isModified=!0)},get zFar(){return e.zFar},set zFar(t){e.zFar!=t&&(e.zFar=t,this.isModified=!0)}}}();function c(e,t){e.origin[0]=t.origin[0],e.origin[1]=t.origin[1],e.origin[2]=t.origin[2],e.azimuth=t.azimuth,e.elevation=t.elevation,e.distance=t.distance,e.panX=t.panX,e.panY=t.panY,e.fov=t.fov,e.zNear=t.zNear,e.zFar=t.zFar}function d(){return new r}function l(e,t){}function u(e,t){a.azimuth+=e*s.camRotationSpeed,a.elevation+=t*s.camRotationSpeed}function h(e,t){if(s.wheelZooms&&s.wheelAdds){var o=2*s.wheelRotationSpeed;a.azimuth=a.azimuth+e*o,a.elevation=a.elevation+t*o,a.alongAxis=!1}}function f(e,t){var o=Math.max(Math.abs(a.distance),.2)*(t*e);a.distance+=o}function p(e){s.wheelZooms&&f(s.wheelZoomFactorAlt,e)}function g(e){s.wheelZooms&&f(s.wheelZoomFactor,e)}function v(e){a.distance=a.distance+Math.max(Math.abs(a.distance),.2)*e/80}function m(e,t){const o=.05*a.distance/(101-s.panSpeed);a.panX+=e*o,a.panY+=t*o}function x(e,t){const o=a.distance*(s.panSpeedArrowKeys/100);a.panX+=e*o,a.panY+=t*o}function y(){x(.05,0)}function w(){x(-.05,0)}function b(){x(0,.05)}function S(){x(0,-.05)}function E(e,t){if(s.wheelZooms&&s.wheelAdds){const e=a.distance*(s.wheelPanSpeed/100);a.panX+=dx*e,a.panY-=dy*e}}i.onReady(function(){})},function(e,t,o){"use strict";o.r(t),o.d(t,"WingedEdge",function(){return i}),o.d(t,"HalfEdge",function(){return r}),o.d(t,"Vertex",function(){return s}),o.d(t,"Polygon",function(){return a}),o.d(t,"MeshAllocator",function(){return c}),o.d(t,"WingedTopology",function(){return d});o(2);var n=o(18);const i=function(e,t){this.index=-1,this.left=new r(e,this),this.right=new r(t,this),this.left.pair=this.right,this.left.next=this.right,this.right.pair=this.left,this.right.next=this.left,this.state=0};i.prototype[Symbol.iterator]=function*(){yield this.left,yield this.right},i.prototype.buildIndex=function(e,t,o){return this.left.face&&this.left.face.isVisible()&&(e[t++]=this.left.origin.index,e[t++]=this.right.origin.index,e[t++]=this.left.face.index+o),this.right.face&&this.right.face.isVisible()&&(e[t++]=this.right.origin.index,e[t++]=this.left.origin.index,e[t++]=this.right.face.index+o),t},i.prototype.isLive=function(){return null!==this.left.origin&&null!==this.right.origin},i.prototype.adjacent=function*(){let e=this.left.next.wingedEdge;yield e;let t=this.left.prev().wingedEdge;t!==e&&(yield t),e=this.right.next.wingedEdge,yield e,(t=this.right.prev().wingedEdge)!==e&&(yield t)},i.prototype.oneRing=function*(){for(let e of this){let t=e.next;e=e.pair;do{yield t.wingedEdge,t=t.pair.next}while(t!==e)}},i.prototype.eachVertex=function*(){yield this.left.origin,yield this.right.origin},i.prototype.wing=function*(){yield this.left.prev(),yield this.left,yield this.left.next,yield this.right.prev(),yield this.right,yield this.right.next},i.prototype.getNormal=function(e){this.left.face&&vec3.add(e,e,this.left.face.normal),this.right.face&&vec3.add(e,e,this.right.face.normal),vec3.normalize(e,e)};const r=function(e,t){this.next=null,this.origin=e,this.face=null,this.pair=null,this.wingedEdge=t};r.prototype.isBoundary=function(){return null===this.face},r.prototype.isNotBoundary=function(){return null!==this.face},r.prototype.destination=function(){return this.pair.origin},r.prototype.prevAux=function(){if(null!==this.face){let e=this;for(;e.next!==this;)e=e.next;return e}return null},r.prototype.prev=function(){if(this.pair.next===this)return this.pair;var e=this,t=this.origin.findInEdge(function(t,o){return t.next===e});return null===t&&console.log("HalfEdge.prev: link list is broken, cannot find prev"),t},r.prototype.eachEdge=function(e){var t=this;if(t)do{e(t),t=t.pair.next}while(t&&t!==this)};const s=function(e){this.vertex=e,this.outEdge=null};Object.defineProperty(s.prototype,"index",{get:function(){return this.vertex.byteOffset/(3*this.vertex.BYTES_PER_ELEMENT)}}),Object.defineProperty(s.prototype,"valence",{get:function(){let e=0,t=this.outEdge,o=t;if(o)do{++e,o=o.pair.next}while(o&&o!==t);return e}}),s.prototype.reorient=function(){let e=this.outEdge,t=this.outEdge;do{t.index<e.index&&(e=t),t=t.pair.next}while(t!==this.outEdge);this.outEdge=e},s.prototype.isLive=function(){return null!==this.outEdge},s.prototype.oneRing=function*(e){e||(e=this.outEdge);let t=e;do{const e=t.pair;yield e.origin,t=e.next}while(t!==e)},s.prototype.edgeRing=function*(e){e||(e=this.outEdge);let t=e;do{yield t,t=t.pair.next}while(t!==e)},s.prototype.eachInEdge=function(e){var t=this.outEdge,o=t;if(o)do{const t=o.pair;o=o.pair.next,e(t,this)}while(o&&o!==t)},s.prototype.findInEdge=function(e){var t=this.outEdge,o=t;if(o)do{if(e(o.pair,this))return o.pair;o=o.pair.next}while(o&&o!==t);return null},s.prototype.eachOutEdge=function(e){var t=this.outEdge,o=t;if(o)do{e(o,this),o=o.pair.next}while(o&&o!==t)},s.prototype.findOutEdge=function(e){var t=this.outEdge,o=t;if(o)do{if(e(o,this))return o;o=o.pair.next}while(o&&o!==t);return null},s.prototype.findFreeInEdge=function(){return this.findInEdge(function(e,t){return null===e.face})},s.prototype.linkEdge=function(e,t){if(null===this.outEdge)this.outEdge=e;else{var o=this.findFreeInEdge();if(null===o)return console.log("Error: Vertex.linkEdge: complex vertex "+this.index),!1;var n=o.next;o.next=e,t.next=n}return!0},s.prototype.unlinkEdge=function(e,t){const o=e.prev();if(this.outEdge===e){if(o===t)return void(this.outEdge=null);this.outEdge=o.pair}o.next=t.next},s.prototype.isIsolated=function(){return null===this.outEdge},s.prototype.numberOfEdge=function(){let e=0;const t=this.outEdge;let o=t;do{e++,o=o.pair.next}while(o!==t||e>1001);return e},s.prototype.getNormal=function(e){const t=this.outEdge;let o=t;const n=vec3.create(),i=vec3.create(),r=vec3.create();vec3.sub(n,o.destination().vertex,o.origin.vertex);do{o=o.pair.next,vec3.sub(i,o.destination().vertex,o.origin.vertex),vec3.cross(r,i,n),vec3.add(e,e,r),vec3.copy(n,i)}while(o!==t);vec3.normalize(e,e)};const a=function(e,t,o=n.Material.default){this.halfEdge=e,this.numberOfVertex=t,this.update(),this.index=-1,this.visible=!0,this.assignMaterial(o)};a.prototype.assignMaterial=function(e){e!==this.material&&(this.material&&this.material.unassigned(),this.material=e,e.assigned())},a.prototype.isLive=function(){return null!==this.halfEdge},a.prototype.isVisible=function(){return this.visible&&null!==this.halfEdge},a.prototype.buildIndex=function(e,t,o){for(let n of this.hEdges())e[t++]=n.origin.index,e[t++]=n.destination().index,e[t++]=o;return t},a.prototype.eachVertex=function(e){var t=this.halfEdge,o=t;do{e(o.origin),o=o.next}while(o!==t)},a.prototype.eachEdge=function(e){var t=this.halfEdge,o=t;do{let t=o.next;e(o),o=t}while(o!==t)},a.prototype.hEdges=function*(e=!1){if(e){const e=[];let t=this.halfEdge;do{e.push(t),t=t.next}while(t!==this.halfEdge);for(let t of e)yield t}else{const e=this.halfEdge;let t=e;do{let e=t.next;yield t,t=e}while(t!==e)}},a.prototype.adjacent=function*(){const e=new Set,t=this.halfEdge;let o=t;do{let t=o.pair.face;null===t||e.has(t)||(e.add(t),yield t),o=o.next}while(o!==t)},a.prototype.oneRing=function*(){const e=new Set;e.add(this);const t=this.halfEdge;let o=t;do{const t=o.origin;for(let o of t.edgeRing()){const t=o.face;null===t||e.has(t)||(e.add(t),yield t)}o=o.next}while(o!==t)},a.prototype.computeNormal=function(){const e=vec3.create(),t=vec3.create(),o=this.halfEdge.origin.vertex,n=this.halfEdge.next.origin.vertex,i=this.halfEdge.next.destination().vertex;vec3.sub(e,o,n),vec3.sub(t,i,n),this.normal||(this.normal=vec3.create()),vec3.cross(this.normal,t,e),vec3.normalize(this.normal,this.normal)},a.prototype.update=function(){const e=this.halfEdge;let t=e,o=e;this.numberOfVertex=0;do{if(o.face=this,++this.numberOfVertex,o.index<t.index&&(t=o),this.numberOfVertex>1001)return void console.log("something is wrong with polygon link list");o=o.next}while(o!==e);this.halfEdge=t,this.numberOfVertex>2&&this.computeNormal()},a.prototype.getCentroid=function(e){const t=this.halfEdge;let o=t,n=0;do{vec3.add(e,e,o.origin.vertex),++n,o=o.next}while(o!==t);vec3.scale(e,e,1/n)};const c=function(e=1024){var t=new ArrayBuffer(3*e*Float32Array.BYTES_PER_ELEMENT);this.buf={buffer:t,data:new Float32Array(t),len:0},this.vertices=[],this.edges=[],this.faces=[],this.free={vertices:[],edges:[],faces:[]},this.affected={vertices:new Set,edges:new Set,faces:new Set}};c.prototype.allocVertex=function(e,t){if(this.free.vertices.length>0){let o;if(void 0===t)o=this.vertices[this.free.vertices.pop()];else{const e=t.index;this.free.vertices=this.free.vertices.filter(function(t){return t!==e}),o=t}return o.vertex.set(e),this.affected.vertices.add(o),o}{if(this.buf.len+3>=this.buf.data.length){var o=new ArrayBuffer(Float32Array.BYTES_PER_ELEMENT*this.buf.len*2),n=new Float32Array(o);n.set(this.buf.data),this.vertices.forEach(function(e,t,n){e.vertex=new Float32Array(o,Float32Array.BYTES_PER_ELEMENT*t*3,3)}),this.buf.data=n,this.buf.buffer=o}let t=new Float32Array(this.buf.buffer,Float32Array.BYTES_PER_ELEMENT*this.buf.len,3);this.buf.len+=3,t[0]=e[0],t[1]=e[1],t[2]=e[2];var i=new s(t);return this.vertices.push(i),i}},c.prototype.allocEdge=function(e,t,o){let n,r;if(this.free.edges.length>0){if(void 0!==o){const e=o.wingedEdge.index;this.free.edges=this.free.edges.filter(function(t){return t!==e}),n=o.wingedEdge,r=o}else r=(n=this.edges[this.free.edges.pop()]).left;r.origin=e,r.pair.origin=t,this.affected.edges.add(n)}else(n=new i(e,t)).index=this.edges.length,this.edges.push(n),r=n.left;return r},c.prototype.allocPolygon=function(e,t,o){let n;if(this.free.faces.length>0){if(void 0!==o){const e=o.index;this.free.faces=this.free.faces.filter(function(t){return t!==e}),n=o}else n=this.faces[this.free.faces.pop()];n.halfEdge=e,n.numberOfVertex=t,n.update(),n.visible=!0,this.affected.faces.add(n)}else(n=new a(e,t)).index=this.faces.length,this.faces.push(n);return n},c.prototype._insertFreeList=function(e,t){for(var o=0,n=t.length-1;o<=n;){let i=o+(n-o>>>1),r=e-t[i];if(r>0)n=i-1;else{if(!(r<0))break;o=i+1}}t.splice(o,0,e)},c.prototype.freeVertex=function(e){e.outEdge=null,this._insertFreeList(e.index,this.free.vertices),this.affected.vertices.add(e)},c.prototype.freeHEdge=function(e){const t=e.pair;e.face=null,t.face=null,e.origin=null,t.origin=null,e.next=t,t.next=e,this._insertFreeList(e.wingedEdge.index,this.free.edges),this.affected.edges.add(e.wingedEdge)},c.prototype.freePolygon=function(e){e.halfEdge=null,e.numberOfVertex=0,this._insertFreeList(e.index,this.free.faces),this.affected.faces.add(e)},c.prototype.freeAll=function(e,t,o){function n(e,t){return t-e}for(let t of e)this.free.faces.push(t.index),t.halfEdge=null,t.numberOfVertex=0;this.free.faces.sort(n);for(let e of t)this.free.edges.push(e.index),e.left.face=null,e.left.origin=null,e.right.face=null,e.right.face=null,e.left.next=e.right,e.right.next=e.left;this.free.edges.sort(n);for(let e of o)this.free.vertices.push(e.index),e.outEdge=null;this.free.vertices.sort(n)},c.prototype.getVertices=function(e){return this.vertices[e]},c.prototype.clearAffected=function(){this.affected.vertices.clear(),this.affected.edges.clear(),this.affected.faces.clear()},c.prototype.addAffectedWEdge=function(e){this.affected.edges.add(e)},c.prototype.addAffectedFace=function(e){this.affected.faces.add(e)},c.prototype.addAffectedVertex=function(e){this.affected.vertices.add(e)},c.prototype.addAffectedEdgeAndFace=function(e){this.affected.vertices.add(e);const t=this;e.eachOutEdge(function(e){t.affected.edges.add(e.wingedEdge),null!==e.face&&t.affected.faces.add(e.face)})};const d=function(e){this.alloc=e,this.vertices=new Set,this.faces=new Set,this.edges=new Set};d.prototype.free=function(){this.alloc.freeAll(this.faces,this.edges,this.vertices),this.faces=new Set,this.edges=new Set,this.vertices=new Set},d.prototype.merge=function(e){const t=this;this.vertices=new Set(function*(){yield*t.vertices;for(let t of e())yield*t.vertices}()),this.edges=new Set(function*(){yield*t.edges;for(let t of e())yield*t.edges}()),this.faces=new Set(function*(){yield*t.faces;for(let t of e())yield*t.faces}())},d.prototype.separateOut=function(){const e=new Set,t=[];let o;function n(t){for(let i of t.hEdges()){const t=i.pair.face;null===t||e.has(t)||(e.add(t),o.add(t),n(t))}}for(let i of this.faces)if(!e.has(i)){e.add(i);let r=new d(this.alloc);(o=r.faces).add(i),n(i),t.push(r)}if(t.length>1){for(let e of t)for(let t of e.faces)for(let o of t.hEdges())e.vertices.add(o.origin),e.edges.add(o.wingedEdge);return t}return null},d.prototype.detachFace=function(e){const t=new Set,o=new Set;for(let n of e){this.faces.delete(n);for(let e of n.hEdges())t.add(e.origin),this.vertices.delete(e.origin),o.add(e.wingedEdge),this.edges.delete(e.wingedEdge)}return{vertices:t,edges:o}},d.prototype.sanityCheck=function(){let e=!0;for(let[n,i]of this.vertices.entries())if(i.isLive())if(i.outEdge.origin!==i)console.log("vertex "+n+" outEdge is wrong"),e=!1;else{var t=i.outEdge,o=t;let r=null,s=0;if(o)do{if(o.pair.next===t){r=o.pair;break}o=o.pair.next,s++}while(o&&o!==t&&s<101);null===r&&(console.log("vertex "+n+" is broken"),e=!1)}return e},d.prototype.addAffectedWEdge=function(e){this.alloc.addAffectedWEdge(e)},d.prototype.addAffectedFace=function(e){this.alloc.addAffectedFace(e)},d.prototype.addAffectedVertex=function(e){this.alloc.addAffectedVertex(e)},d.prototype.clearAffected=function(){this.alloc.clearAffected()},d.prototype.addAffectedEdgeAndFace=function(e){this.alloc.addAffectedEdgeAndFace(e)},d.prototype._createPolygon=function(e,t,o){const n=this.alloc.allocPolygon(e,t,o);return this.faces.add(n),n},d.prototype.addVertex=function(e,t){const o=this.alloc.allocVertex(e,t);return this.vertices.add(o),o},d.prototype._createEdge=function(e,t,o){const n=this.alloc.allocEdge(e,t,o);return this.edges.add(n.wingedEdge),n},d.prototype._freeVertex=function(e){this.vertices.delete(e)&&this.alloc.freeVertex(e)},d.prototype._freeEdge=function(e){this.edges.delete(e.wingedEdge)&&this.alloc.freeHEdge(e)},d.prototype._freePolygon=function(e){this.faces.delete(e)&&this.alloc.freePolygon(e)},d.prototype.getExtent=function(e,t){for(let o of this.vertices){const n=o.vertex;for(let o=0;o<3;++o)n[o]>t[o]?t[o]=n[o]:n[o]<e[o]&&(e[o]=n[o])}},d.prototype.addEdge=function(e,t,o){var n=this._createEdge(e,t,o).wingedEdge;return e.linkEdge(n.left,n.right)?t.linkEdge(n.right,n.left)?n.left:(e.unlinkEdge(n.left,n.right),this._freeEdge(n.right),null):(this._freeEdge(n.left),null)},d.prototype.findFreeInEdge=function(e,t){var o=e.pair;do{do{o=o.next.pair}while(!o.isBoundary());if(o!==t)return o}while(o!==e.pair);return console.log("WingedTopology.addFace.findFreeInEdge: patch re-linking failed"),null},d.prototype.spliceAdjacent=function(e,t){if(e.next===t)return!0;const o=e.next,n=t.prev(),i=this.findFreeInEdge(t,e);if(null===i)return console.log("WingedTopology.spliceAjacent: no free inedge, bad ajacency"),!1;if(i===n)e.next=t,n.next=o;else{const r=i.next;e.next=t,i.next=o,n.next=r}return!0},d.prototype._unwindNewEdges=function(e){for(let t of e){let e=t.pair;t.origin.unlinkEdge(t,e),e.origin.unlinkEdge(e,t),this._freeEdge(t)}},d.prototype.addPolygon=function(e){var t,o,n=e.length;if(n<3)return-1;var i=[],r=[];const s=new Set;for(t=0;t<n;++t){(o=t+1)==n&&(o=0);var a=this.alloc.getVertices(e[t]),c=this.alloc.getVertices(e[o]),d=this.findHalfEdge(a,c);if(null===d){if(null===(d=this.addEdge(a,c)))return this._unwindNewEdges(r),null;r.push(d),s.add(d.wingedEdge)}else{if(!d.isBoundary())return this._unwindNewEdges(r),console.log("non-manifold condition, no boundary"),null;if(s.has(d.wingedEdge))return this._unwindNewEdges(r),console.log("complex polygon detected"),null;s.add(d.wingedEdge)}i.push(d)}for(t=0;t<n;++t)if((o=t+1)==n&&(o=0),!this.spliceAdjacent(i[t],i[o]))return this._unwindNewEdges(r),console.log("non-manifold condition, cannot splice"),null;var l=this._createPolygon(i[0],e.length);for(t=0;t<n;++t)i[t].face=l;return l},d.prototype.findHalfEdge=function(e,t){return e.findOutEdge(function(e,o){return e.destination()===t})},d.prototype.insertEdge=function(e,t,o,n){const i=e.destination(),r=t.origin,s=e.face,a=this._createEdge(i,r,o),c=a.pair,d=e.next,l=t.prev();e.next=a,a.next=t,l.next=c,c.next=d;const u=this._createPolygon(a,4,n);a.face=u;let h=0;return u.eachEdge(function(e){++h,e.face=u}),u.numberOfVertex=h,c.face=s,s&&(s.halfEdge.face===u&&(s.halfEdge=c),h=0,s.eachEdge(function(e){++h}),s.numberOfVertex=h,this.addAffectedFace(s)),a},d.prototype.splitEdge=function(e,t,o){const n=e.pair,i=e.prev(),r=n.next,s=e.origin,a=s.outEdge,c=this.addVertex(t),d=this._createEdge(s,c,o),l=d.pair;return d.next=e,n.next=l,i.next=d,l.next=r,d.face=e.face,d.face.numberOfVertex++,l.face=n.face,l.face.numberOfVertex++,e.origin=c,c.outEdge=l,a===e&&(s.outEdge=d),this.addAffectedWEdge(e.wingedEdge),d},d.prototype.doubleEdge=function(e){const t=e.prev(),o=this._createEdge(e.destination(),e.origin),n=o.pair;o.next=e,n.next=e.next,e.next=o,t.next=n,n.face=e.face,e.face.halfEdge===e&&(n.face.halfEdge=n),this.addAffectedFace(n.face);this._createPolygon(o,2);return o},d.prototype.simpleSplit=function(e){const t=this._createEdge(e.destination(),e.next.origin);return t.next=e.next,e.next=t,t.face=e.face,t.face.numberOfVertex++,t},d.prototype.prepVertex=function(e,t,o,n,i,r){r||(r=t.origin);const s=n.get(r);let a,c=e,d=!0;do{(a=c.next).origin=r,c=a.pair,d&&(s.push(c),o.has(a.wingedEdge)||(d=!1,s.length=0,s.push(c)))}while(a!==t);if(i)for(let e of s)i.add(e)},d.prototype.prepVertexAdd=function(e,t,o,n,i){const r=this.addVertex(e.destination().vertex);return n.set(r,[]),this.prepVertex(e,t,o,n,i,r),r},d.prototype.isSplitEdgeSelected=function(e,t,o){for(let n of[e,t]){let e=0,t=0;for(let i of n.edgeRing())e++,o.has(i.wingedEdge)&&t++;if(3!==e)return!1;if(2!==t)return!1}return!0},d.prototype.bevelEdge=function(e){const t={vertices:[],halfEdges:[],collapsibleWings:new Set,selectedFaces:new Set},o=new Set,n=new Map,i=new Map,r=new Set,s=new Set;for(let n of e){const e=this.doubleEdge(n.left);t.selectedFaces.add(e.face),o.add(e.origin),o.add(e.destination()),i.set(n,e.wingedEdge),i.set(e.wingedEdge,n),t.collapsibleWings.add(e.wingedEdge)}for(let e of o){t.vertices.push(e),n.set(e,[]);let o=[];const a=e.outEdge;let c,d,l,u=a;do{let e=u.pair.next;i.has(u.wingedEdge)?i.get(u.wingedEdge)===e.wingedEdge&&o.push(u.pair):i.has(e.wingedEdge)||o.push(u.pair),u=e}while(u!==a);for(let e of o){if(c){const o=this.prepVertexAdd(c,e.pair,i,n,r);let s=this.simpleSplit(c);o.outEdge=s.pair,t.vertices.push(o),t.halfEdges.push(s.pair),d?s.pair.next=d.pair:l=s,d=s}c=e}if(1===o.length){const o=c.next.pair.next,r=this.doubleEdge(o.pair);i.set(o.wingedEdge,r.wingedEdge),i.set(r.wingedEdge,o.wingedEdge),t.selectedFaces.add(r.face);const s=this.prepVertexAdd(c,o,i,n),a=this.simpleSplit(c);s.outEdge=a.pair,t.vertices.push(s),t.halfEdges.push(a.pair);const d=a.pair;d.next=r,o.pair.next=d,d.face=r.face,d.face.numberOfVertex++;let l=n.get(e);l.push(r.pair),l.push(c.pair.next.pair),(l=n.get(s))[0]=l[0].prev()}else if(2===o.length){let e=o[0].next.pair;e.next=c.next,c.next=e,e.face=c.face,e.face.numberOfVertex++,this.addAffectedFace(e.face);const t=n.get(e.next.origin);if(this.isSplitEdgeSelected(e.next.origin,e.origin,i)){const o=e.next.pair;let i=o.prev();t.push(i),r.add(i);let a=o.next.next.pair;t.push(a),r.add(a);const c=n.get(e.origin);i=c[0].prev(),c[0]=i,r.add(i),a=c[1].pair.next.pair,c[1]=a,r.add(a),s.add(e.origin).add(e.destination())}else{const o=[];do{e=e.next.pair,o.push(e)}while(i.has(e.wingedEdge));if(e!==c.next)t.push(e),r.add(e);else{o.pop();for(let e of o)t.push(e),r.add(e)}}}else{this.prepVertex(c,o[0].pair,i,n,r);const e=this.simpleSplit(c);t.halfEdges.push(e.pair),e.pair.next=d.pair,l.pair.next=e.pair;const s=this._createPolygon(e.pair,o.length);t.selectedFaces.add(s)}}t.vertexLimit=Number.MAX_SAFE_INTEGER,t.position=new Float32Array(3*t.vertices.length),t.direction=new Float32Array(3*t.vertices.length);let a=0;const c=vec3.create();for(let e of t.vertices){const o=t.position.subarray(a,a+3),i=t.direction.subarray(a,a+3),d=n.get(e);let l=1;s.has(e)&&(l=.4);for(let n of d){vec3.copy(c,n.origin.vertex),vec3.copy(o,e.vertex),vec3.sub(c,c,o);let s=l;r.has(n.pair)&&(s=.5),t.vertexLimit=Math.min(vec3.length(c)*s,t.vertexLimit),vec3.normalize(c,c),vec3.add(i,i,c)}.4==l&&vec3.normalize(i,i),a+=3}return t},d.prototype.bevelVertex=function(e){const t={vertices:[],halfEdges:[],selectedFaces:[]},o=new Set;for(let n of e){let e,i=n.outEdge,r=i.pair.next,s=0;for(t.vertices.push(n),o.add(r);r!==n.outEdge;){const n=this.addVertex(r.origin.vertex);t.vertices.push(n),r.origin=n,n.outEdge=r,o.add(r);const a=r.pair.next;let c=this.simpleSplit(i.pair);t.halfEdges.push(c.pair),++s,e&&(c.pair.next=e.pair),e=c,i=r,r=a}if(s>1){let o=this.simpleSplit(i.pair);t.halfEdges.push(o),o.pair.next=e.pair;const r=n.outEdge.pair.next;r.pair.next=o.pair;const a=this._createPolygon(r.pair,s+1);t.selectedFaces.push(a)}}t.vertexLimit=Number.MAX_SAFE_INTEGER,t.position=new Float32Array(3*t.vertices.length),t.direction=new Float32Array(3*t.vertices.length);let n=0;for(let e of t.vertices){const i=t.position.subarray(n,n+3),r=t.direction.subarray(n,n+3);vec3.copy(i,e.vertex),vec3.sub(r,e.outEdge.destination().vertex,i),o.has(e.outEdge.pair)?t.vertexLimit=Math.min(.5*vec3.length(r),t.vertexLimit):t.vertexLimit=Math.min(vec3.length(r),t.vertexLimit),vec3.normalize(r,r),n+=3}return t},d.prototype.extrudeContours=function(e){let t=[];for(let o of e)for(let e of o){let o=[];o.push(e.inner.origin.index),o.push(e.outer.origin.index),o.push(e.outer.destination().index),o.push(e.inner.destination().index),this.addPolygon(o),t.push(this.findHalfEdge(e.inner.origin,e.outer.origin))}return t},d.prototype.findEdgeGroup=function(e){const t=new Set(e);let o=null;function n(e){t.delete(e),o.add(e);for(let o of e.oneRing())t.has(o)&&n(o)}let i=[];for(let e of t)o=new Set,n(e),i.push(o);return i},d.findFaceGroup=function(e){const t=new Set(e);let o=null;function n(e){t.delete(e),o.add(e),e.eachVertex(e=>{e.eachOutEdge(e=>{const o=e.pair.face;t.has(o)&&n(o)})})}let i=[];for(let e of t)o=new Set,n(e),i.push(o);return i},d.findContours=function(e){const t=new Set,o=[];for(let n of e)n.eachEdge(function(n){if(!t.has(n)&&!e.has(n.pair.face)){const i=[];let r=n;do{let o=r.next.pair;for(;o!==r&&e.has(o.face);)o=o.next.pair;const n={outer:r,inner:null};i.push(n),t.add(r),r=o.pair}while(r!==n);o.push(i)}});return o},d.prototype.weldContour=function(e){let t=e[e.length-1];for(let o=0;o<e.length;++o){const n=e[o];if(t.inner.next!==n.inner){const e=n.inner;let o,i=t.inner.next;t.outer.next=i;do{i.origin=n.outer.origin,i=(o=i.pair).next}while(i!==e);o.next=n.outer}n.outer.face=n.inner.face,n.inner.face.halfEdge===n.inner&&(n.outer.face.halfEdge=n.outer),t=n,this.addAffectedFace(n.outer.face)}for(let t of e)t.restore={origin:t.inner.origin,pt:vec3.clone(t.inner.origin.vertex),hEdge:t.inner},this._freeVertex(t.inner.origin),this._freeEdge(t.inner)},d.prototype._liftLoop=function(e){let t=e[e.length-1];for(let o=0;o<e.length;++o){let n=e[o],i=t.outer.next;if(i!==n.outer){let e=n.outer.prev();t.outer.next=n.outer,t.inner.next=i,e.next=n.inner;let o=i;do{o.origin.outEdge===o&&(o.origin.outEdge=n.outer),o.origin=n.inner.origin,o=o.pair.next}while(o!==n.inner)}t=n,n.inner.face=n.outer.face,n.outer.face=null,n.inner.face.halfEdge===n.outer&&(n.inner.face.halfEdge=n.inner),this.addAffectedFace(n.inner.face)}return e},d.prototype.liftContour=function(e){if(0===e.length)return e;let t=this.addVertex(e[0].outer.origin.vertex),o=t;for(let n=0;n<e.length;++n){let i,r=e[n].outer;i=n==e.length-1?t:this.addVertex(r.destination().vertex),e[n].inner=this.addEdge(o,i),o=i}return this._liftLoop(e)},d.prototype.restoreContour=function(e){if(0===e.length)return e;for(let t of e)this.addVertex(t.restore.pt,t.restore.origin);let t;for(let o=0;o<e.length;++o){const n=e[o],i=e[(o+1)%e.length],r=this._createEdge(n.restore.origin,i.restore.origin,n.restore.hEdge);n.restore.origin.outEdge=r,t&&(t.next=r,r.pair.next=t.pair),t=r}return t.next=e[0].inner,e[0].inner.pair.next=t.pair,this._liftLoop(e)},d.prototype.liftContours=function(e){for(let t of e)this.liftContour(t);return e},d.prototype._liftEdge=function(e,t,o,n){const i=e.prev(),r=t.next,s=this._createEdge(o,e.origin,n),a=s.pair;t.next=s,s.next=r,a.next=e,i.next=a,o.outEdge=s;let c=e;do{c.origin.outEdge===c&&(c.origin.outEdge=r),c.origin=o,this.addAffectedWEdge(c.wingedEdge),c=c.pair.next}while(c!==s);s.face=t.face,s.face&&(s.face.numberOfVertex++,this.addAffectedFace(s.face)),a.face=e.face,a.face&&(a.face.numberOfVertex++,this.addAffectedFace(a.face))},d.prototype._collapseEdge=function(e){const t=e.next,o=e.prev(),n=e.pair,i=n.next,r=n.prev(),s=e.origin,a=n.origin;let c=i;for(;c!==e;)c.origin=a,this.addAffectedWEdge(c.wingedEdge),c=c.pair.next;o.next=t,r.next=i;let d=e.face;return d&&(d.halfEdge===e&&(d.halfEdge=t),d.numberOfVertex--,this.addAffectedFace(d)),(d=n.face)&&(d.halfEdge===n&&(d.halfEdge=i),d.numberOfVertex--,this.addAffectedFace(d)),a.outEdge===n&&(a.outEdge=t),this._freeEdge(e),this._freeVertex(s),{hEdge:e,pairNext:i,prev:o,vertex:s}},d.prototype._restoreLoop=function(e,t,o){const n=e.prev(),i=this._createEdge(e.destination(),e.origin,t),r=i.pair;n.next=r,r.next=e.next,e.next=i,i.next=e,r.face=e.face;const s=this._createPolygon(i,2,o);e.face=s,i.face=s,r.face.halfEdge===e&&(r.face.halfEdge=r)},d.prototype._collapseLoop=function(e,t){t&&!t.has(e.wingedEdge)&&(e=e.next);const o=e.next,n=e.pair,i=o.pair;o.next=n.next,n.prev().next=o;let r=n.face;o.face=r,e.origin.outEdge===e&&(e.origin.outEdge=i),n.origin.outEdge===n&&(n.origin.outEdge=o),r.halfEdge===n&&(r.halfEdge=o);const s=e.face;return this._freePolygon(e.face),this._freeEdge(e),{next:o,hEdge:e,polygon:s}},d.prototype.collapseEdge=function(e,t){const o=e.next,n=e.pair.next,i=this._collapseEdge(e);return o.next.next===o&&(i.leftLoop=this._collapseLoop(o.next,t)),n.wingedEdge.isLive()&&n.next.next===n&&(i.rightLoop=this._collapseLoop(n,t)),i},d.prototype.restoreCollapseEdge=function(e){e.rightLoop&&this._restoreLoop(e.rightLoop.next,e.rightLoop.hEdge,e.rightLoop.polygon),e.leftLoop&&this._restoreLoop(e.leftLoop.next,e.leftLoop.hEdge,e.leftLoop.polygon),this._liftEdge(e.pairNext,e.prev,this.addVertex(e.vertex.vertex,e.vertex),e.hEdge)},d.prototype._removeEdge=function(e,t){const o=e.prev(),n=e.next,i=t.prev(),r=t.next;return o.next=r,i.next=e.next,e.origin.outEdge===e&&(e.origin.outEdge=o.pair),t.origin.outEdge===t&&(t.origin.outEdge=i.pair),{outPrev:o,outNext:n,outEdge:e}},d.prototype.removeEdge=function(e){let t=e.pair;null===t.face&&null!==e.face&&(e=t=e);const o=this._removeEdge(e,t),n=e.face,i=t.face;if(null!==i){i.halfEdge===t&&(i.halfEdge=o.outPrev),i.numberOfVertex=0;for(let e of i.hEdges())++i.numberOfVertex,e.face=i;this.addAffectedFace(i)}return null!==n&&(this._freePolygon(n),o.delFace=n),this._freeEdge(e),o},d.prototype.restoreRemoveEdge=function(e){this.insertEdge(e.outPrev,e.outNext,e.outEdge,e.delFace)},d.prototype.dissolveEdge=function(e,t){const o=e.pair;return e.next.pair.next===o?this.collapseEdge(o,t):o.next.pair.next===e?this.collapseEdge(e,t):this.removeEdge(e)},d.prototype.restoreDissolveEdge=function(e){e.outPrev?this.restoreRemoveEdge(e):this.restoreCollapseEdge(e)},d.prototype.connectVertex=function(e){const t=new Map;for(let o of e)o.eachOutEdge(function(e){let o=1;t.has(e.face)&&(o=t.get(e.face)+1),t.set(e.face,o)});const o=[];let n=[];for(let[i,r]of t)if(r>1){let t=-1,r=-1,s=i.halfEdge;for(;2==s.origin.valence;)s=s.next;const a=s;do{let o=s.origin.valence;if(t=r,2!=o&&r++,e.has(s.origin)){const e={prevEdgeNumber:t,edgeNumber:r,outEdge:s};n.push(e)}s=s.next}while(s!==a);const c=n[0];-1==c.prevEdgeNumber&&(c.prevEdgeNumber=r),o.push(n),n=[]}const i=[];for(let e of o){let t=!0,o=-1;for(let[n,i]of e.entries()){if(i.prevEdgeNumber!==i.edgeNumber||o==i.edgeNumber){t=!1;break}o=i.edgeNumber}if(t)if(2===e.length)i.push(this.insertEdge(e[0].outEdge.prev(),e[1].outEdge));else{const t=e[0].outEdge.prev();for(let o=0;o<e.length;++o){let n,r,s=e[o];o+1<e.length?(n=e[o+1],r=this.insertEdge(s.outEdge.prev(),n.outEdge)):r=this.insertEdge(s.outEdge.prev(),t.next),i.push(r)}}else{let t=e.length-1,o=0;do{let n=e[t],r=e[o];if(n.edgeNumber!=r.prevEdgeNumber){const e=this.insertEdge(n.outEdge.prev(),r.outEdge);i.push(e),t--}o++}while(o<t)}}return i},d.prototype.removePolygon=function(e){for(let t of e.hEdges())t.face=null;this._freePolygon(e)},d.prototype.dissolveVertex=function(e){const t=new Float32Array(3);if(vec3.copy(t,e.vertex),e.isIsolated())return this._freeVertex(e),{pt:t,vertex:e};{this.addAffectedEdgeAndFace(e);let o=0;const n=e.outEdge.pair;let i,r;e.eachInEdge(function(e){const t=e.next;r=e.pair,t.face.halfEdge===t&&(t.face.halfEdge=e),--t.face.numberOfVertex,e.next=t.next,t.next=r,r.origin=t.pair.origin,o++,i=e});const s=this._createPolygon(r,o),a=[];let c=e.outEdge;r=e.outEdge;do{let e=r.pair;r=r.next,e.next.next===e&&(e.pair===c&&(c=e.next),a.unshift(this._collapseLoop(e)))}while(r!==c);return this._freeVertex(e),{polygon:s,pt:t,vertex:e,undoCollapseLoop:a,lastIn:i,firstIn:n}}},d.prototype.restoreDissolveVertex=function(e){if(e.polygon){const t=this.addVertex(e.pt,e.vertex);for(let t of e.undoCollapseLoop)this._restoreLoop(t.next,t.hEdge,t.polygon);let o=e.lastIn,n=e.lastIn.next.pair,i=e.firstIn;do{let e=o.pair;e.origin=t;let n=i.pair;n.next=o.next,o.next=n,n.face=o.face,++n.face.numberOfVertex,i=o,o=e.next.pair}while(o!==n);t.outEdge=e.firstIn.pair,this._freePolygon(e.polygon),this.addAffectedEdgeAndFace(t)}else this.addVertex(e.pt,e.vertex);return e.vertex},d.prototype.bridgeFace=function(e,t,o){const n={target:{face:e,hEdge:e.halfEdge},source:{face:t,hEdge:t.halfEdge}},i=[],r=[];for(let t of e.hEdges())i.push(t),t.face=null;for(let e of t.hEdges()){const t=vec3.clone(e.origin.vertex);vec3.add(t,t,o),r.unshift({hEdge:e,delta:t}),e.face=null}let s=-1,a=Number.MAX_SAFE_INTEGER;const c=vec3.create();for(let e=0;e<t.numberOfVertex;++e){let t=0;for(let e=0;e<i.length;++e)vec3.sub(c,i[e].origin.vertex,r[e].delta),a+=vec3.length(c);t<a&&(a=t,s=e),r.push(r.shift())}r.unshift.apply(r,r.splice(s-1,r.length)),this._freePolygon(e),this._freePolygon(t);let d=null;const l=[];for(let e=0;e<i.length;++e){const t=this.addEdge(r[e].hEdge.origin,i[e].origin);d&&this._createPolygon(d,4),l.push(t),d=t}return this._createPolygon(d,4),n.hEdges=l,n},d.prototype.undoBridgeFace=function(e){for(let t of e.hEdges)this.removePolygon(t.face);for(let t of e.hEdges)this._removeEdge(t,t.pair);this._createPolygon(e.target.hEdge,e.hEdges.length,e.target.face),this._createPolygon(e.source.hEdge,e.hEdges.length,e.source.face)},d.prototype.findInsetContours=function(e){const t=[];for(let o of e){const e=[];for(let t of o.hEdges()){const o={outer:t,inner:null};e.push(o)}t.push(e)}return t},d.prototype._liftDanglingEdge=function(e,t){const o=e.next,n=this._createEdge(o.origin,t);return t.outEdge=n.pair,e.next=n,n.pair.next=o,n.face=n.pair.face=e.face,n},d.prototype.liftCornerEdge=function(e,t=.2){const o=vec3.create(),n=vec3.create();let i=e.next;vec3.lerp(o,i.origin.vertex,i.destination().vertex,t),vec3.sub(n,e.origin.vertex,e.destination().vertex),vec3.scale(n,n,t),vec3.add(o,o,n);let r=this.addVertex(o);return this._liftDanglingEdge(e,r)},d.prototype.extrudeEdge=function(e,t){const o=[],n=[];let i=e,r=e.next,s=r.next;vec3.create();for(;s!==t;){let e=this.liftCornerEdge(r);o.push(e.pair);let t=this.insertEdge(e,i);n.push(t),i=e.pair,r=s,s=s.next}let a=this.insertEdge(s,i);return n.push(a),{extrude:n,lift:o}},d.prototype.slideToPrev=function(e,t){t||(t=e.prev().prev());const o=t.next,n=e.pair;if(e.face.numberOfVertex<=3){const t={inEdge:e,delFace:e.face,inNext:e.next,inPrev:e.prev()};return this.this.removeEdge(e),t}return o.next=n.next,n.next=o,t.next=e,e.origin.outEdge===e&&(e.origin.outEdge=o.next),e.origin=o.origin,o.face.halfEdge===o&&(o.face.halfEdge=n),o.face=n.face,++n.face.numberOfVertex,--e.face.numberOfVertex,{inEdge:n}},d.prototype.slideToNext=function(e){if(e.face.numberOfVertex<=3){const t={inEdge:e,delFace:e.face,inNext:e.next,inPrev:e.prev()};return this.removeEdge(e),t}const t=e.pair,o=e.next,n=t.prev();return n.next=o,e.next=o.next,o.next=t,t.origin.outEdge===t&&(t.origin.outEdge=o),t.origin=e.next.origin,this.addAffectedWEdge(t.wingedEdge),o.face.halfEdge===o&&(o.face.halfEdge=e),e.face=o.face,o.face=t.face,++t.face.numberOfVertex,--e.face.numberOfVertex,this.addAffectedFace(t.face),this.addAffectedFace(e.face),{prevPrev:n,outEdge:t}},d.prototype.undoSlideToNext=function(e){e.delFace?this.insertEdge(e.inPrev,e.inNext,e.inEdge,e.delFace):this.slideToPrev(e.outEdge,e.prevPrev)},d.prototype.insertFan=function(e,t){const o=vec3.create();e.getCentroid(o);let n=this.addVertex(o);const i=[];let r;for(let o of e.hEdges())t.has(o)&&(void 0!==r?(r=this.insertEdge(o,r.pair),i.unshift(r.pair)):(r=this._liftDanglingEdge(o,n),i.unshift(r)));return i},d.prototype.invert=function(){const e=[];for(let t of this.faces)for(let o of t.hEdges())e.push({hEdge:o.next.pair,next:o.pair});for(let{hEdge:t,next:o}of e)t.next=o;for(let e of this.edges){let t=e.left.face;t.halfEdge===e.left&&(t.halfEdge=e.right),e.left.face=e.right.face,e.left.face.halfEdge===e.right&&(e.left.face.halfEdge=e.left),e.right.face=t}},d.prototype.flip=function(e,t){const o=2*e[t];for(let e of this.vertices)e.vertex[t]=o-e.vertex[t],this.addAffectedEdgeAndFace(e)},d.prototype.makeHole=function(e){let t={hEdge:e.halfEdge,face:e,dissolveEdges:[]};for(let o of e.hEdges(!0)){o.face=null,null===o.pair.face&&t.dissolveEdges.unshift(this.dissolveEdge(o))}return this._freePolygon(e),t},d.prototype.undoHole=function(e){for(let t of e.dissolveEdges)e.face.isLive()||(t.delFace=e.face),this.restoreDissolveEdge(t);return e.face.isLive()?e.face:this._createPolygon(e.hEdge,4,e.face)}},function(e,t,o){"use strict";o.r(t),o.d(t,"BodyMadsor",function(){return f}),o.d(t,"DeleteBodyCommand",function(){return v}),o.d(t,"DuplicateBodyCommand",function(){return x}),o.d(t,"RenameBodyCommand",function(){return m});var n=o(7),i=o(14),r=o(16),s=o(15),a=o(5),c=o(2),d=o(1),l=o(3),u=o(6),h=o(0);class f extends n.Madsor{constructor(){super("Body");const e=this;l.bindMenuItemMode(h.action.bodyDelete.name,function(t){const o=new v(e.getSelected());d.undoQueue(o),o.doIt()},this,"Backspace"),l.bindMenuItem(h.action.bodyRename.name,function(t){l.runDialog("#renameDialog",t,function(t){const o=l.extractDialogValue(t),n=new m(e.getSelected(),o);d.undoQueue(n),n.doIt()},function(t){l.addLabelInput(t,e.getSelected())})});const t=[h.action.bodyDuplicateMoveX,h.action.bodyDuplicateMoveY,h.action.bodyDuplicateMoveZ];for(let o=0;o<3;++o)l.bindMenuItem(t[o].name,function(t){d.attachHandlerMouseMove(new y(e,o,e.getSelected()))});l.bindMenuItem(h.action.bodyDuplicateMoveFree.name,function(t){d.attachHandlerMouseMove(new w(e,e.getSelected()))}),l.bindMenuItem(h.action.bodyInvert.name,e=>{const t=new b(this);t.doIt(),d.undoQueue(t)}),l.bindMenuItem(h.action.bodyCombine.name,e=>{const t=new S(this);t.doIt()&&d.undoQueue(t)}),l.bindMenuItem(h.action.bodySeparate.name,e=>{const t=new E(this);t.doIt()&&d.undoQueue(t)});const o=[h.action.bodyFlipX,h.action.bodyFlipY,h.action.bodyFlipZ];for(let e=0;e<3;++e)l.bindMenuItem(o[e].name,t=>{const o=new C(this,e);o.doIt(),d.undoQueue(o)});const i=[[1,0,0],[0,1,0],[0,0,1]],r=[h.action.bodySliceX,h.action.bodySliceY,h.action.bodySliceZ];for(let e=0;e<3;++e)l.bindMenuItem(r[e].name,t=>{l.runDialog("#sliceBodyDialog",t,t=>{const o=t.querySelector('input[name="amountRange"');if(o){const t=parseInt(o.value,10);if(NaN!=t&&t>0&&t<100){const o=new n.GenericEditCommand(this,this.slice,[i[e],t],this.undoPlaneCut);if(o.doIt()){d.currentMode().andConnectVertex(o)}}}})});l.bindMenuItem(h.action.bodyWeld.name,e=>{const t=new n.GenericEditCommand(this,this.weld,void 0,this.undoWeld);t.doIt()&&d.undoQueue(t)})}getSelected(){const e=[];for(let t of this.selectedCage())e.push(t);return e}snapshotPosition(){return this.snapshotSelected(c.PreviewCage.prototype.snapshotBodyPosition)}snapshotTransformGroup(){return this.snapshotSelected(c.PreviewCage.prototype.snapshotTransformBodyGroup)}combine(e){if(void 0===e){e=[];for(let t of this.selectedCage())e.push(t)}if(e.length>=2){const t=d.makeCombineIntoWorld(e);return t.name=e[0].name,t.selectBody(),{combine:t,oldSelection:e}}return null}undoCombine(e){if(e){d.removeFromWorld(e.combine);for(let t of e.oldSelection)d.addToWorld(t)}}separate(){const e=[];for(let t of this.selectedCage()){let o=t.separate();o.length>0&&e.push({preview:t,snapshot:o})}for(let t of e){d.removeFromWorld(t.preview);for(let e of t.snapshot)d.addToWorld(e)}return e}undoSeparate(e){for(let t of e){for(let e of t.snapshot)d.removeFromWorld(e);d.addToWorld(t.preview)}}invert(){for(let e of this.selectedCage())e.invertBody();d.updateWorld(),this.hiliteView=null}flipAxis(e,t){this.doAll(e,c.PreviewCage.prototype.flipBodyAxis,t),d.updateWorld()}planeCuttable(e){return this.resultAll(c.PreviewCage.prototype.planeCuttableFace,e)}planeCut(e){return this.snapshotSelected(c.PreviewCage.prototype.planeCutBody,e)}undoPlaneCut(e){this.doAll(e,c.PreviewCage.prototype.collapseSplitOrBevelEdge),d.restoreBodyMode(e)}slice(e,t){const o=this.snapshotSelected(c.PreviewCage.prototype.sliceBody,e,t);return d.restoreVertexMode(o),o}weld(e=.001){const t={min:vec3.fromValues(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),max:vec3.fromValues(Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE)},o=[];for(let e of this.selectedCage())e.getBodySelection(o,t);let n=u.getAxisOrder(t);o.sort((e,t)=>{for(let o=0;o<3;++o){let i=e.center[n[o]]-t.center[n[o]];if(0!==i)return i}return e.polygon.index-t.polygon.index});const i=c.PreviewCage.findOverlapFace(n,o,e),r=c.PreviewCage.findWeldContours(i);if(!1!==r){const e=c.PreviewCage.weldHole(i),t=[],o=new Map;for(let e of r.combineCages){const n=this.combine(e);o.set(e,n),t.push(n)}const n=c.PreviewCage.weldBody(o,r);return d.restoreVertexMode(t),[{holes:e,weldContours:n,combinedCages:t}]}return[]}undoWeld(e){const t=e[0];d.restoreBodyMode(),c.PreviewCage.undoWeldBody(t.weldContours);for(let e of t.combinedCages)this.undoCombine(e);c.PreviewCage.undoWeldHole(t.holes)}centroid(){return this.snapshotSelected(c.PreviewCage.prototype.bodyCentroid)}dragSelect(e,t,o,n){t.edge}selectStart(e,t){if(null!==t.cage){var o=e.selectBody();return new p(this,e,t.edge,o)}}selectBody(e){for(let t of e)t.selectBody()}similarSelection(){const e=new Set;for(let t of this.selectedCage()){const o=t._getGeometrySize(),n=3*o.vertex+2*o.edge+o.face;e.add(n)}const t=[];for(let o of this.notSelectedCage()){const n=o._getGeometrySize(),i=3*n.vertex+2*n.edge+n.face;e.has(i)&&(o.selectBody(),t.push(o))}return t.length>0&&{undo:this.selectBody,snapshots:t}}adjacentSelection(){return!1}moreSelection(){return!1}_resetSelection(e){e._resetSelectBody()}_restoreSelection(e,t){e.restoreBodySelection(t)}toggleFunc(e){var t,o;e instanceof i.FaceMadsor?(t=d.restoreFaceMode,o=this.snapshotSelected(c.PreviewCage.prototype.changeFromBodyToFaceSelect)):e instanceof s.VertexMadsor?(t=d.restoreVertexMode,o=this.snapshotSelected(c.PreviewCage.prototype.changeFromBodyToVertexSelect)):e instanceof r.EdgeMadsor?(t=d.restoreEdgeMode,o=this.snapshotSelected(c.PreviewCage.prototype.changeFromBodyToEdgeSelect)):(t=d.restoreMultiMode,o=this.snapshotSelected(c.PreviewCage.prototype.changeFromBodyToMultiSelect)),d.undoQueue(new n.ToggleModeCommand(t,d.restoreBodyMode,o))}restoreMode(e,t){e instanceof i.FaceMadsor?this.doAll(t,c.PreviewCage.prototype.restoreFromBodyToFaceSelect):e instanceof s.VertexMadsor?this.doAll(t,c.PreviewCage.prototype.restoreFromBodyToVertexSelect):e instanceof r.EdgeMadsor?this.doAll(t,c.PreviewCage.prototype.restoreFromBodyToEdgeSelect):this.doAll(t,c.PreviewCage.prototype.restoreFromBodyToMultiSelect)}}class p extends n.DragSelect{constructor(e,t,o,n){super(e,t,o,n)}finish(){return new g(this.select)}}class g extends a.EditCommand{constructor(e){super(),this.select=e}doIt(){for(var[e,t]of this.select)t.length>0&&e.selectBody()}undo(){this.doIt()}}class v extends a.EditCommand{constructor(e){super(),this.previewCages=e}doIt(){this.undoCage=[];for(let e of this.previewCages)this.undoCage.push([e,e.parent]),d.removeFromWorld(e)}undo(){for(let[e,t]of this.undoCage)d.addToWorld(e,t)}}class m extends a.EditCommand{constructor(e,t){super(),this.previewCages=e,this.newName=t,this.oldName=new Map}doIt(){for(let e of this.previewCages)this.newName.hasOwnProperty(e.uuid)&&(this.oldName.has(e)||this.oldName.set(e,e.name),e.name=this.newName[e.uuid],geometryStatus("Object new name is "+e.name))}undo(){for(let[e,t]of this.oldName)e.name=t,geometryStatus("Object restore name to "+e.name)}}class x extends a.EditCommand{constructor(e){super(),this.originalCages=e,this.duplicateCages=[];for(let t of e){let e=c.PreviewCage.duplicate(t);this.duplicateCages.push(e)}}_toggleOriginalSelected(){for(let e of this.originalCages)e.selectBody()}doIt(){for(let e of this.duplicateCages)d.addToWorld(e),e.selectBody();this._toggleOriginalSelected()}undo(){for(let e of this.duplicateCages)e.selectBody(),d.removeFromWorld(e);this._toggleOriginalSelected()}}class y extends n.MouseMoveAlongAxis{constructor(e,t,o){const n=new x(o);n.doIt(),super(e,t),this.duplicateBodyCommand=n}doIt(){this.duplicateBodyCommand.doIt(),super.doIt()}undo(){super.undo(),this.duplicateBodyCommand.undo()}}class w extends n.MoveFreePositionHandler{constructor(e,t){const o=new x(t);o.doIt(),super(e),this.duplicateBodyCommand=o}doIt(){return this.duplicateBodyCommand.doIt(),super.doIt(),!0}undo(){super.undo(),this.duplicateBodyCommand.undo()}}class b extends a.EditCommand{constructor(e){super(),this.madsor=e}doIt(){return this.madsor.invert(),!0}undo(){this.madsor.invert()}}class S extends a.EditCommand{constructor(e){super(),this.madsor=e}doIt(){return this.combine=this.madsor.combine(),!!this.combine}undo(){this.madsor.undoCombine(this.combine),this.combine=null}}class E extends a.EditCommand{constructor(e){super(),this.madsor=e}doIt(){return this.separate=this.madsor.separate(),this.separate.length>0}undo(){this.madsor.undoSeparate(this.separate),this.separate=null}}class C extends a.EditCommand{constructor(e,t){super(),this.madsor=e,this.axis=t,this.pivot=e.centroid()}doIt(){return this.madsor.flipAxis(this.pivot,this.axis),!0}undo(){this.madsor.flipAxis(this.pivot,this.axis)}}},function(e,t,o){"use strict";o.r(t),o.d(t,"FaceMadsor",function(){return h});var n=o(7),i=o(16),r=o(13),s=o(15),a=o(5),c=o(2),d=o(1),l=o(3),u=o(0);class h extends n.Madsor{constructor(){super("Face");var e=this;l.bindMenuItemMode(u.action.faceDissolve.name,function(t){const o=new g(e);o.doIt()?d.undoQueue(o):geometryStatus("Selected Face not dissolveable")},this,"Backspace"),l.bindMenuItem(u.action.faceCollapse.name,function(t){const o=new v(e);o.doIt(),d.undoQueue(o)}),l.bindMenuItem(u.action.faceBridge.name,e=>{let t=this.getBridgeFaces();if(2===t.length){const e=t[0],o=t[1];if(e.face.numberOfVertex==o.face.numberOfVertex){let t,n;e.preview!==o.preview?((t=new x(e.preview,o.preview)).doIt(),n=new m(t.getCombine(),e.face,o.face)):n=new m(e.preview,e.face,o.face),n.doIt(),t?d.undoQueueCombo([t,n]):d.undoQueue(n)}}}),l.bindMenuItem(u.action.faceInset.name,e=>{this.hasSelection()?d.attachHandlerMouseMove(new y(this)):geometryStatus("No selected face")}),l.bindMenuItem(u.action.faceBump.name,e=>{d.attachHandlerMouseMove(new w(this))}),l.bindMenuItem(u.action.faceIntrude.name,e=>{d.attachHandlerMouseMove(new b(this))}),l.bindMenuItem(u.action.faceLift.name,e=>{const t=this.snapshotSelected(c.PreviewCage.prototype.snapshotTransformFaceGroup);if(1===t.length){const e=t[0];d.attachHandlerMouseSelect(new S(this,e.preview))}}),l.bindMenuItem(u.action.facePutOn.name,e=>{let t=[];for(let e of this.selectedCage())1==e.selectionSize()&&t.push(e);if(1==t.length){const e=new E(this,t[0]);d.attachHandlerMouseSelect(e)}else geometryStatus("You can only PutOn one face")}),l.bindMenuItem(u.action.faceMirror.name,e=>{const t=new C(this);t.doIt(),d.undoQueue(t)}),l.bindMenuItem(u.action.faceFlattenNormal.name,e=>{const t=new n.GenericEditCommand(this,this.flatten);t.doIt()&&d.undoQueue(t)})}snapshotPosition(){return this.snapshotSelected(c.PreviewCage.prototype.snapshotFacePosition)}snapshotPositionAndNormal(){return this.snapshotSelected(c.PreviewCage.prototype.snapshotFacePositionAndNormal)}snapshotTransformGroup(){return this.snapshotSelected(c.PreviewCage.prototype.snapshotTransformFaceGroup)}bevel(){return this.snapshotSelected(c.PreviewCage.prototype.bevelFace)}undoBevel(e,t){this.restoreSelectionPosition(e),this.doAll(e,c.PreviewCage.prototype.collapseSplitOrBevelEdge),this.resetSelection(),this.restoreSelection(t)}bump(){return this.snapshotSelected(c.PreviewCage.prototype.bumpFace)}undoBump(e){this.doAll(e,c.PreviewCage.prototype.undoExtrudeEdge)}extrude(){return this.snapshotSelected(c.PreviewCage.prototype.extrudeFace)}undoExtrude(e){this.doAll(e,c.PreviewCage.prototype.collapseExtrudeEdge)}collapseEdgeNew(e){this.doAll(e,c.PreviewCage.prototype.collapseExtrudeEdge)}dissolve(){return this.snapshotSelected(c.PreviewCage.prototype.dissolveSelectedFace)}undoDissolve(e){this.doAll(e,c.PreviewCage.prototype.undoDissolveFace)}collapse(){return this.snapshotSelected(c.PreviewCage.prototype.collapseSelectedFace)}undoCollapse(e){this.doAll(e,c.PreviewCage.prototype.undoCollapseFace)}intrude(){return this.snapshotSelected(c.PreviewCage.prototype.intrudeFace)}undoIntrude(e){return this.doAll(e,c.PreviewCage.prototype.undoIntrudeFace)}getBridgeFaces(){const e=[];for(let t of this.selectedCage()){const o=t.snapshotSelection();for(let n of o)e.push({preview:t,face:n})}return e}inset(){return this.snapshotSelected(c.PreviewCage.prototype.insetFace)}mirror(){return this.snapshotSelected(c.PreviewCage.prototype.mirrorFace)}undoMirror(e){return this.doAll(e,c.PreviewCage.prototype.undoMirrorFace)}flatten(e){return this.snapshotSelected(c.PreviewCage.prototype.flattenFace,e)}planeCuttable(e){return this.resultAll(c.PreviewCage.prototype.planeCuttableFace,e)}planeCut(e){return this.snapshotSelected(c.PreviewCage.prototype.planeCutFace,e)}undoPlaneCut(e){this.doAll(e,c.PreviewCage.prototype.collapseSplitOrBevelEdge),d.restoreFaceMode(e)}assignMaterial(e){return this.snapshotSelected(c.PreviewCage.prototype.assignFaceMaterial,e)}undoAssignMaterial(e){return this.doAll(e,c.PreviewCage.prototype.undoAssignFaceMaterial)}dragSelect(e,t,o,n){null!==t.face&&e.dragSelectFace(t.face,n)&&o.push(t.face)}selectStart(e,t){if(null!==t.face){var o=e.selectFace(t.face);return new f(this,e,t.face,o)}}isFaceSelectable(){return!0}_resetSelection(e){e._resetSelectFace()}_restoreSelection(e,t){e.restoreFaceSelection(t)}toggleFunc(e){var t,o;e instanceof i.EdgeMadsor?(t=d.restoreEdgeMode,o=this.snapshotSelected(c.PreviewCage.prototype.changeFromFaceToEdgeSelect)):e instanceof s.VertexMadsor?(t=d.restoreVertexMode,o=this.snapshotSelected(c.PreviewCage.prototype.changeFromFaceToVertexSelect)):e instanceof r.BodyMadsor?(t=d.restoreBodyMode,o=this.snapshotSelected(c.PreviewCage.prototype.changeFromFaceToBodySelect)):(t=d.restoreMultiMode,o=this.snapshotSelected(c.PreviewCage.prototype.changeFromFaceToMultiSelect)),d.undoQueue(new n.ToggleModeCommand(t,d.restoreFaceMode,o))}restoreMode(e,t){e instanceof i.EdgeMadsor?this.doAll(t,c.PreviewCage.prototype.restoreFromFaceToEdgeSelect):e instanceof s.VertexMadsor?this.doAll(t,c.PreviewCage.prototype.restoreFromFaceToVertexSelect):e instanceof r.BodyMadsor?this.doaAll(t,c.PreviewCage.prototype.restoreFromFaceToBodySelect):this.doAll(t,c.PreviewCage.prototype.restoreFromFaceToMultiSelect)}}class f extends n.DragSelect{constructor(e,t,o,n){super(e,t,o,n)}finish(){return new p(this.select)}}class p extends a.EditCommand{constructor(e){super(),this.select=e}doIt(){for(var[e,t]of this.select)for(var o=0;o<t.length;++o)e.selectFace(t[o])}undo(){this.doIt()}}class g extends a.EditCommand{constructor(e){super(),this.madsor=e}doIt(){const e=this.madsor.dissolve();return e.length>0&&(this.dissolve=e,!0)}undo(){this.madsor.undoDissolve(this.dissolve)}}class v extends a.EditCommand{constructor(e){super(),this.madsor=e}doIt(){const e=this.madsor.collapse();return e.length>0&&(this.collapse=e,d.restoreVertexMode(this.collapse),!0)}undo(){d.currentMode().resetSelection(),this.madsor.undoCollapse(this.collapse),d.restoreFaceMode(this.collapse)}}class m extends a.EditCommand{constructor(e,t,o){super(),this.cage=e,this.target=t,this.source=o}doIt(){this.bridge=this.cage.bridge(this.target,this.source)}undo(){this.cage.undoBridge(this.bridge),this.cage.restoreFaceSelection(this.bridge)}}class x extends a.EditCommand{constructor(e,t){super(),this.targetCage=e,this.sourceCage=t}getCombine(){return this.combine}doIt(){return this.combine=d.makeCombineIntoWorld([this.targetCage,this.sourceCage]),this.combine.name=this.targetCage.name,!0}undo(){d.removeFromWorld(this.combine),d.addToWorld(this.targetCage),d.addToWorld(this.sourceCage)}}class y extends n.MovePositionHandler{constructor(e){super(e),this.movement=0,this.doIt()}doIt(){this.snapshots=this.madsor.inset(),this.madsor.moveSelection(this.snapshots,this.movement),this.vertexLimit=Number.MAX_SAFE_INTEGER;for(let e of this.snapshots)this.vertexLimit=Math.min(this.vertexLimit,e.snapshot.vertexLimit)}handleMouseMove(e){let t=this._calibrateMovement(e.movementX);return this.movement+t>this.vertexLimit?t=this.vertexLimit-this.movement:this.movement+t<0&&(t=0-this.movement),this.movement+=t,this.madsor.moveSelection(this.snapshots,t),t}undo(){this.madsor.collapseEdgeNew(this.snapshots)}}class w extends a.MoveableCommand{constructor(e){super(),this.madsor=e,this.bump=e.bump(),this.moveHandler=new n.MoveAlongNormal(e)}doIt(){this.bump=this.madsor.bump(this.bump),super.doIt()}undo(){super.undo(),this.madsor.undoBump(this.bump)}}class b extends a.MoveableCommand{constructor(e){super(),this.madsor=e,this.intrude=e.intrude(),this.moveHandler=new n.MoveAlongNormal(e,!0)}doIt(){return this.intrude=this.madsor.intrude(),super.doIt(),!0}undo(){super.undo(),this.madsor.undoIntrude(this.intrude)}}class S extends a.EditSelectHandler{constructor(e,t){super(!1,!0,!1),this.madsor=e,this.preview=t,this.contours=this.preview.getSelectedFaceContours()}hilite(e,t){return!(t!==this.preview||!e.edge)&&this.contours.edges.has(e.edge.wingedEdge)}select(e){return!(!e.edge||!this.contours.edges.has(e.edge.wingedEdge))&&(this.axis=vec3.create(),vec3.sub(this.axis,e.edge.destination().vertex,e.edge.origin.vertex),this.hiliteEdge=e.edge,this.lift=this.preview.liftFace(this.contours,e.edge),this.moveHandler=new n.MouseRotateAlongAxis(this.madsor,this.axis,e.edge.origin.vertex),!0)}doIt(){return this.lift=this.preview.liftFace(this.contours,this.hiliteEdge),super.doIt(),!0}undo(){super.doIt(),this.preview.collapseExtrudeEdge(this.lift.extrudeEdges)}}class E extends a.EditSelectHandler{constructor(e,t){super(!0,!0,!0),this.madsor=e,this.preview=t,this.snapshot=t.snapshotPositionAll()}hilite(e,t){return t!==this.preview}select(e,t){return e.vertex?(this.vertex=e.vertex,this.doIt(),!0):e.edge?(this.edge=e.edge,this.doIt(),!0):!!e.face&&(this.face=e.face,this.doIt(),!0)}doIt(){if(this.vertex)this.preview.putOnVertex(this.vertex);else if(this.edge)this.preview.putOnEdge(this.edge);else{if(!this.face)return!1;this.preview.putOnFace(this.face)}return!0}undo(){this.preview.restoreMoveSelection(this.snapshot)}}class C extends a.EditCommand{constructor(e){super(),this.madsor=e}doIt(){this.mirror=this.madsor.mirror()}undo(){this.madsor.undoMirror(this.mirror)}}},function(e,t,o){"use strict";o.r(t),o.d(t,"VertexMadsor",function(){return f}),o.d(t,"VertexConnectCommand",function(){return v});var n=o(7),i=o(14),r=o(13),s=o(16),a=o(5),c=o(2),d=o(1),l=o(10),u=o(3),h=o(0);class f extends n.Madsor{constructor(){super("Vertex");const e=this;u.bindMenuItem(h.action.vertexConnect.name,e=>{const t=this.connectVertex();t.doIt()&&d.undoQueue(t)}),u.bindMenuItemMode(h.action.vertexDissolve.name,function(t){const o=new m(e);o.doIt(),d.undoQueue(o)},this,"Delete"),u.bindMenuItemMode(h.action.vertexCollapse.name,function(t){const o=new x(e);o.doIt(),d.undoQueue(o)},this,"Backspace"),u.bindMenuItem(h.action.vertexWeld.name,e=>{let t=[];for(let e of this.selectedCage())1==e.selectionSize()&&t.push(e);if(1==t.length){const e=new y(this,t[0]);d.attachHandlerMouseSelect(e)}else geometryStatus("You can only Weld one vertex")})}snapshotPosition(){return this.snapshotSelected(c.PreviewCage.prototype.snapshotVertexPosition)}snapshotPositionAndNormal(){return this.snapshotSelected(c.PreviewCage.prototype.snapshotVertexPositionAndNormal)}snapshotTransformGroup(){return this.snapshotSelected(c.PreviewCage.prototype.snapshotTransformVertexGroup)}bevel(){let e=this.snapshotSelected(c.PreviewCage.prototype.bevelVertex);return d.restoreFaceMode(e),e}undoBevel(e,t){this.restoreSelectionPosition(e),this.doAll(e,c.PreviewCage.prototype.collapseSplitOrBevelEdge),d.restoreVertexMode(t)}extrude(){return this.snapshotSelected(c.PreviewCage.prototype.extrudeVertex)}undoExtrude(e){this.doAll(e,c.PreviewCage.prototype.undoExtrudeVertex)}andConnectVertex(e){const t=new v(this);t.doIt()?d.undoQueueCombo([e,t]):e.undo()}connectVertex(){return new v(this)}connect(){return this.snapshotSelected(c.PreviewCage.prototype.connectVertex)}dissolveConnect(e){this.doAll(e,c.PreviewCage.prototype.dissolveConnect)}dissolve(){return this.snapshotSelected(c.PreviewCage.prototype.dissolveSelectedVertex)}undoDissolve(e){this.doAll(e,c.PreviewCage.prototype.undoDissolveVertex)}flatten(e){return this.snapshotSelected(c.PreviewCage.prototype.flattenVertex,e)}dragSelect(e,t,o,n){null!==t.vertex&&e.dragSelectVertex(t.vertex,n)&&o.push(t.vertex)}selectStart(e,t){if(null!==t.vertex){var o=e.selectVertex(t.vertex);return new p(this,e,t.vertex,o)}return null}isVertexSelectable(){return!0}_resetSelection(e){e._resetSelectVertex()}_restoreSelection(e,t){e.restoreVertexSelection(t)}toggleFunc(e){var t,o;e instanceof i.FaceMadsor?(t=d.restoreFaceMode,o=this.snapshotSelected(c.PreviewCage.prototype.changeFromVertexToFaceSelect)):e instanceof s.EdgeMadsor?(t=d.restoreEdgeMode,o=this.snapshotSelected(c.PreviewCage.prototype.changeFromVertexToEdgeSelect)):e instanceof r.BodyMadsor?(t=d.restoreBodyMode,o=this.snapshotSelected(c.PreviewCage.prototype.changeFromVertexToBodySelect)):(t=d.restoreMultiMode,o=this.snapshotSelected(c.PreviewCage.prototype.changeFromVertexToMultiSelect)),d.undoQueue(new n.ToggleModeCommand(t,d.restoreVertexMode,o))}restoreMode(e,t){e instanceof i.FaceMadsor?this.doAll(t,c.PreviewCage.prototype.restoreFromVertexToFaceSelect):e instanceof s.EdgeMadsor?this.doAll(t,c.PreviewCage.prototype.restoreFromVertexToEdgeSelect):e instanceof r.BodyMadsor?this.doAll(t,c.PreviewCage.prototype.restoreFromVertexToBodySelect):this.doAll(t,c.PreviewCage.prototype.restoreFromVertexToMultiSelect)}drawExtra(e,t){e.useShader(l.selectedColorPoint),e.bindTransform(),t.drawVertex(e,this),e.disableShader()}}class p extends n.DragSelect{constructor(e,t,o,n){super(e,t,o,n)}finish(){return new g(this.select)}}class g extends a.EditCommand{constructor(e){super(),this.select=e}doIt(){for(var[e,t]of this.select)for(var o=0;o<t.length;++o)e.selectVertex(t[o])}undo(){this.doIt()}}class v extends a.EditCommand{constructor(e){super(),this.madsor=e}doIt(){return this.cageArray=this.madsor.connect(),this.cageArray.length>0&&(d.restoreEdgeMode(this.cageArray),!0)}undo(){d.restoreVertexMode(),this.madsor.dissolveConnect(this.cageArray)}}class m extends a.EditCommand{constructor(e){super(),this.madsor=e}doIt(){this.dissolve=this.madsor.dissolve()}undo(){this.madsor.undoDissolve(this.dissolve)}}class x extends a.EditCommand{constructor(e){super(),this.madsor=e}doIt(){this.dissolve=this.madsor.dissolve(),d.restoreFaceMode(this.dissolve)}undo(){this.madsor.resetSelection(),d.restoreVertexMode(),this.madsor.undoDissolve(this.dissolve)}}class y extends a.EditSelectHandler{constructor(e,t){super(!0,!1,!1),this.madsor=e,this.preview=t}hilite(e,t){return!(t!==this.preview||!e.vertex)&&!1!==this.preview.weldableVertex(e.vertex)}select(e){const t=e.vertex;return!(!t||(this.collapseHEdge=this.preview.weldableVertex(t),0==this.collapseHEdge))&&this.doIt()}doIt(){return this.restore=this.preview.weldVertex(this.collapseHEdge),!0}undo(){this.preview.undoWeldVertex(this.restore)}}},function(e,t,o){"use strict";o.r(t),o.d(t,"EdgeMadsor",function(){return f});var n=o(7),i=o(14),r=o(13),s=o(15),a=o(5),c=o(2),d=o(3),l=o(1),u=o(10),h=o(0);class f extends n.Madsor{constructor(){super("Edge");const e=this;for(let t of[h.action.cutLine2,h.action.cutLine3,h.action.cutLine4,h.action.cutLine5,h.action.cutLine10]){const o=t.name,n=o.substring("cutLine".length);d.bindMenuItem(o,function(t){e.cutEdge(n)})}d.bindMenuItem(h.action.cutAsk.name,function(t){d.runDialog("#cutLineDialog",t,function(t){const o=t.querySelector('input[name="Segments"');if(o){const t=parseInt(o.value,10);NaN!=t&&t>0&&t<100&&e.cutEdge(t)}})}),d.bindMenuItem(h.action.cutAndConnect.name,function(t){e.cutAndConnect()}),d.bindMenuItemMode(h.action.edgeDissolve.name,function(t){const o=e.dissolve();o.length>0&&l.undoQueue(new m(e,o))},this,"Backspace"),d.bindMenuItem(h.action.edgeCollapse.name,function(t){const o=new x(e);o.doIt()&&l.undoQueue(o)}),d.bindMenuItem(h.action.edgeCrease.name,e=>{l.attachHandlerMouseMove(new y(this))});for(let[t,o]of[[h.action.edgeLoop1,"l"],[h.action.edgeLoop2,void 0],[h.action.edgeLoop3,void 0]]){const n=t.name,i=n.substring("edgeLoop".length);d.bindMenuItem(n,function(t){const o=new w(e,i);o.doIt()&&l.undoQueue(o)},o)}d.bindMenuItem(h.action.edgeLoopN.name,function(t){d.runDialog("#cutLineDialog",t,function(t){const o=t.querySelector('input=[name="Segments"');if(o){const t=parseInt(o.value,10);if(NaN!=t&&t>0&&t<100){const o=new w(e,t);o.doIt()&&l.undoQueue(o)}}})});for(let[t,o]of[[h.action.edgeRing1,"g"],[h.action.edgeRing2,void 0],[h.action.edgeRing3,void 0]]){const n=t.name,i=n.substring("edgeRing".length);d.bindMenuItem(n,function(t){const o=new b(e,i);o.doIt()&&l.undoQueue(o)},o)}d.bindMenuItem(h.action.edgeRingN.name,function(t){d.runDialog("#cutLineDialog",t,function(t){const o=t.querySelector('input[name="Segments"');if(o){const t=parseInt(o.value,10);if(NaN!=t&&t>0&&t<100){const o=new b(e,t);o.doIt()&&l.undoQueue(o)}}})}),d.bindMenuItem(h.action.edgeLoopCut.name,e=>{const t=new S(this);t.doIt()&&l.undoQueue(t)}),d.bindMenuItem(h.action.edgeCorner.name,e=>{l.attachHandlerMouseMove(new E(this))}),d.bindMenuItem(h.action.edgeSlide.name,e=>{const t=new n.MoveBidirectionHandler(this,new n.GenericEditCommand(this,this.slide));t.doIt(),l.attachHandlerMouseMove(t)});for(let[e,t]of[[h.action.edgeSoft,0],[h.action.edgeHard,1],[h.action.edgeInvert,2]])d.bindMenuItem(e.name,e=>{const o=new n.GenericEditCommand(this,this.hardness,[t],this.undoHardness);o.doIt()&&l.undoQueue(o)})}snapshotPosition(){return this.snapshotSelected(c.PreviewCage.prototype.snapshotEdgePosition)}snapshotPositionAndNormal(){return this.snapshotSelected(c.PreviewCage.prototype.snapshotEdgePositionAndNormal)}snapshotTransformGroup(){return this.snapshotSelected(c.PreviewCage.prototype.snapshotTransformEdgeGroup)}loopCut(){const e=this.snapshotSelected(c.PreviewCage.prototype.loopCut);for(let t of e)for(let e of t.snapshot.separateCages)l.addToWorld(e),e.selectBody();return e}undoLoopCut(e){this.doAll(e,c.PreviewCage.prototype.undoLoopCut);for(let t of e)for(let e of t.snapshot.separateCages)l.removeFromWorld(e)}bevel(){const e=this.snapshotSelected(c.PreviewCage.prototype.bevelEdge);return l.restoreFaceMode(e),e}undoBevel(e,t){this.restoreSelectionPosition(e),this.collapseEdge(e),l.restoreEdgeMode(t)}crease(){return this.snapshotSelected(c.PreviewCage.prototype.creaseEdge)}extrude(){return this.snapshotSelected(c.PreviewCage.prototype.extrudeEdge)}undoExtrude(e){this.doAll(e,c.PreviewCage.prototype.undoExtrudeEdge)}cutEdge(e){const t=new v(this,e);l.undoQueue(t),t.doIt()}cutAndConnect(){const e=new v(this,2);e.doIt(),l.currentMode().andConnectVertex(e)}cut(e){return this.snapshotSelected(c.PreviewCage.prototype.cutEdge,e)}edgeLoop(e){return this.snapshotSelected(c.PreviewCage.prototype.edgeLoop,e)}edgeRing(e){return this.snapshotSelected(c.PreviewCage.prototype.edgeRing,e)}collapseEdge(e){this.doAll(e,c.PreviewCage.prototype.collapseSplitOrBevelEdge)}dissolve(){return this.snapshotSelected(c.PreviewCage.prototype.dissolveSelectedEdge)}reinsertDissolve(e){this.doAll(e,c.PreviewCage.prototype.reinsertDissolveEdge)}collapse(){return this.snapshotSelected(c.PreviewCage.prototype.collapseSelectedEdge)}restoreEdge(e){this.doAll(e,c.PreviewCage.prototype.restoreCollapseEdge)}corner(){return this.snapshotSelected(c.PreviewCage.prototype.cornerEdge)}undoCorner(e){this.doAll(e,c.PreviewCage.prototype.undoCornerEdge)}hardness(e){return this.snapshotSelected(c.PreviewCage.prototype.hardnessEdge,e)}undoHardness(e,t){this.doAll(e,c.PreviewCage.prototype.undoHardness,t)}slide(){return this.snapshotSelected(c.PreviewCage.prototype.slideEdge)}flatten(e){return this.snapshotSelected(c.PreviewCage.prototype.flattenEdge,e)}dragSelect(e,t,o,n){null!==t.edge&&e.dragSelectEdge(t.edge,n)&&o.push(t.edge)}selectStart(e,t){if(null!==t.edge){var o=e.selectEdge(t.edge);return new p(this,e,t.edge,o)}return null}isEdgeSelectable(){return!0}_resetSelection(e){e._resetSelectEdge()}_restoreSelection(e,t){e.restoreEdgeSelection(t)}toggleFunc(e){var t,o;e instanceof i.FaceMadsor?(t=l.restoreFaceMode,o=this.snapshotSelected(c.PreviewCage.prototype.changeFromEdgeToFaceSelect)):e instanceof s.VertexMadsor?(t=l.restoreVertexMode,o=this.snapshotSelected(c.PreviewCage.prototype.changeFromEdgeToVertexSelect)):e instanceof r.BodyMadsor?(t=l.restoreBodyMode,o=this.snapshotSelected(c.PreviewCage.prototype.changeFromEdgeToBodySelect)):(t=l.restoreMultiMode,o=this.snapshotSelected(c.PreviewCage.prototype.changeFromEdgeToMultiSelect)),l.undoQueue(new n.ToggleModeCommand(t,l.restoreEdgeMode,o))}restoreMode(e,t){e instanceof i.FaceMadsor?this.doAll(t,c.PreviewCage.prototype.restoreFromEdgeToFaceSelect):e instanceof s.VertexMadsor?this.doAll(t,c.PreviewCage.prototype.restoreFromEdgeToVertexSelect):e instanceof r.BodyMadsor?this.doAll(t,c.PreviewCage.prototype.restoreFromEdgeToBodySelect):this.doAll(t,c.PreviewCage.prototype.restoreFromEdgeToMultiSelect)}drawExtra(e,t){e.useShader(u.selectedColorLine),e.bindTransform(),t.drawEdge(e,this),e.disableShader()}previewShader(e){e.useShader(u.edgeSolidWireframe)}}class p extends n.DragSelect{constructor(e,t,o,n){super(e,t,o,n)}finish(){return new g(this.select)}}class g extends a.EditCommand{constructor(e){super(),this.select=e}doIt(){for(var[e,t]of this.select)for(var o=0;o<t.length;++o)e.selectEdge(t[o])}undo(){this.doIt()}}class v extends a.EditCommand{constructor(e,t){super(),this.madsor=e,this.numberOfSegments=t,this.selectedEdges=e.snapshotSelection()}doIt(){const e=this.madsor.cut(this.numberOfSegments);l.restoreVertexMode(e),this.snapshots=e}undo(){this.madsor.collapseEdge(this.snapshots),l.restoreEdgeMode(this.selectedEdges)}}class m extends a.EditCommand{constructor(e,t){super(),this.madsor=e,this.dissolveEdges=t}doIt(){this.madsor.dissolve()}undo(){this.madsor.reinsertDissolve(this.dissolveEdges)}}class x extends a.EditCommand{constructor(e){super(),this.madsor=e}doIt(){const e=this.madsor.collapse();return e.length>0&&(this.collapse=e,l.restoreVertexMode(this.collapse),!0)}undo(){l.currentMode().resetSelection(),l.restoreEdgeMode(),this.madsor.restoreEdge(this.collapse)}}class y extends a.MoveableCommand{constructor(e){super(),this.madsor=e,this.contourEdges=e.crease(),this.moveHandler=new n.MoveAlongNormal(e)}doIt(){this.contourEdges=this.madsor.crease(this.contourEdges),super.doIt()}undo(){super.undo(),this.madsor.undoExtrude(this.contourEdges)}}class w extends a.EditCommand{constructor(e,t){super(),this.madsor=e,this.nth=t,this.selectedEdges=e.snapshotSelection()}doIt(){return this.madsor.edgeLoop(this.nth).length>0}undo(){this.madsor.resetSelection(),this.madsor.restoreSelection(this.selectedEdges)}}class b extends a.EditCommand{constructor(e,t){super(),this.madsor=e,this.nth=t,this.selectedEdges=e.snapshotSelection()}doIt(){return this.madsor.edgeRing(this.nth).length>0}undo(){this.madsor.resetSelection(),this.madsor.restoreSelection(this.selectedEdges)}}class S extends a.EditCommand{constructor(e){super(),this.madsor=e}doIt(){return this.loopCut=this.madsor.loopCut(),this.loopCut.length>0&&(l.restoreBodyMode(),!0)}undo(){this.loopCut.length>0&&(l.restoreEdgeMode(),this.madsor.undoLoopCut(this.loopCut))}}class E extends a.MoveableCommand{constructor(e){super(),this.madsor=e,this.cornerEdges=e.corner(),this.moveHandler=new n.MoveAlongNormal(e,!1,this.cornerEdges)}doIt(){this.cornerEdges=this.madsor.corner(),super.doIt()}undo(){this.madsor.undoCorner(this.cornerEdges)}}},function(e,t,o){"use strict";o.r(t),o.d(t,"BoundingSphere",function(){return i}),o.d(t,"LooseOctree",function(){return r}),o.d(t,"Plane",function(){return s}),o.d(t,"Ray",function(){return a});var n=o(6);const i=function(e,t,o){this.center=t,this.radius=o,o&&(this.radius2=o*o),this.polygon=e,this.octree=null};i.prototype.isLive=function(){return this.polygon.isVisible&&this.polygon.isLive()},i.prototype.isIntersect=function(e){return n.intersectRaySphere(e,this)},i.prototype.setSphere=function(e){this.center=e.center,this.radius=e.radius,this.radius2=e.radius*e.radius,this.octree&&this.octree._move(this)},i.prototype.getBVHRoot=function(){return this.octree.bvh.bvh.root},i.computeSphere=function(e,t){t.fill(0);var o={center:t,radius:0};return e.eachVertex(function(e){vec3.add(o.center,o.center,e.vertex)}),vec3.scale(o.center,o.center,1/e.numberOfVertex),e.eachVertex(function(e){var t=vec3.distance(o.center,e.vertex);t>o.radius&&(o.radius=t)}),o},i.create=function(e,t){var o=i.computeSphere(e,t);return new i(e,o.center,o.radius)},i.allocate=function(e){return new i(e)};class r{constructor(e,t,o){this.bvh=e,this.level=o,this.node=[],t&&(this.bound={center:vec3.clone(t.center),halfSize:vec3.clone(t.halfSize)})}*[Symbol.iterator](){if(yield this,this.leaf)for(let e=0;e<8;++e){const t=this.leaf[e];t&&(yield*t)}}getHalfSize(){return this.bound.halfSize}getBound(e){vec3.copy(e.center,this.bound.center),vec3.copy(e.halfSize,this.bound.halfSize)}getLooseBound(e){vec3.copy(e.center,this.bound.center),vec3.scale(e.halfSize,this.bound.halfSize,r.kLOOSENESS)}getExtent(e,t=1){for(let o=0;o<3;++o){const n=this.bound.halfSize[o]*t;e.min[o]=this.bound.center[o]-n,e.max[o]=this.bound.center[o]+n}}getLooseExtent(e){this.getExtent(e,r.kLOOSENESS)}static getOctant(e,t){let o=0;const n=[1,2,4];for(let i=0;i<3;++i){if(t.halfSize[i]/=2,e.radius>t.halfSize[i])return-1;e.center[i]<t.center[i]?(o+=n[i],t.center[i]-=t.halfSize[i]):t.center[i]+=t.halfSize[i]}return o}check(e){if(this.node)for(let t of this.node)e.has(t)?console.log("octree problems"):e.add(t);else{for(let t=0;t<8;++t){const o=this.leaf[t];o&&o.check(e)}for(let t=8;t<this.leaf.length;++t){const o=this.leaf[t];e.has(o)?console.log("octree problems"):e.add(o)}}}free(){if(this.node)for(let e of this.node)e.octree=null;else{for(let e=0;e<8;++e){const t=this.leaf[e];t&&t.free()}for(let e=8;e<this.leaf.length;++e){this.leaf[e].octree=null}}}insert(e,t){if(this.node){if(this.node.push(e),e.octree=this,this.node.length>=r.kTHRESHOLD){this.leaf=[null,null,null,null,null,null,null,null];let e,o={center:vec3.create(),halfSize:vec3.create()};const n=this.node;delete this.node;for(let i of n)vec3.copy(o.center,t.center),vec3.copy(o.halfSize,t.halfSize),e=this.insert(i,o);return e}}else{let o=r.getOctant(e,t);if(o>=0){let n=this.leaf[o];return null===n&&(n=new r(this.bvh,t,this.level+1),this.leaf[o]=n),n.insert(e,t)}this.leaf.push(e),e.octree=this}return this}_move(e){this.isInside(e)||(this._remove(e),this.bvh.moveSphere(e))}_remove(e){e.octree===this?(this.node?this.node.splice(this.node.indexOf(e),1):this.leaf.splice(this.leaf.indexOf(e),1),e.octree=null):console.log("LooseOctree _remove error")}isInside(e){for(let t=0;t<3;++t){let o=this.bound.halfSize[t];if(o<e.radius||this.bound.center[t]+o<e.center[t]||this.bound.center[t]-o>e.center[t])return!1}return!0}*intersectExtent(e){const t={min:vec3.create(),max:vec3.create()};this.getLooseExtent(t),e.intersectAAExtent(t)&&(yield*this._extentIntersect(e,t))}*_extentIntersect(e,t){if(this.node)for(let t of this.node)e.intersectSphere(t)&&(yield t);else{for(let t=8;t<this.leaf.length;++t){const o=this.leaf[t];e.intersectSphere(o)&&(yield o)}for(let o=0;o<8;++o){const n=this.leaf[o];n&&(n.getLooseExtent(t),e.intersectAAExtent(t)&&(yield*n._extentIntersect(e,t)))}}}*intersectBound(e){const t={center:vec3.create(),halfSize:vec3.create()};this.getLooseBound(t),e.intersectAABB(t)&&(yield*this._boundIntersect(e,t))}*_boundIntersect(e,t){if(this.node)for(let t of this.node)e.intersectSphere(t)&&(yield t);else{for(let t=8;t<this.leaf.length;++t){const o=this.leaf[t];e.intersectSphere(o)&&(yield o)}for(let o=0;o<8;++o){const n=this.leaf[o];n&&(n.getLooseBound(t),e.intersectAABB(t)&&(yield*n._boundIntersect(e,t)))}}}}r.kTHRESHOLD=88,r.kLOOSENESS=1.5;class s{constructor(e,t){this.normal=vec3.clone(e),vec3.normalize(this.normal,this.normal),this.pt=vec3.clone(t),this.distance=vec3.dot(this.normal,this.pt)}closestPoint(e,t){n.closestPointToPlane(e,t,this)}intersectAABB(e){return n.intersectPlaneAABB(this,e)}intersectSphere(e){return n.intersectPlaneSphere(this,e)}}class a{constructor(e,t){this.origin=e,this.direction=t,this.invDir=vec3.fromValues(1/t[0],1/t[1],1/t[2])}intersectSphere(e){return n.intersectRaySphere(this,e)}intersectAAExtent(e){return n.intersectRayAAExtent(this,e)}}},function(e,t,o){"use strict";o.r(t),o.d(t,"Material",function(){return i});var n=o(6);const i=function(e){this.name=e,this.uuid=n.get_uuidv4(),this.isAltered=!1,this.usageCount=0,this.material={diffuseMaterial:"#C9CFB1",ambientMaterial:"#C9CFB1",specularMaterial:"#000000",emissionMaterial:"#000000",vertexColorSelect:0,shininessMaterial:0,opacityMaterial:1},i.default||(i.default=this)};i.default,i.create=function(e,t){const o=new i(e);return t&&o.setValues(t),o},i.prototype.setValues=function(e){for(const t of Object.keys(e))this.material.hasOwnProperty(t)?this.material[t]=e[t]:console.log("unknown input material: "+t)},i.prototype.assigned=function(){++this.usageCount,this.isAltered=!0},i.prototype.unassigned=function(){--this.usageCount,this.isAltered=!0}},function(e,t,o){"use strict";o.r(t),o.d(t,"runHotkeyAction",function(){return r}),o.d(t,"setHotkey",function(){return s});var n=o(0);const i=new Map;function r(e,t){const o=Object(n.createMask)(t.altKey,t.ctrlKey,t.shiftKey),r=t.key.toLowerCase();let s=i.get(r);if(s){for(let i of s)if(o===i.meta&&i.mode===e)return void Object(n.runAction)(0,i.id,t);for(let e of s)if(o===e.meta&&null===e.mode)return void Object(n.runAction)(0,e.id,t)}}function s(e,t,o,r=""){o=o.toLowerCase(),r=r.toLowerCase();const s=Object(n.createMask)(r.indexOf("alt")>-1,r.indexOf("ctrl")>-1,r.indexOf("shift")>-1);i.has(o)||i.set(o,[]),i.get(o).unshift({mode:e,meta:s,id:t})}},function(e,t,o){"use strict";o.r(t),o.d(t,"getTreeView",function(){return f}),o.d(t,"getImageList",function(){return v}),o.d(t,"getMaterialList",function(){return x});var n=o(1),i=o(0),r=o(3),s=o(18),a=o(13),c=o(2);function d(e){e.preventDefault()}function l(e){e.preventDefault(),e.stopPropagation(),e.target===this&&this.classList.remove("dropZone")}function u(e){e.preventDefault(),e.stopPropagation(),this.classList.add("dropZone")}!function(){c.PreviewGroup.nameSetters.push(function(e){this.guiStatus&&this.guiStatus.textNode&&(this.guiStatus.textNode.textContent=e)});const e=c.PreviewGroup.prototype.numberOfCage;c.PreviewGroup.prototype.numberOfCage=function(){const t=e.call(this);return this.guiStatus&&this.guiStatus.count&&(this.guiStatus.count.textContent=t),t},c.PreviewCage.nameSetters.push(function(e){this.guiStatus&&this.guiStatus.textNode&&(this.guiStatus.textNode.textContent=e)}),c.PreviewCage.prototype.updateStatus=function(){this.isVisible()&&0!==this.selectedSet.size?this.guiStatus&&!this.guiStatus.select.checked&&(this.guiStatus.select.checked=!0):this.guiStatus&&this.guiStatus.select.checked&&(this.guiStatus.select.checked=!1)}}();class h{constructor(e,t,o){this.label=e,this.treeView=t,this.world=o,this.drag={cage:null,li:null};const i=this;o&&(o.guiStatus.count=e.querySelector(".resultCount")),o.guiStatus.ul=t,e.addEventListener("drop",function(e){l.call(this,e),i.treeView.id===e.dataTransfer.getData("text")&&(i.treeView.insertBefore(i.drag.li,i.treeView.firstChild),n.moveCage(o,i.drag.cage),i.drag.li=i.drag.cage=null)}),e.addEventListener("dragover",d),e.addEventListener("dragenter",u),e.addEventListener("dragleave",l),e.addEventListener("contextmenu",function(e){e.preventDefault();let t=document.querySelector("#geometryGraphWorld");t&&(r.positionDom(t,r.getPosition(e)),r.showContextMenu(t),n.setObject(o,[o]))},!1)}static addRenameListener(e,t){e.textContent=t.name,t.guiStatus.textNode=e;const o=function(e){if(13==e.keyCode){if(this.textContent!==t.name){const e={};e[t.uuid]=this.textContent;const o=new a.RenameBodyCommand([t],e);n.undoQueue(o),o.doIt()}this.contentEditable=!1,this.removeEventListener("keydown",o)}};return e.addEventListener("dblclick",function(e){this.contentEditable=!0,this.focus(),this.addEventListener("keydown",o)}),e.addEventListener("blur",function(e){this.textContent=t.name,this.contentEditable=!1,this.removeEventListener("keydown",o)}),e}addGroup(e,t){const o=this;let i=t.guiStatus.li;if(!i){i=document.createElement("li"),t.guiStatus.li=i;const e=t.uuid,r=document.createRange().createContextualFragment(`<input type="checkbox" id="${e}"><label for="${e}" class="folder"></label><p><span></span><span class="resultCount">0</span></p><ul></ul>`);h.addRenameListener(r.querySelector("span"),t);const s=r.querySelector("ul");t.guiStatus.ul=s;const a=r.querySelector("p");t.guiStatus.count=r.querySelector(".resultCount"),i.appendChild(r),a.addEventListener("drop",function(e){l.call(this,e),o.treeView.id===e.dataTransfer.getData("text")&&(s.insertBefore(o.drag.li,s.firstChild),n.moveCage(t,o.drag.cage),o.drag.li=o.drag.cage=null)}),a.addEventListener("dragover",d),a.addEventListener("dragenter",u),a.addEventListener("dragleave",l)}e.appendChild(i)}addObject(e,t=this.treeView){const o=this;let s=e.guiStatus.li;if(!s){s=document.createElement("li"),e.guiStatus.li=s,s.classList.add("objectName"),s.draggable=!0,s.addEventListener("dragstart",function(t){t.stopPropagation(),t.dataTransfer.setData("text",o.treeView.id),o.drag.li=this,o.drag.cage=e});const t=document.createRange().createContextualFragment('<label><input type="checkbox"><span class="smallIcon smallWhole"></span></label>');let a=t.querySelector("input");a.addEventListener("change",t=>{!e.isLock()&&e.isVisible()?(n.setObject(e.parent,[e]),i.runAction(0,"toggleObjectSelect",t)):t.target.checked=!t.target.checked}),e.guiStatus.select=a,s.appendChild(t);const c=h.addRenameListener(document.createElement("span"),e);c.addEventListener("contextmenu",function(t){t.preventDefault();let o=document.querySelector("#geometryGraphText");o&&(r.positionDom(o,r.getPosition(t)),r.showContextMenu(o),n.setObject(e.parent,[e]))},!1),s.appendChild(c);const d=document.createRange().createContextualFragment('<label><input type="checkbox"><span class="smallIcon smallShow"></span></label>');(a=d.querySelector("input")).addEventListener("change",t=>{e.isLock()?t.target.checked=!t.target.checked:(n.setObject(e.parent,[e]),i.runAction(0,"toggleObjectVisibility",t))}),e.guiStatus.visibility=a,s.appendChild(d);const l=document.createRange().createContextualFragment('<label><input type="checkbox"><span class="smallIcon smallUnlock"></span></label>');(a=l.querySelector("input")).addEventListener("change",t=>{n.setObject(e.parent,[e]),i.runAction(0,"toggleObjectLock",t)}),s.appendChild(l),e.guiStatus.locked=a;const u=document.createRange().createContextualFragment('<label><input type="checkbox"><span class="smallIcon smallWire"></span></label>');(a=u.querySelector("input")).addEventListener("change",t=>{n.setObject(e.parent,[e]),i.runAction(0,"toggleWireMode",t)}),s.appendChild(u)}t.appendChild(s)}removeObject(e){const t=e.guiStatus.li;t.parentNode.removeChild(t),e.removeFromParent()}}function f(e,t,o){const n=document.querySelector(e),i=document.querySelector(t);return n&&i?new h(n,i,o):null}class p{constructor(e){this.view=e,this.list=[]}static addRenameListener(e,t){const o=function(e){13==e.keyCode&&(""!=this.textContent?t.name=this.textContent:this.textContent=t.name,this.contentEditable=!1,this.removeEventListener("keydown",o))};return e.addEventListener("dblclick",function(e){this.contentEditable=!0,this.focus(),this.addEventListener("keydown",o)}),e.addEventListener("blur",function(e){this.textContent=t.name,this.contentEditable=!1,this.removeEventListener("keydown",o)}),e}[Symbol.iterator](){return this.list[Symbol.iterator]()}}class g extends p{constructor(e,t){super(t);let o=document.querySelector("#importImageMenu");o&&e.addEventListener("contextmenu",function(e){e.preventDefault(),r.positionDom(o,r.getPosition(e)),r.showContextMenu(o)},!1)}loadImage(e){let t=new FileReader;t.onload=(o=>{const i={img:null,li:null,uuid:Util.get_uuidv4(),name:"",popup:null},s=i.img=document.createElement("img");s.src=t.result,s.onload=function(){i.popup=r.showPopup(this,e.name)};let a=i.li=document.createElement("li"),c=document.createRange().createContextualFragment('<span class="smallIcon smallImage"></span>');c.firstElementChild.addEventListener("click",e=>{document.body.appendChild(i.popup)}),a.appendChild(c);let d=document.createRange().createContextualFragment(`<span>${e.name}</span>`);i.name=d.firstElementChild,d.firstElementChild.addEventListener("contextmenu",function(e){e.preventDefault();let t=document.querySelector("#importImageTextMenu");t&&(r.positionDom(t,r.getPosition(e)),r.showContextMenu(t),n.setObject(null,[i]))},!1),a.appendChild(d),this.view.appendChild(a),this.list.push(i)}),t.readAsDataURL(e)}showImage(e){document.body.appendChild(e[0].popup)}deleteImage(e){const t=e[0];t.popup.remove(),this.view.removeChild(t.li),this.list.splice(this.list.indexOf(t),1)}}function v(e,t){const o=document.querySelector(t),n=document.querySelector(e);return n&&o?new g(n,o):null}class m extends p{constructor(e,t){super(t),this.addMaterial("default");let o=document.querySelector("#createMaterialMenu");o&&e.addEventListener("contextmenu",function(e){e.preventDefault(),r.positionDom(o,r.getPosition(e)),r.showContextMenu(o)},!1)}addMaterial(e,t){const o=s.Material.create(e,t);let a=o.li=document.createElement("li"),c=document.createRange().createContextualFragment('<span class="materialIcon"></span>');o.pict=c.firstElementChild,o.pict.addEventListener("click",e=>{this.editMaterial(e,[o])}),o.pict.style.backgroundColor=o.material.diffuseMaterial,a.appendChild(c);let d=document.createRange().createContextualFragment(`<span>${e}</span>`);if(o.text=d.firstElementChild,o!==s.Material.default&&p.addRenameListener(o.text,o),o.text.addEventListener("contextmenu",function(e){e.preventDefault();let t=document.querySelector("#materialMenu");t&&(r.positionDom(t,r.getPosition(e)),r.showContextMenu(t),n.setObject(null,[o]))},!1),a.appendChild(d),this.view.appendChild(a),this.submenu||(this.submenu=document.querySelector("#faceMaterialMenu"),this.submenu&&(this.submenu=this.submenu.nextElementSibling)),this.submenu){o.menu={},a=o.menu.li=document.createElement("li");let t=document.createRange().createContextualFragment("<a></a>");o.menu.a=t.firstElementChild,a.appendChild(t);let r=document.createRange().createContextualFragment(`<span>${e}</span>`);o.menu.text=r.firstElementChild,o.menu.a.appendChild(r);let s=document.createRange().createContextualFragment('<span style="width: 1rem;"></span>');o.menu.color=s.firstElementChild,o.menu.a.appendChild(s),o.menu.color.style.backgroundColor=o.material.diffuseMaterial,o.menu.a.addEventListener("click",function(e){n.setObject(null,[o]),i.runAction(e.button,"assignMaterial",e)}),this.submenu.prepend(a)}this.list.push(o)}createMaterial(e){const t=this,o=t.newName();r.runDialog("#materialSetting",e,function(e){const n=r.extractDialogValue(e);t.addMaterial(o,n)},function(e){e.reset(),m.resetCSS();const t=e.querySelector("h3 > span");t&&(t.textContent=o)})}duplicateMaterial(e){const t=e[0];let o=t.name.split(/\d+$/);o=o.length>1?o[0]+(parseInt(t.name.match(/\d+$/),10)+1):t.name+"2",this.addMaterial(o,t.material)}editMaterial(e,t){const o=t[0];r.runDialog("#materialSetting",e,function(e){const t=r.extractDialogValue(e);o.setValues(t),o.menu.color.style.backgroundColor=o.pict.style.backgroundColor=t.diffuseMaterial},function(e){e.reset(),m.resetCSS();const t=e.querySelector("h3 > span");t&&(t.textContent=o.name);for(let[t,n]of Object.entries(o.material)){const o=e.querySelector(`div > [name=${t}]`);o&&(o.value=n,o.onchange&&o.onchange())}})}deleteMaterial(e){const t=e[0];t!==s.Material.default&&(this.view.removeChild(t.li),this.list.splice(this.list.indexOf(t),1),this.submenu.removeChild(t.menu.li))}newName(){return`New Material ${this.list.length}`}renameMaterial(e,t){const o=t[0];o!==s.Material.default&&r.runDialog("#renameDialog",e,function(e){const t=r.extractDialogValue(e);o.name=t[o.uuid],o.menu.text.textContent=o.text.textContent=o.name},function(e){r.addLabelInput(e,t)})}static resetCSS(){const e=document.documentElement.style;e.setProperty("--diffuseMaterialMax","#FFFFFF"),e.setProperty("--ambientMaterialMax","#FFFFFF"),e.setProperty("--specularMaterialMax","#FFFFFF"),e.setProperty("--emissionMaterialMax","#FFFFFF")}}function x(e,t){const o=document.querySelector(t),n=document.querySelector(e);return n&&o?new m(n,o):null}},function(e,t,o){"use strict";o.r(t),o.d(t,"i18n",function(){return E}),o.d(t,"setCurrentLocale",function(){return b}),o.d(t,"getCurrentLocale",function(){return w});var n=o(0);const i="data-i18n",r="data-tooltip",s="data-menuid",a="\n";let c,d,l="LMB: ",u="MMB: ",h="RMB: ",f="US",p="en";function g(e){let t=d.msgstr.get(e);return!t&&c?c.msgstr.get(e):t}function v(e){const t=this.getAttribute("title").replace(a,"    ");help(t)}function m(e,t){let o=!0,n=(i=t,void d.tooltip.get(i));var i;if(n){o=!1;let t="";Array.isArray(n)?(n[0]&&(t+=l+n[0]),n[1]&&(t+=a+u+n[1]),n[2]&&(t+=a+h+n[2])):t=n,e.setAttribute("title",t),e.removeEventListener("mouseover",v),e.addEventListener("mouseover",v)}}function*x(e){for(let t in e)yield[t,e[t]]}function y(e,t){Object(n.ezFetch)(`./resources/${e}.json`).then(e=>{!function(e){d={msgstr:new Map,tooltip:new Map};for(let[t,o]of x(e))d[t]=new Map(x(o));c||(c=d);let t=document.querySelectorAll(`[${i}]`);for(let e of t){let t=!0,o=e.getAttribute(i),n=g(o);n&&(e.textContent=n,t=!1),t&&console.log(`Warning: ${o} has no translation`)}t=document.querySelectorAll(`[${s}]`);for(let e of t){let t=e.getAttribute(s);m(e,t)}t=document.querySelectorAll(`[${r}]`);for(let e of t){let t=e.getAttribute(r);m(e,t)}}(e),t&&t()}).catch(e=>{console.log("Fetch Error :-S",e)})}function w(){return{country:f,language:p}}function b(e,t,o){f=t||"unknown",y(p=e||"unknown",o)}const S=function(e,t){return new Function(`return \`${e}\`;`).call(t)};function E(e,t){let o=g(e);return o?t?S(o,t):o:`Error: ${e} don't exist`}Object(n.onReady)(()=>{let e=document.querySelectorAll(`[${i}]`);for(let t of e){let e=t.getAttribute(i);e||(e=(e=t.textContent.replace(/ /g,"")).replace(/^.{1}/g,e[0].toLowerCase()),t.setAttribute(i,e)),t.hasAttribute(r)&&t.setAttribute(r,e)}e=document.querySelectorAll(`[${r}=""]`);for(let t of e){let e=t.getAttribute(r);e||(e=(e=t.textContent.replace(/ /g,"")).replace(/^.{1}/g,e[0].toLowerCase()),t.setAttribute(r,e))}b("en");let t=document.querySelector("#selectLanguage");t&&t.addEventListener("change",function(e){b(t.value)})})},function(e,t,o){"use strict";o.d(t,"a",function(){return r});var n=o(23),i=o(1);class r extends n.ImportExporter{constructor(){super("Wavefront (.obj)...","Wavefront (.obj)...")}extension(){return"obj"}_export(e){let t="#wings3d-web wavefront export\n";const o=function(e){t+=" "+(e.index+1)};for(const[n,i]of e.entries()){const e=i.geometry;t+="o "+n.toString()+"\n",t+="\n#vertex total "+e.vertices.size+"\n";for(let o of e.vertices){const e=o.vertex;t+="v "+e[0]+" "+e[1]+" "+e[2]+"\n"}t+="\n#face list total "+e.faces.size+"\n";for(let n of e.faces)t+="f",n.eachVertex(o),t+="\n"}return new Blob([t],{type:"text/plain;charset=utf-8"})}_import(e){const t=e.match(/^([vfogs])(?:\s+(.+))$/gm);if(t){for(let e of t){let t=(e=e.trim()).split(/\s+/),o=t.shift();"function"==typeof this[o]?this[o](t):console.log("unexpected tag: "+o)}return this.objs}}o(e){this.objView=i.putIntoWorld(),this.obj=this.objView.geometry,this.objs.push(this.objView),this.obj.clearAffected(),this.objView.name=e}g(e){this.objView||(this.objView=i.putIntoWorld(),this.obj=this.objView.geometry,this.objs.push(this.objView))}s(e){}v(e){const t=this.obj.addVertex(e);this.realVertices.push(t.index),this.vertexCount++}f(e){const t=[];for(let o of e){let e=o.split("/")[0]-1;e>=0&&e<this.obj.vertices.size?t.push(this.realVertices[e]):console.log("face index out of bound: "+e)}null===this.obj.addPolygon(t)&&this.non_manifold.push(this.polygonCount),this.polygonCount++}}},function(e,t,o){"use strict";o.r(t),o.d(t,"ImportExporter",function(){return s});var n=o(2),i=(o(12),o(3)),r=o(1);class s{constructor(e,t){const o=this;e&&i.addMenuItem("fileImport","import"+e.split(" ")[0],e,function(e){i.openFile(function(e){o.import(e)})}),t&&i.addMenuItem("fileExport","export"+t.split(" ")[0],t,function(e){i.runDialog("#exportFile",e,function(e){const t=e.querySelector('input[name="Filename"');t&&o.export(t.value)})}),this._reset()}export(e){const t=this._export(r.getWorld());saveAs(t,e+"."+this.extension())}import(e){const t=this;let o=new FileReader;o.onload=function(e){const i=o.result,s=t._import(i),a=[];for(let e of s)a.push(new n.CreatePreviewCageCommand(e));a.length>1?r.undoQueueCombo(a):a.length>0&&r.undoQueue(a[0]),t._reset(),r.updateWorld()},o.readAsText(e)}_reset(){this.objs=[],this.obj=null,this.objView=null,this.realVertices=[],this.polygonCount=0,this.vertexCount=0,this.non_manifold=[]}}},function(e,t,o){"use strict";o.r(t),o.d(t,"MultiMadsor",function(){return d});var n=o(7),i=o(14),r=o(16),s=o(15),a=o(2),c=o(1);class d extends n.Madsor{constructor(){super("Multi")}selectMaterialCmd(e){return c.toggleFaceMode(),c.currentMode().selectMaterialCmd(e)}isFaceSelectable(){return!0}isEdgeSelectable(){return!0}isVertexSelectable(){return!0}toggleMulti(e){e.face?c.toggleFaceMode():e.vertex?c.toggleVertexMode():c.toggleEdgeMode()}toggleFunc(e){let t,o;e instanceof i.FaceMadsor?(t=c.restoreFaceMode,o=this.snapshotSelected(a.PreviewCage.prototype.changeFromMultiToFaceSelect)):e instanceof s.VertexMadsor?(t=c.restoreVertexMode,o=this.snapshotSelected(a.PreviewCage.prototype.changeFromMultiToVertexSelect)):e instanceof r.EdgeMadsor?(t=c.restoreEdgeMode,o=this.snapshotSelected(a.PreviewCage.prototype.changeFromMultiToEdgeSelect)):(t=c.restoreEdgeMode,o=this.snapshotSelected(a.PreviewCage.prototype.changeFromMultiToBodySelect)),c.undoQueue(new n.ToggleModeCommand(t,c.restoreMultiMode,o))}restoreMode(e,t){e instanceof i.FaceMadsor?this.doAll(t,a.PreviewCage.prototype.restoreFromMultiToFaceSelect):e instanceof s.VertexMadsor?this.doAll(t,a.PreviewCage.prototype.restoreFromMultiToVertexSelect):e instanceof EdgeVertex?this.doAll(t,a.PreviewCage.prototype.restoreFromMultiToEdgeSelect):this.doAll(t,a.PreviewCage.prototype.restoreFromMultiToBodySelect)}drawExtra(e,t){}}},function(e,t,o){"use strict";o.r(t),o.d(t,"DraftBench",function(){return d}),o.d(t,"CheckPoint",function(){return l});var n=o(4),i=o(10),r=o(6),s=o(17),a=o(12),c=o(5);const d=function(e,t,o,i=2048){a.MeshAllocator.call(this,i),this.materialList=o,this.lastPreviewSize={vertices:0,edges:0,faces:0},this.boundingSpheres=[],this.hilite={index:null,indexLength:0,numberOfTriangles:0},this.numberOfTriangles=0,this.preview={centroid:{},indexLength:0,visibleLength:0,isAltered:!1},this.preview.material={set:new Set,isAltered:!1},this.preview.shaderData=n.gl.createShaderData();var r=n.ShaderData.attribLayout(),s=n.ShaderData.attribLayout(1);this.preview.shaderData.createAttribute("position",r,n.gl.STATIC_DRAW),this.preview.shaderData.createAttribute("barycentric",r,n.gl.STATIC_DRAW),this._resizeBoundingSphere(0),this._resizePreview(0,0),this.setTheme(e,t),this.preview.face={},this.preview.face.isAltered=!1,this.preview.face.indexLength=0,this.preview.face.visibleLength=0,this.preview.face.selected=null,this.preview.edge={},this.preview.edge.isAltered=!1,this.preview.edge.indexLength=0,this.preview.edge.hilite={indexLength:0,wEdge:null},this.preview.edge.hardness={isAltered:!1,indexLength:0},this.preview.edge.wireOnly={isAltered:!1,indexLength:0},this.preview.vertex={isModified:!1,isAltered:!1,min:Number.MAX_SAFE_INTEGER,max:Number.MIN_SAFE_INTEGER},this.preview.shaderData.createAttribute("vertexState",s,n.gl.DYNAMIC_DRAW),this._resizePreviewVertex(),this.previewBody={hilite:!1},this.previewPlane={},this.previewPlane.shaderData=n.gl.createShaderData(),this.previewPlane.shaderData.setUniform4fv("faceColor",[1,0,0,1]),this.previewPlane.shaderData.createAttribute("position",r,n.gl.STATIC_DRAW),this.previewPlane.rectangle=new Float32Array(12),this.previewPlane.shaderData.resizeAttribute("position",3*Float32Array.BYTES_PER_ELEMENT*4),this.previewPlane.pts=[];for(let e=0;e<4;++e)this.previewPlane.pts[e]=this.previewPlane.rectangle.subarray(3*e,3*(e+1))};d.theme={edgeColor:[0,0,0,1],hardEdgeColor:[1,.5,0,1],selectedColor:[.65,0,0,1],selectedHilite:[.7,.7,0,1],unselectedHilite:[0,.65,0,1],vertexColor:[0,0,0,1],maskedVertexColor:[.5,1,0,.8],faceColor:[.7898538076923077,.8133333333333334,.6940444444444445],sculptMagnetColor:[0,0,1,.1],tweakMagnetColor:[0,0,1,.06],tweakVectorColor:[1,.5,0]},d.pref={vertexSize:4,selectedVertexSize:5,maskedVertexSize:8,edgeWidth:2,selectedEdgeWidth:2,hardEdgeWidth:2},d.CONST=function(){const e={EDGEWIDTH:1.1};return e.BARYCENTRIC=new Float32Array(3),e.BARYCENTRIC[0]=1,e.BARYCENTRIC[1]=0,e.BARYCENTRIC[2]=1,e}(),d.prototype=Object.create(a.MeshAllocator.prototype),d.prototype.setTheme=function(e,t){Object.entries(e).forEach(([e,t])=>{this.preview.shaderData.setUniform4fv(e,r.hexToRGBA(t)),d.theme[e]=r.hexToRGBA(t)}),Object.entries(t).forEach(([e,t])=>{d.pref[e]=t});const o=["vertexSize","selectedVertexSize","maskedVertexSize"];for(let e of o)this.preview.shaderData.setUniform1f(e,t[e])},d.prototype.freeBuffer=function(){this.preview.shaderData.freeAllAttributes(),this.preview.shaderData=null,this.previewEdge.shaderData.freeAllAttributes(),this.previewEdge.shaderData=null},d.prototype.alterVertex=function(){this.preview.vertex.isAltered=!0},d.prototype.alterPreview=function(){this.preview.isAltered=!0,this.preview.face.isAltered=!0,this.preview.edge.isAltered=!0,this.preview.edge.wireOnly.isAltered=!0,this.preview.vertex.isAltered=!0},d.prototype.updatePreview=function(){this._resizeBoundingSphere(),this._resizePreview(),this._resizePreviewVertex(),this._updatePreviewSize(),this._updateAffected(this.affected)},d.prototype._resizeBoundingSphere=function(){let e=this.lastPreviewSize.faces,t=this.faces.length-e;if(t>0){if(e>0){if(this.preview.centroid.buf.data.length<this.preview.centroid.buf.len+3*t){const e=new ArrayBuffer(3*this.faces.length*Float32Array.BYTES_PER_ELEMENT*2),t={buf:{buffer:e,data:new Float32Array(e),len:0}};t.buf.data.set(this.preview.centroid.buf.data);for(let e of this.boundingSpheres)e.center=new Float32Array(t.buf.buffer,Float32Array.BYTES_PER_ELEMENT*t.buf.len,3),t.buf.len+=3;this.preview.centroid.buf=t.buf}}else{const e=new ArrayBuffer(3*this.faces.length*Float32Array.BYTES_PER_ELEMENT*2);this.preview.centroid.buf={buffer:e,data:new Float32Array(e),len:0}}const o=this.preview.centroid;for(let t=e;t<this.faces.length;++t){const e=this.faces[t],n=this.boundingSpheres[t];let i=n.center;i||(i=new Float32Array(o.buf.buffer,Float32Array.BYTES_PER_ELEMENT*o.buf.len,3),o.buf.len+=3),n.setSphere(s.BoundingSphere.computeSphere(e,i))}}},d.prototype._resizePreview=function(){let e=this.lastPreviewSize.vertices,t=this.lastPreviewSize.faces;const o=this.vertices.length-e,n=this.faces.length-t;if(o>0||n>0){const t=this;let o=t.buf.data.length,n=t.preview.centroid.buf.data.length;if(e>0){if(o>t.preview.barycentric.length){t.preview.barycentric=new Float32Array(o);let e=new Uint8Array(o/3);e.set(t.preview.face.selected),t.preview.face.selected=e}n>t.preview.centroid.barycentric.length&&(t.preview.centroid.barycentric=new Float32Array(n))}else t.preview.barycentric=new Float32Array(o),t.preview.face.selected=new Uint8Array(o/3),t.preview.face.indexLenth=0,t.preview.face.visibleLength=0,t.preview.centroid.barycentric=new Float32Array(n);t.preview.barycentric.set(d.CONST.BARYCENTRIC),t.preview.face.selected.fill(0,e),t.preview.centroid.barycentric.fill(1),o=this.buf.len,n=this.preview.centroid.buf.len,t.preview.shaderData.resizeAttribute("position",4*(o+n)),t.preview.shaderData.uploadAttribute("position",0,this.buf.data.subarray(0,o)),t.preview.shaderData.uploadAttribute("position",4*o,this.preview.centroid.buf.data.subarray(0,n)),t.preview.shaderData.resizeAttribute("barycentric",4*(o+n)),t.preview.shaderData.uploadAttribute("barycentric",0,this.preview.barycentric.subarray(0,o)),t.preview.shaderData.uploadAttribute("barycentric",4*o,this.preview.centroid.barycentric.subarray(0,n)),t.hilite.indexLength=0,this.preview.isAltered=!0}this.preview.isAltered&&this._computePreviewIndex()},d.prototype._computePreviewIndex=function(){this.numberOfTriangles=this.faces.reduce(function(e,t){return e+t.numberOfVertex},0),this.preview.indexLength=3*this.numberOfTriangles,this.preview.visibleLength=this.preview.indexLength},d.prototype._computeFaceHiliteIndex=function(e,t){this.hilite.numberOfTriangles<e.numberOfVertex&&(this.hilite.numberOfTriangles=e.numberOfVertex,this.hilite.index=new Uint32Array(3*this.hilite.numberOfTriangles)),void 0===t&&(t=0);let o=0,n=this.vertices.length+e.index;for(let i of e.hEdges()){const e=i.origin;o>0&&(this.hilite.index[t+o++]=e.index,this.hilite.index[t+o++]=n),this.hilite.index[t+o++]=e.index}this.hilite.index[t+o++]=this.hilite.index[t],this.hilite.index[t+o++]=n,this.hilite.indexLength=t+o,this.preview.shaderData.setIndex("faceHilite",this.hilite.index)},d.prototype._computeGroupHiliteIndex=function(e){let t=0;for(let o of e)t+=o.numberOfVertex;this.hilite.numberOfTriangles<t&&(this.hilite.numberOfTriangles=t,this.hilite.index=new Uint32Array(3*this.hilite.numberOfTriangles)),this.hilite.indexLength=0;for(let t of e)this._computeFaceHiliteIndex(t,this.hilite.indexLength)},d.prototype._resizePreviewVertex=function(){const e=this.lastPreviewSize.vertices,t=this.vertices.length;if(t-e>0){const o=this.preview.vertex,n=new Float32Array(t);e>0&&n.set(o.color),n.fill(0,e),o.color=n,this.preview.vertex.isAltered=!0,this.preview.shaderData.resizeAttribute("vertexState",4*t),this.preview.shaderData.uploadAttribute("vertexState",0,o.color)}},d.prototype._updatePreviewSize=function(){this.lastPreviewSize.vertices=this.vertices.length,this.lastPreviewSize.edges=this.edges.length,this.lastPreviewSize.faces=this.faces.length},d.prototype._updateAffected=function(e){if(e.vertices.size>0)for(let t of e.vertices)this._updateVertex(t,e);if(e.faces.size>0)for(let t of e.faces)this._updatePreviewFace(t);this.clearAffected()},d.prototype._updateVertex=function(e,t){e.isLive()&&this.preview.shaderData.uploadAttribute("position",e.vertex.byteOffset,e.vertex)},d.prototype._updatePreviewFace=function(e){if(e.index<this.boundingSpheres.length&&e.isLive()){e.update();const t=this.boundingSpheres[e.index];t.setSphere(s.BoundingSphere.computeSphere(t.polygon,t.center));const o=this.vertices.length+e.index;this.preview.shaderData.uploadAttribute("position",3*o*4,t.center)}},d.prototype.hiliteFace=function(e,t){t?(this.hilite.color=d.theme.unselectedHilite,1==(1&this.preview.face.selected[e.index])&&(this.hilite.color=d.theme.selectedHilite),this.preview.face.selected[e.index]|=2,this._computeFaceHiliteIndex(e)):(this.hilite.indexLength=0,this.preview.face.selected[e.index]&=-3)},d.prototype.hiliteBody=function(e,t){if(t){let t=!0;this.hilite.color=d.theme.unselectedHilite;for(let o of e)t&&1==(1&this.preview.face.selected[o.index])&&(this.hilite.color=d.theme.selectedHilite,t=!1),this.preview.face.selected[o.index]|=2;this._computeGroupHiliteIndex(e)}else{this.hilite.indexLength=0;for(let t of e)this.preview.face.selected[t.index]&=-3}},d.prototype.draw=function(e,t){if(this.preview.isAltered){for(let e of this.materialList)e.indexLength=0,e.index=new Uint32Array(this.preview.indexLength);for(let e of t.visibleWireCage(!1))for(let t of e.geometry.faces)if(t.isVisible()){const e=t.material,o=t.index+this.vertices.length;e.indexLength=t.buildIndex(e.index,e.indexLength,o)}for(let e of this.materialList)e.indexLength>0&&this.preview.shaderData.setIndex(e.uuid,e.index),e.isAltered=!1,delete e.index;this.preview.isAltered=!1}else{let e=!1;for(let t of this.materialList)t.isAltered&&(e=!0,t.indexLength=0,t.index=new Uint32Array(this.preview.indexLength));if(e){for(let e of t.visibleWireCage(!1))for(let t of e.geometry.faces)if(t.isVisible()&&t.material.isAltered){const e=t.material,o=t.index+this.vertices.length;e.indexLength=t.buildIndex(e.index,e.indexLength,o)}for(let e of this.materialList)e.isAltered&&(e.indexLength>0&&this.preview.shaderData.setIndex(e.uuid,e.index),delete e.index,e.isAltered=!1)}}e.bindAttribute(this.preview.shaderData,["position","barycentric"]),this.preview.shaderData.setUniform4fv("color",d.theme.edgeColor),this.preview.shaderData.setUniform1f("lineWidth",d.pref.edgeWidth),e.bindUniform(this.preview.shaderData,["color","faceColor","lineWidth"]);for(let t of this.materialList)t.indexLength>0&&(this.preview.shaderData.setUniform4fv("faceColor",r.hexToRGBA(t.material.diffuseMaterial)),e.bindUniform(this.preview.shaderData,["faceColor"]),e.bindIndex(this.preview.shaderData,t.uuid),e.drawElements(e.TRIANGLES,t.indexLength,e.UNSIGNED_INT,0))},d.prototype.drawHilite=function(e,t){if(this.hilite.indexLength>0)try{e.bindAttribute(this.preview.shaderData,["position","barycentric"]),this.preview.shaderData.setUniform4fv("color",d.theme.edgeColor),this.preview.shaderData.setUniform1f("lineWidth",d.pref.edgeWidth),this.preview.shaderData.setUniform4fv("faceColor",this.hilite.color),e.bindUniform(this.preview.shaderData,["color","lineWidth","faceColor"]),e.bindIndex(this.preview.shaderData,"faceHilite"),e.drawElements(e.TRIANGLES,this.hilite.indexLength,e.UNSIGNED_INT,0),this.preview.shaderData.setUniform4fv("faceColor",d.theme.faceColor)}catch(e){console.log(e)}if(this.preview.face.isAltered){const e=new Uint32Array(this.preview.face.indexLenth);let o=0;for(let n of t.visibleWireCage(!1))for(let t of n.geometry.faces)if(t.isVisible()){const n=t.index,i=n+this.vertices.length;1&this.preview.face.selected[n]&&(o=t.buildIndex(e,o,i))}this.preview.face.visibleLength=o,this.preview.shaderData.setIndex("selectedFace",e),this.preview.face.isAltered=!1}this.preview.face.visibleLength>0&&(e.bindAttribute(this.preview.shaderData,["position","barycentric"]),this.preview.shaderData.setUniform4fv("color",d.theme.edgeColor),this.preview.shaderData.setUniform1f("lineWidth",d.pref.edgeWidth),this.preview.shaderData.setUniform4fv("faceColor",d.theme.selectedColor),e.bindUniform(this.preview.shaderData,["color","faceColor","lineWidth"]),e.bindIndex(this.preview.shaderData,"selectedFace"),e.drawElements(e.TRIANGLES,this.preview.face.visibleLength,e.UNSIGNED_INT,0))},d.prototype.drawVertex=function(e,t){try{if(this.preview.vertex.isModified&&(this.preview.vertex.isModified=!1,this.preview.vertex.min<=this.preview.vertex.max)){const e=this.preview.vertex.min,t=this.preview.vertex.max,o=this.preview.vertex.color.subarray(e,t+1);this.preview.shaderData.uploadAttribute("vertexState",e*Float32Array.BYTES_PER_ELEMENT,o),this.preview.vertex.max=-1,this.preview.vertex.min=Number.MAX_SAFE_INTEGER}if(this.preview.vertex.isAltered){const e=this.vertices.length,o=new Uint32Array(e);let n=0;for(let e of t.visibleCage())for(let t of e.geometry.vertices)o[n++]=t.index;this.preview.shaderData.setIndex("vertex",o),this.preview.vertex.indexLength=n}e.bindAttribute(this.preview.shaderData,["position","vertexState"]),e.bindUniform(this.preview.shaderData,["vertexSize","selectedVertexSize","maskedVertexSize","vertexColor","selectedColor","unselectedHilite","selectedHilite","maskedVertexColor"]),e.bindIndex(this.preview.shaderData,"vertex"),e.drawElements(e.POINTS,this.preview.vertex.indexLength,e.UNSIGNED_INT,0)}catch(e){console.log(e)}},d.prototype.drawHardEdgeEtc=function(e,t,o){let n=!1;if(this.preview.edge.hardness.indexLength>0){if(this.preview.edge.hardness.isAltered){const e=new Uint32Array(this.preview.edge.hardness.indexLength);let t=0;for(let n of o.visibleCage())for(let o of n.geometry.edges)4&o.state&&(t=o.buildIndex(e,t,this.vertices.length));this.preview.shaderData.setIndex("hardEdge",e),this.preview.edge.hardness.realIndexCount=t,this.preview.edge.hardness.isAltered=!1}if(this.preview.edge.hardness.realIndexCount>0){n=!0,e.useShader(i.selectedColorLine),e.bindTransform(),e.bindAttribute(this.preview.shaderData,["position","barycentric"]);let o=d.CONST.EDGEWIDTH;t&&(o=d.pref.hardEdgeWidth),this.preview.shaderData.setUniform1f("lineWidth",o),this.preview.shaderData.setUniform4fv("color",d.theme.hardEdgeColor),this.preview.shaderData.setUniform4fv("faceColor",d.theme.faceColor),e.bindUniform(this.preview.shaderData,["color","faceColor","lineWidth"]),e.bindIndex(this.preview.shaderData,"hardEdge"),e.drawElements(e.TRIANGLES,this.preview.edge.hardness.realIndexCount,e.UNSIGNED_INT,0)}}if(this.preview.edge.wireOnly.isAltered){let e=0;for(let t of o.visibleWireCage(!0))e+=t.geometry.edges.size;if(this.preview.edge.wireOnly.indexLength=6*e,e>0){const e=new Uint32Array(this.preview.edge.wireOnly.indexLength);let t=0;for(let n of o.visibleWireCage(!0))for(let o of n.geometry.edges)0===o.state&&(t=o.buildIndex(e,t,this.vertices.length));this.preview.shaderData.setIndex("wireEdge",e),this.preview.edge.wireOnly.indexLength=t}this.preview.edge.wireOnly.isAltered=!1}this.preview.edge.wireOnly.indexLength>0&&(n||(e.useShader(i.selectedColorLine),e.bindTransform(),e.bindAttribute(this.preview.shaderData,["position","barycentric"]),this.preview.shaderData.setUniform4fv("faceColor",d.theme.faceColor)),this.preview.shaderData.setUniform4fv("color",d.theme.edgeColor),this.preview.shaderData.setUniform1f("lineWidth",d.CONST.EDGEWIDTH),e.bindUniform(this.preview.shaderData,["color","faceColor","lineWidth"]),e.bindIndex(this.preview.shaderData,"wireEdge"),e.drawElements(e.TRIANGLES,this.preview.edge.wireOnly.indexLength,e.UNSIGNED_INT,0))},d.prototype.drawEdge=function(e,t){if(e.bindAttribute(this.preview.shaderData,["position","barycentric"]),this.preview.shaderData.setUniform1f("lineWidth",d.pref.selectedEdgeWidth),this.preview.edge.hilite.wEdge){let t=d.theme.unselectedHilite;1&this.preview.edge.hilite.wEdge.state&&(t=d.theme.selectedHilite),this.preview.shaderData.setUniform4fv("color",t),e.bindUniform(this.preview.shaderData,["color","faceColor","lineWidth"]),e.bindIndex(this.preview.shaderData,"edgeHilite"),e.drawElements(e.TRIANGLES,this.preview.edge.hilite.indexLength,e.UNSIGNED_INT,0)}if(this.preview.edge.indexLength>0){if(this.preview.edge.isAltered){const e=new Uint32Array(this.preview.edge.indexLength),o=new Uint32Array(this.preview.edge.hardness.indexLength);let n=0,i=0;for(let r of t.visibleCage())for(let t of r.geometry.edges)1&t.state?n=t.buildIndex(e,n,this.vertices.length):4&t.state&&(i=t.buildIndex(o,i,this.vertices.length));this.preview.shaderData.setIndex("edgeSelected",e),this.preview.edge.realIndexCount=n,this.preview.edge.isAltered=!1,this.preview.edge.hardness.isAltered&&(this.preview.shaderData.setIndex("hardEdge",o),this.preview.edge.hardness.realIndexCount=i,this.preview.edge.hardness.isAltered=!1)}this.preview.edge.realIndexCount>0&&(this.preview.shaderData.setUniform4fv("color",d.theme.selectedColor),e.bindUniform(this.preview.shaderData,["color","faceColor","lineWidth"]),e.bindIndex(this.preview.shaderData,"edgeSelected"),e.drawElements(e.TRIANGLES,this.preview.edge.realIndexCount,e.UNSIGNED_INT,0))}},d.prototype.drawPlane=function(){const e=vec3.create(),t=vec3.fromValues(0,1,0),o=quat.create(),n=mat4.create(),r=vec3.create();return function(s,a){vec3.copy(r,a.halfSize),vec3.normalize(r,r),vec3.cross(e,r,t),vec3.normalize(e,e),quat.rotationTo(o,e,a.normal),mat4.fromQuat(n,o),vec3.copy(r,a.halfSize),vec3.negate(this.previewPlane.pts[0],r);let c=this.previewPlane.pts[1];c[0]=r[0],c[1]=-r[1],c[2]=r[2],vec3.copy(this.previewPlane.pts[2],r),vec3.negate(this.previewPlane.pts[3],c);for(let e=0;e<4;++e){const t=this.previewPlane.pts[e];vec3.transformMat4(t,t,n),vec3.add(t,a.center,t)}this.previewPlane.shaderData.uploadAttribute("position",0,this.previewPlane.rectangle),a.hilite?this.previewPlane.shaderData.setUniform4fv("faceColor",[0,1,0,1]):this.previewPlane.shaderData.setUniform4fv("faceColor",[.1,.1,.1,1]),s.disable(s.CULL_FACE),s.useShader(i.solidColor),s.bindTransform(),s.bindAttribute(this.previewPlane.shaderData,["position"]),s.bindUniform(this.previewPlane.shaderData,["faceColor"]),s.drawArrays(s.TRIANGLE_FAN,0,4),s.disableShader(),s.enable(s.CULL_FACE)}}(),d.prototype.selectGroup=function(e,t){for(let o of e)this.selectFace(o,t)},d.prototype.resetBody=function(e){this.selectGroup(e,!1)},d.prototype.hiliteVertex=function(e,t){t?this.setVertexColor(e,.5):this.setVertexColor(e,-.5)},d.prototype.setVertexColor=function(e,t){const o=e.index;this.preview.vertex.color[o]+=t,o<this.preview.vertex.min&&(this.preview.vertex.min=o),o>this.preview.vertex.max&&(this.preview.vertex.max=o),this.preview.vertex.isModified=!0},d.prototype.resetSelectVertex=function(){this.preview.vertex.isModified=!1,this.preview.vertex.color.fill(0),this.preview.shaderData.uploadAttribute("vertexState",0,this.preview.vertex.color)},d.prototype.hiliteEdge=function(e,t){if(t){const t=e.wingedEdge;this.preview.edge.hilite.wEdge=t;const o=new Uint32Array(6);t.buildIndex(o,0,this.vertices.length),this.preview.shaderData.setIndex("edgeHilite",o),this.preview.edge.hilite.indexLength=6}else this.preview.edge.hilite.wEdge=null,this.preview.edge.hilite.indexLength=0},d.prototype.selectEdge=function(e,t){t?0==(1&e.state)&&(e.state|=1,this.preview.edge.indexLength+=6):1==(1&e.state)&&(e.state&=-2,this.preview.edge.indexLength-=6),this.preview.edge.isAltered=!0},d.prototype.resetSelectEdge=function(){for(let e of this.edges)e.state=0;this.preview.edge.isAltered=!1,this.preview.edge.indexLength=0},d.prototype.updateCentroid=function(e){const t=this.preview.centroid.buf.data.subarray(0,this.preview.centroid.buf.len);this.preview.shaderData.uploadAttribute("position",4*this.buf.len,t)},d.prototype.updatePosition=function(){const e=this.buf.data.subarray(0,this.buf.len);this.preview.shaderData.uploadAttribute("position",0,e)},d.prototype.selectFace=function(e,t){t?0==(1&this.preview.face.selected[e.index])&&(this.preview.face.indexLenth+=3*e.numberOfVertex,this.preview.face.selected[e.index]|=1,this.preview.face.isAltered=!0,2&this.preview.face.selected[e.index]&&(this.hilite.color=d.theme.selectedHilite)):1==(1&this.preview.face.selected[e.index])&&(this.preview.face.indexLenth-=3*e.numberOfVertex,this.preview.face.selected[e.index]&=-2,this.preview.face.isAltered=!0,2&this.preview.face.selected[e.index]&&(this.hilite.color=d.theme.unselectedHilite))},d.prototype.resetSelectFace=function(){this.preview.face.selected.fill(0),this.preview.face.indexLenth=0,this.preview.face.visibleLength=0,this.preview.face.isAltered=!0},d.prototype.setHardness=function(e,t){if(0===t){if(4&e.state)return e.state&=-5,this.preview.edge.hardness.isAltered=!0,this.preview.edge.hardness.indexLength-=6,!0}else{if(1!==t)return 4&e.state?this.setHardness(e,0):this.setHardness(e,1);if(0==(4&e.state))return e.state|=4,this.preview.edge.hardness.isAltered=!0,this.preview.edge.hardness.indexLength+=6,!0}return!1},d.prototype.isMaterialsInUse=function(e){for(let t of e)for(let e of this.faces)if(e.isLive()&&e.material===t)return!0;return!1};class l extends c.EditCommand{CheckPoint(e,t){this.command=t,this.draftBench=e,this.vertices=[];for(let t of e.vertices)t.isLive()?this.vertices.push(t.outEdge.wingedEdge.index):this.vertices.push(-1);this.edges=[];for(let t of e.edges)t.isLive()?this.edges.push(t.left.next.index,t.right.next.index,t.left.origin.index,t.right.origin.index):this.edges.push(-1,-1,-1,-1);this.faces=[];for(let t of e.faces)t.isLive()?this.faces.push(t.halfEdge.index):this.faces.push(-1)}doIt(){return this.command.doIt()}undo(){this.command.undo();for(let e=0;e<this.faces.length;++e){const t=this.draftBench.faces[e];if(t.isLive()){if(t.halfEdge.index!=this.faces[e])return void geometryStatus("CheckPoint failed. non matching polygon halfEdge")}else if(-1!=this.faces[e])return void geometryStatus("CheckPoint failed. extra face")}for(let e=0;e<this.vertices.lenth;++e){const t=this.draftBench.vertices[e];if(t.isLive()){if(t.outEdge.wingedEdge.index!=this.vertices[e])return void geometryStatus("CheckPoint failed. non-matching vertex outEdge")}else if(-1!=this.vertices[e])return void geometryStatus("CheckPoint failed. extra vertex")}for(let e=0;e<this.edges.length;e+=4){const t=this.draftBench.edges[e];if(t.isAlive()){if(t.left.next.index!=this.edges[e]||t.right.next.index!=[e+1]||t.left.origin.index!=this.edges[e+2]||t.right.origin.index!=this.edges[e+3])return void geometryStatus("CheckPoint failed. non matching wEdge")}else if(-1!=this.edges[e])return void geometryStatus("CheckPoint failed. extra wEdge")}}}},function(e,t,o){o(30),o(13),o(17),o(11),o(25),o(16),o(14),o(4),o(27),o(19),o(21),o(23),o(9),o(7),o(18),o(2),o(24),o(8),o(10),o(28),o(29),o(3),o(20),o(5),o(6),o(15),o(1),o(12),e.exports=o(0)},function(e,t,o){"use strict";o.r(t),o.d(t,"tours",function(){return s});var n=o(9),i=o(3),r=o(0);const s={};r.onReady(function(){s.about=(()=>{n.cancel(),n.addStep("Welcome","","<p>Wings3D4Web is a web implementation of Wings3D modeller</p><p>Use Help's interactive learning aid</p><p>Or goto <a target='_blank' href='http://www.wings3d.com/?page_id=87'>Wings3D documentation page</a> for more instruction.</p>","helpMenu","bottom"),n.startTour()}),s.introduction=(()=>{n.cancel(),n.addStep("Welcome","Interface Essential","Wings 3D interface keeps the focus on modeling. It consists of \n         <ul>\n          <li>Menubar</li>\n          <li>Toolbar</li>\n          <li>Geometry Info</li>\n          <li>Modelling Area</li>\n          <li>Information Line</li>\n         </ul>","","top"),n.addStep("Status","Geometry Info","Shown information about the current Model if any","statusbar","bottom-start"),n.addStep("Information","Information Line","<ul>\n         <li>Hovering over almost anything in Wings displays its function in the info line.</li>\n         <li><mark>L, M</mark>, and <mark>R</mark> are used in the info line to indicate commands initiated by the <em>Left, Middle</em>, and <em>Right</em> mouse buttons.</li>\n         <li>Uppercase letters in square brackets represent keyboard keys like <mark>[C]</mark>.</li>\n         <li>Numbers in square brackets represent number keys on the keyboard like <mark>[1], [2], [3]</mark>.</li>\n         <li><mark>[Shift], [Ctrl]</mark>, and <mark>[Alt]</mark> are keyboard modifier keys.</li>\n        </ul>","helpbar","top-start"),n.addStep("Undo","undo/redo","undo button revert the last operation","undoEdit","bottom"),n.addStep("Redo","undo/redo","redo button revert the last undo operation","redoEdit","bottom"),n.startTour()}),s.basicCommands=(()=>{n.cancel(),n.addZoomStep("Welcome","Zoom","Mouse wheel scroll in Canvas will zoom in/out","","top"),n.addExpectStep(r.action.cameraModeEnter,"Camera","Camera Mode","Let <em>M</em>, click middle mouse button anywhere in the Canvas to enter camera mode","","right"),n.addExpectStep(r.action.cameraModeExit,"MoveCamera","Move Camera","Information Line shows you how to move camera, exit Camera Mode, and you can still zoom in/out","helpbar","top-start"),n.addMultiStep("Cube Creation","Create Cube Steps","Steps to create a Cube","","top",[n.expectStep(r.action.contextMenu,"CreateMenu","ContextMenu","Let <em>R</em> click right mouse button in the Canvas empty place to bring up CreateObject Menu","","left"),n.expectStep(r.action.createCubeDialog,"CreateCubeForm","Great Job","Click Cube MenuItem to create Cube","createCube","right"),n.expectStep("createCube","CreateCube","Cube Form","You can adjust the cube's parameter","createCubeForm","top")]),n.addFaceSelectStep(1,"selectFace","Select any Face","Try to click/select face","left"),n.addStep("Congratulation","Congratulation","<em>R</em>, Right click mouse button will bring up Face tools. Now you know the basic steps.","","bottom"),n.startTour()}),s.tableTutor=(()=>{n.cancel(),n.addExpectStep("Make a simple table","Cube","RMB (anywhere in geometry window) to display the primitives menu and select cube with LMB.","","top"),n.startTour()}),i.bindMenuItem(r.action.about.name,e=>{s.about()}),i.bindMenuItem(r.action.introduction.name,e=>{s.introduction()}),i.bindMenuItem(r.action.basicCommands.name,e=>{s.basicCommands()}),i.bindMenuItem(r.action.tableTutor.name,e=>{s.tableTutor()})})},function(e,t,o){"use strict";o.r(t),o.d(t,"SimilarFace",function(){return i}),o.d(t,"SimilarVertex",function(){return s}),o.d(t,"SimilarWingedEdge",function(){return r});class n{constructor(){this.set=new Set}static _toFixed(e,t){return(+(Math.round(+(e+"e"+t))+"e"+-t)).toFixed(t)}static _discreetAngle(e){return function(e){let t=180*e/Math.PI;return(t=Math.round(t))<0&&(t=360+t),t/180*Math.PI}(2*Math.atan(e))}static _computeAngle(e){vec3.scale(e.aLengthB,e.a,e.bLength),vec3.scale(e.bLengthA,e.b,e.aLength);let t=vec3.distance(e.bLengthA,e.aLengthB);vec3.add(e.aLengthB,e.aLengthB,e.bLengthA);const o=vec3.length(e.aLengthB);return n._discreetAngle(t/o)}static computeRatio(e){const t=n._computeAngle(e),o=n._toFixed(e.bLength/e.aLength,2)*t,i=n._toFixed(e.aLength/e.bLength,2)*t;-1===e.fwd.index?(e.fwd.index=0,e.rev.index=0):(o<e.fwd.angle[e.fwd.index]&&(e.fwd.index=e.fwd.angle.length),i<e.rev.angle[e.rev.index]?e.rev.index=0:++e.rev.index),e.fwd.angle.push(o),e.rev.angle.unshift(i)}static computeMetric(e,t=0){e.fwd.angle.unshift(...e.fwd.angle.splice(e.fwd.index,e.fwd.angle.length)),e.rev.angle.unshift(...e.rev.angle.splice(e.rev.index,e.rev.angle.length));let o=t,n=t;for(let t=0;t<e.fwd.angle.length;++t)o=o*(e.fwd.angle[t]+.1)+e.fwd.angle[t],n=n*(e.rev.angle[t]+.1)+e.rev.angle[t];return[o,n]}static mStruct(){return{a:vec3.create(),aLength:-1,b:vec3.create(),bLength:-1,aLengthB:vec3.create(),bLengthA:vec3.create(),fwd:{index:-1,angle:[]},rev:{index:-1,angle:[]}}}find(e){const t=this.getMetric(e);return this.set.has(t)}}class i extends n{constructor(e){super();for(let t of e){const e=this.getMetric(t,!0);this.set.add(e[0]),this.set.add(e[1])}}getMetric(e,t=!1){const o=n.mStruct();e.eachEdge(function(e){-1===o.aLength?(vec3.sub(o.a,e.prev().origin.vertex,e.origin.vertex),o.aLength=vec3.length(o.a)):(vec3.negate(o.a,o.b),o.aLength=o.bLength),vec3.sub(o.b,e.destination().vertex,e.origin.vertex),o.bLength=vec3.length(o.b),n.computeRatio(o)});const i=n.computeMetric(o);return t?i:i[0]}}class r extends n{constructor(e){super();for(let t of e){const e=this.getMetric(t,!0);this.set.add(e[0]),this.set.add(e[1])}}getMetric(e,t=!1){const o=n.mStruct(),i=[];for(let t of e){const e=t.prev(),r=t.next;vec3.sub(o.a,e.origin.vertex,t.origin.vertex),o.aLength=vec3.length(o.a),vec3.sub(o.b,r.origin.vertex,t.origin.vertex),o.bLength=vec3.length(o.b),n.computeRatio(o);const s=vec3.create();vec3.cross(s,o.b,o.a),vec3.normalize(s,s),i.push(s),vec3.negate(o.a,o.b),o.aLength=o.bLength,vec3.sub(o.b,r.destination().vertex,r.origin.vertex),o.bLength=vec3.length(o.b),n.computeRatio(o)}const r=vec3.dot(i[1],i[0]),s=n.computeMetric(o,r);return t?s:s[0]}}class s extends n{constructor(e){super();for(let t of e){const e=this.getMetric(t,!0);this.set.add(e[0]),this.set.add(e[1])}}getMetric(e,t=!1){const o=n.mStruct();e.eachOutEdge(function(t){-1===o.aLength?(vec3.sub(o.a,t.destination().vertex,e.vertex),o.aLength=vec3.length(o.a)):(vec3.copy(o.a,o.b),o.aLength=o.bLength),vec3.sub(o.b,t.destination().vertex,e.vertex),o.bLength=vec3.length(o.b),n.computeRatio(o)});const i=n.computeMetric(o);return t?i:i[0]}}},function(e,t,o){"use strict";o.r(t),o.d(t,"triangulatePreview",function(){return c});o(12);const n=function(e,t){this.origin=e,this.next=t};n.prototype.destination=function(){return this.next.origin};let i=vec3.create(),r=vec3.create(),s=vec3.create();function a(e,t,o){return vec3.sub(i,e.vertex,t.vertex),vec3.sub(r,o.vertex,t.vertex),vec3.cross(s,i,r),Math.atan2(vec3.length(s),vec3.dot(i,r))<=0}function c(e){let t,o=0,i=[],r=[],s=e.halfEdge;e.halfEdge;do{if(lastHEdge){if(lastHEdge.origin,t.origin,t.destination()){i.push(lastHEdge),o++;break}}else lastHEdge=t;t=t.next}while(t!==s);if(t!==s){s=t,lastHEdge=t,t=t.next;do{if(a(lastHEdge.origin,t.origin,t.destination()))i.push(t),o++;else if(o>0){do{let e=new n(lastHEdge.origin,t.next);r.push(lastHEdge.origin,t.origin,curret.destination()),i.pop(),lastHEdge=i[i.length-1],t=e}while(!a(lastHEdge.origin,connect.origin,connect.destination())&&--o>0);0==o&&i.push(t)}else i.push(t);lastHEdge=t,t=t.next}while(t!==s)}if(i.length>=3){lastHEdge=i[0];const e=i.length-1;lastHEdge.triPt=i[2].origin;for(let t=1;e>t;++t){const e=i[t];r.push(lastHEdge.origin,e.origin,e.destination()),e.triPt=lastHEdge.origin}}else console.log("something wrong in triangulatePreview");return r}},function(e,t,o){"use strict";o.r(t);o(31),o(36),o(38),o(40),o(42),o(44);var n=o(1),i=(o(11),o(9),o(0)),r=o(3),s=(o(21),o(12),o(2));let a,c;document.addEventListener("DOMContentLoaded",function(){var e={previewCage:null};function t(){n.undoQueue(new s.CreatePreviewCageCommand(e.previewCage)),e.previewCage.name="Cube"+(e.creationCount+1),i.log("createCube",e.previewCage),e.previewCage=null,e.creationCount++}e.cubeParams={numberOfCut:1,spherize:!1,size:{x:2,y:2,z:2},rotate:{x:0,y:0,z:0},translate:{x:0,y:0,z:0},putOnGround:!1},e.creationCount=0,e.resetCubeParams=function(){e.cubeParams.numberOfCut=1,e.cubeParams.spherize=!1,e.cubeParams.size.x=e.cubeParams.size.y=e.cubeParams.size.z=2,e.cubeParams.rotate.x=e.cubeParams.rotate.y=e.cubeParams.rotate.z=0,e.cubeParams.translate.x=e.cubeParams.translate.y=e.cubeParams.translate.z=0,e.cubeParams.putOnGround=!1},e.cancelPreview=function(){null!==e.previewCage&&(n.removeFromWorld(e.previewCage),e.previewCage.freeBuffer(),e.previewCage=null)},e.updatePreview=function(){null!==e.previewCage&&(n.removeFromWorld(e.previewCage),e.previewCage.freeBuffer(),e.previewCage=null),a(e.cubeParams.size,e.cubeParams.numberOfCut,e.cubeParams.translate,e.cubeParams.rotate,e.cubeParams.putOnGround)},a=function(t,o,i,r,s){let a=n.putIntoWorld(),c=a.geometry;var d={};function l(e){var t,n,i,r,s,a=0,l=[],u=[];for(let h=0;h<=o;++h){for(let a=0;a<=o;++a)l.push((t=e(h,a),n=void 0,i=void 0,r=void 0,s=void 0,n=t[0],i=t[1],r=t[2],s=n.toFixed(6)+","+i.toFixed(6)+","+r.toFixed(6),d.hasOwnProperty(s)||(d[s]=c.addVertex(t)),d[s].index));if(h>0){for(let e=0;e<o;++e)u.push(l[a+e]),u.push(l[a+e+1]),u.push(l[a+e+1+o+1]),u.push(l[a+e+o+1]),c.addPolygon(u),u.length=0;a+=o+1}}}let u=quat.create();quat.fromEuler(u,r.x,r.y,r.z);const h=mat3.create();mat3.fromQuat(h,u);const f=vec3.fromValues(-t.x/2,-t.y/2,-t.z/2),p=vec3.fromValues(i.x,i.y,i.z);s&&(p[1]=-f[1]);const g=vec3.fromValues(t.x,0,0),v=vec3.fromValues(0,t.y,0),m=vec3.fromValues(0,0,t.z);vec3.transformMat3(f,f,h),vec3.transformMat3(g,g,h),vec3.transformMat3(v,v,h),vec3.transformMat3(m,m,h);const x=vec3.create(),y=[],w=[],b=[];for(let e=0;e<=o;++e){const t=e/o,n=vec3.create();vec3.scale(n,g,t),y.push(n);const i=vec3.create();vec3.scale(i,v,t),w.push(i);const r=vec3.create();vec3.scale(r,m,t),b.push(r)}vec3.add(x,f,g),l(function(e,t){return vec3.fromValues(x[0]-y[t][0]+w[e][0]+p[0],x[1]-y[t][1]+w[e][1]+p[1],x[2]-y[t][2]+w[e][2]+p[2])}),l(function(e,t){return[x[0]-y[e][0]+b[t][0]+p[0],x[1]-y[e][1]+b[t][1]+p[1],x[2]-y[e][2]+b[t][2]+p[2]]}),vec3.add(x,x,m),l(function(e,t){return[x[0]+w[e][0]-b[t][0]+p[0],x[1]+w[e][1]-b[t][1]+p[1],x[2]+w[e][2]-b[t][2]+p[2]]}),vec3.add(x,f,m),l(function(e,t){return[x[0]+y[t][0]+w[e][0]+p[0],x[1]+y[t][1]+w[e][1]+p[1],x[2]+y[t][2]+w[e][2]+p[2]]}),l(function(e,t){return[f[0]+w[e][0]+b[t][0]+p[0],f[1]+w[e][1]+b[t][1]+p[1],f[2]+w[e][2]+b[t][2]+p[2]]}),vec3.add(x,f,g),vec3.add(x,x,v),vec3.add(x,x,m),l(function(e,t){return[x[0]-y[e][0]-b[t][0]+p[0],x[1]-y[e][1]-b[t][1]+p[1],x[2]-y[e][2]-b[t][2]+p[2]]}),e.previewCage=a,n.updateWorld()};var o=document.getElementById("createCubeForm");if(null===o){(o=document.createElement("form")).setAttribute("id","createCubeForm"),o.innerHTML='\n         <span class="close">&times;</span>\n         <h3>Cube Options</h3>\n         <fieldset> \n            <legend>Number of Cuts</legend>\n            <input name="numberOfCuts" type="range" min="1" max="20" value="1" onchange="this.nextElementSibling.value=this.value" />\n            <input name="numberOfCuts" type="number" min="1" max="20" value="1" step="1" onchange="this.previousElementSibling.value=this.value" />\n         </fieldset>\n         <div>\n            <label>X <input type="number" name="size_x" value="2.0" step="0.5"></label><br>\n            <label>Y <input type="number" name="size_y" value="2.0" step="0.5"></label><br>\n            <label>Z <input type="number" name="size_z" value="2.0" step="0.5"></label>\n         </div>\n         <fieldset>\n            <legend>Spherize</legend>\n            <label><input type=\'radio\' name=\'sphere\' value=\'true\' disabled>Yes</label>\n            <label><input type=\'radio\' name=\'sphere\' value=\'false\' checked disabled>No<label>\n         </fieldset>\n         <fieldset>\n            <label>Rotate</label>\n            <span>\n               <label>X <input type="number" name="rotate_x" value="0.0" step="1"></label><br>\n               <label>Y <input type="number" name="rotate_y" value="0.0" step="1"></label><br>\n               <label>Z <input type="number" name="rotate_z" value="0.0" step="1"></label>    \n            </span>\n            <label>Move</label>\n            <span>\n               <label>X <input type="number" name="translate_x" value="0.0" step="0.5"></label><br>\n               <label>Y <input type="number" name="translate_y" value="0.0" step="0.5"></label><br>\n               <label>Z <input type="number" name="translate_z" value="0.0" step="0.5"></label>\n            </span>\n            <div>\n               <label><input type="checkbox" name="ground">Put on Ground</label>\n            </div>\n         </fieldset>\n          <button type="reset" value="Reset">Reset</button>\n          <button type="submit" value="Ok">Ok</button>\n      ',o.style.display="none",o.style.position="absolute",o.className+="dialog",document.body.appendChild(o),o.getElementsByClassName("close")[0].addEventListener("click",function(t){o.style.display="none",e.cancelPreview()}),o.addEventListener("submit",function(e){e.preventDefault(),o.style.display="none",t()});var d=function(t){e.cubeParams.numberOfCut=Number(t.target.value),e.updatePreview()},l=document.querySelectorAll('#createCubeForm input[name="numberOfCuts"]');l[0].addEventListener("change",d),l[1].addEventListener("change",d);var u=document.querySelectorAll('#createCubeForm input[name^="size_"]');u[0].addEventListener("change",function(t){e.cubeParams.size.x=Number(t.target.value),e.updatePreview()}),u[1].addEventListener("change",function(t){e.cubeParams.size.y=Number(t.target.value),e.updatePreview()}),u[2].addEventListener("change",function(t){e.cubeParams.size.z=Number(t.target.value),e.updatePreview()});const n=document.querySelectorAll('#createCubeForm input[name^="translate_"]');n[0].addEventListener("change",function(t){e.cubeParams.translate.x=Number(t.target.value),e.updatePreview()}),n[1].addEventListener("change",function(t){e.cubeParams.translate.y=Number(t.target.value),e.updatePreview()}),n[2].addEventListener("change",function(t){e.cubeParams.translate.z=Number(t.target.value),e.updatePreview()});const i=document.querySelectorAll('#createCubeForm input[name="ground"]');i[0].addEventListener("change",function(t){i[0].checked?(n[1].disabled=!0,e.cubeParams.putOnGround=!0):(n[1].disabled=!1,e.cubeParams.putOnGround=!1),e.updatePreview()});const r=document.querySelectorAll('#createCubeForm input[name^="rotate_"]');r[0].addEventListener("change",function(t){e.cubeParams.rotate.x=Number(t.target.value),e.updatePreview()}),r[1].addEventListener("change",function(t){e.cubeParams.rotate.y=Number(t.target.value),e.updatePreview()}),r[2].addEventListener("change",function(t){e.cubeParams.rotate.z=Number(t.target.value),e.updatePreview()}),o.addEventListener("change",function(e){e.stopPropagation(),null!==e.target.name&&help(e.target.name+" = "+e.target.value)}),o.addEventListener("reset",function(t){e.resetCubeParams(),e.updatePreview()})}const h=i.action.createCube.name;r.bindMenuItem(h,function(o){e.updatePreview(),t()}),r.bindMenuItemRMB(h,function(e){var t=r.getPosition(e);c(t),i.log(i.action.createCubeDialog)}),r.bindMenuItem(i.action.createCubePref.name,function(e){var t=r.getPosition(e);c(t),i.log(i.action.createCubeDialog)}),c=function(t){o.style.display="block",r.positionDom(o,t),e.previewCage=null,o.reset()}},!1);o(22);i.start("glcanvas")},function(e,t){},,,,,function(e,t){},,function(e,t){},,function(e,t){},,function(e,t){},,function(e,t){}]);